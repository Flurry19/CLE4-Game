var Pa=Object.defineProperty;var Ea=(g,_,a)=>_ in g?Pa(g,_,{enumerable:!0,configurable:!0,writable:!0,value:a}):g[_]=a;var O=(g,_,a)=>(Ea(g,typeof _!="symbol"?_+"":_,a),a);(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const w of p)if(w.type==="childList")for(const x of w.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function a(p){const w={};return p.integrity&&(w.integrity=p.integrity),p.referrerPolicy&&(w.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?w.credentials="include":p.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(p){if(p.ep)return;p.ep=!0;const w=a(p);fetch(p.href,w)}})();/*!
 * excalibur - 0.27.0 - 2022-7-8
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2022 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var Ia={4662:(g,_,a)=>{a(3430);var d=a(8791);g.exports=d("Array","sort")},8343:(g,_,a)=>{a(4769);var d=a(9276);g.exports=d.Object.keys},7111:(g,_,a)=>{var d=a(6733),p=a(9821),w=TypeError;g.exports=function(x){if(d(x))return x;throw w(p(x)+" is not a function")}},1176:(g,_,a)=>{var d=a(5052),p=String,w=TypeError;g.exports=function(x){if(d(x))return x;throw w(p(x)+" is not an object")}},9540:(g,_,a)=>{var d=a(905),p=a(3231),w=a(9646),x=function(C){return function(B,I,R){var H=d(B),L=w(H),M=p(R,L),W;if(C&&I!=I){for(;L>M;)if(W=H[M++],W!=W)return!0}else for(;L>M;M++)if((C||M in H)&&H[M]===I)return C||M||0;return!C&&-1}};g.exports={includes:x(!0),indexOf:x(!1)}},6038:(g,_,a)=>{var d=a(4229);g.exports=function(p,w){var x=[][p];return!!x&&d(function(){x.call(null,w||function(){return 1},1)})}},9794:(g,_,a)=>{var d=a(3231),p=a(9646),w=a(2324),x=Array,C=Math.max;g.exports=function(B,I,R){for(var H=p(B),L=d(I,H),M=d(R===void 0?H:R,H),W=x(C(M-L,0)),nt=0;L<M;L++,nt++)w(W,nt,B[L]);return W.length=nt,W}},3867:(g,_,a)=>{var d=a(9794),p=Math.floor,w=function(B,I){var R=B.length,H=p(R/2);return R<8?x(B,I):C(B,w(d(B,0,H),I),w(d(B,H),I),I)},x=function(B,I){for(var R=B.length,H=1,L,M;H<R;){for(M=H,L=B[H];M&&I(B[M-1],L)>0;)B[M]=B[--M];M!==H++&&(B[M]=L)}return B},C=function(B,I,R,H){for(var L=I.length,M=R.length,W=0,nt=0;W<L||nt<M;)B[W+nt]=W<L&&nt<M?H(I[W],R[nt])<=0?I[W++]:R[nt++]:W<L?I[W++]:R[nt++];return B};g.exports=w},7079:(g,_,a)=>{var d=a(5968),p=d({}.toString),w=d("".slice);g.exports=function(x){return w(p(x),8,-1)}},1589:(g,_,a)=>{var d=a(1601),p=a(6733),w=a(7079),x=a(95),C=x("toStringTag"),B=Object,I=w(function(){return arguments}())=="Arguments",R=function(H,L){try{return H[L]}catch{}};g.exports=d?w:function(H){var L,M,W;return H===void 0?"Undefined":H===null?"Null":typeof(M=R(L=B(H),C))=="string"?M:I?w(L):(W=w(L))=="Object"&&p(L.callee)?"Arguments":W}},7081:(g,_,a)=>{var d=a(8270),p=a(4826),w=a(7933),x=a(1787);g.exports=function(C,B,I){for(var R=p(B),H=x.f,L=w.f,M=0;M<R.length;M++){var W=R[M];!d(C,W)&&!(I&&d(I,W))&&H(C,W,L(B,W))}}},5762:(g,_,a)=>{var d=a(7400),p=a(1787),w=a(5358);g.exports=d?function(x,C,B){return p.f(x,C,w(1,B))}:function(x,C,B){return x[C]=B,x}},5358:g=>{g.exports=function(_,a){return{enumerable:!(_&1),configurable:!(_&2),writable:!(_&4),value:a}}},2324:(g,_,a)=>{var d=a(9310),p=a(1787),w=a(5358);g.exports=function(x,C,B){var I=d(C);I in x?p.f(x,I,w(0,B)):x[I]=B}},4768:(g,_,a)=>{var d=a(6733),p=a(1787),w=a(6039),x=a(8400);g.exports=function(C,B,I,R){R||(R={});var H=R.enumerable,L=R.name!==void 0?R.name:B;if(d(I)&&w(I,L,R),R.global)H?C[B]=I:x(B,I);else{try{R.unsafe?C[B]&&(H=!0):delete C[B]}catch{}H?C[B]=I:p.f(C,B,{value:I,enumerable:!1,configurable:!R.nonConfigurable,writable:!R.nonWritable})}return C}},8400:(g,_,a)=>{var d=a(9859),p=Object.defineProperty;g.exports=function(w,x){try{p(d,w,{value:x,configurable:!0,writable:!0})}catch{d[w]=x}return x}},9563:(g,_,a)=>{var d=a(9821),p=TypeError;g.exports=function(w,x){if(!delete w[x])throw p("Cannot delete property "+d(x)+" of "+d(w))}},7400:(g,_,a)=>{var d=a(4229);g.exports=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},2635:(g,_,a)=>{var d=a(9859),p=a(5052),w=d.document,x=p(w)&&p(w.createElement);g.exports=function(C){return x?w.createElement(C):{}}},2671:(g,_,a)=>{var d=a(598),p=d.match(/firefox\/(\d+)/i);g.exports=!!p&&+p[1]},8506:(g,_,a)=>{var d=a(598);g.exports=/MSIE|Trident/.test(d)},598:(g,_,a)=>{var d=a(1333);g.exports=d("navigator","userAgent")||""},6358:(g,_,a)=>{var d=a(9859),p=a(598),w=d.process,x=d.Deno,C=w&&w.versions||x&&x.version,B=C&&C.v8,I,R;B&&(I=B.split("."),R=I[0]>0&&I[0]<4?1:+(I[0]+I[1])),!R&&p&&(I=p.match(/Edge\/(\d+)/),(!I||I[1]>=74)&&(I=p.match(/Chrome\/(\d+)/),I&&(R=+I[1]))),g.exports=R},9811:(g,_,a)=>{var d=a(598),p=d.match(/AppleWebKit\/(\d+)\./);g.exports=!!p&&+p[1]},8791:(g,_,a)=>{var d=a(9859),p=a(5968);g.exports=function(w,x){return p(d[w].prototype[x])}},3837:g=>{g.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(g,_,a)=>{var d=a(9859),p=a(7933).f,w=a(5762),x=a(4768),C=a(8400),B=a(7081),I=a(6541);g.exports=function(R,H){var L=R.target,M=R.global,W=R.stat,nt,K,V,tt,kt,v;if(M?K=d:W?K=d[L]||C(L,{}):K=(d[L]||{}).prototype,K)for(V in H){if(kt=H[V],R.dontCallGetSet?(v=p(K,V),tt=v&&v.value):tt=K[V],nt=I(M?V:L+(W?".":"#")+V,R.forced),!nt&&tt!==void 0){if(typeof kt==typeof tt)continue;B(kt,tt)}(R.sham||tt&&tt.sham)&&w(kt,"sham",!0),x(K,V,kt,R)}}},4229:g=>{g.exports=function(_){try{return!!_()}catch{return!0}}},7188:(g,_,a)=>{var d=a(4229);g.exports=!d(function(){var p=function(){}.bind();return typeof p!="function"||p.hasOwnProperty("prototype")})},266:(g,_,a)=>{var d=a(7188),p=Function.prototype.call;g.exports=d?p.bind(p):function(){return p.apply(p,arguments)}},1805:(g,_,a)=>{var d=a(7400),p=a(8270),w=Function.prototype,x=d&&Object.getOwnPropertyDescriptor,C=p(w,"name"),B=C&&function(){}.name==="something",I=C&&(!d||d&&x(w,"name").configurable);g.exports={EXISTS:C,PROPER:B,CONFIGURABLE:I}},5968:(g,_,a)=>{var d=a(7188),p=Function.prototype,w=p.bind,x=p.call,C=d&&w.bind(x,x);g.exports=d?function(B){return B&&C(B)}:function(B){return B&&function(){return x.apply(B,arguments)}}},1333:(g,_,a)=>{var d=a(9859),p=a(6733),w=function(x){return p(x)?x:void 0};g.exports=function(x,C){return arguments.length<2?w(d[x]):d[x]&&d[x][C]}},5300:(g,_,a)=>{var d=a(7111);g.exports=function(p,w){var x=p[w];return x==null?void 0:d(x)}},9859:(g,_,a)=>{var d=function(p){return p&&p.Math==Math&&p};g.exports=d(typeof globalThis=="object"&&globalThis)||d(typeof window=="object"&&window)||d(typeof self=="object"&&self)||d(typeof a.g=="object"&&a.g)||function(){return this}()||Function("return this")()},8270:(g,_,a)=>{var d=a(5968),p=a(2991),w=d({}.hasOwnProperty);g.exports=Object.hasOwn||function(C,B){return w(p(C),B)}},5977:g=>{g.exports={}},4394:(g,_,a)=>{var d=a(7400),p=a(4229),w=a(2635);g.exports=!d&&!p(function(){return Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a!=7})},9337:(g,_,a)=>{var d=a(5968),p=a(4229),w=a(7079),x=Object,C=d("".split);g.exports=p(function(){return!x("z").propertyIsEnumerable(0)})?function(B){return w(B)=="String"?C(B,""):x(B)}:x},8511:(g,_,a)=>{var d=a(5968),p=a(6733),w=a(5353),x=d(Function.toString);p(w.inspectSource)||(w.inspectSource=function(C){return x(C)}),g.exports=w.inspectSource},6407:(g,_,a)=>{var d=a(8694),p=a(9859),w=a(5968),x=a(5052),C=a(5762),B=a(8270),I=a(5353),R=a(4399),H=a(5977),L="Object already initialized",M=p.TypeError,W=p.WeakMap,nt,K,V,tt=function(dt){return V(dt)?K(dt):nt(dt,{})},kt=function(dt){return function(D){var at;if(!x(D)||(at=K(D)).type!==dt)throw M("Incompatible receiver, "+dt+" required");return at}};if(d||I.state){var v=I.state||(I.state=new W),P=w(v.get),mt=w(v.has),j=w(v.set);nt=function(dt,D){if(mt(v,dt))throw new M(L);return D.facade=dt,j(v,dt,D),D},K=function(dt){return P(v,dt)||{}},V=function(dt){return mt(v,dt)}}else{var Lt=R("state");H[Lt]=!0,nt=function(dt,D){if(B(dt,Lt))throw new M(L);return D.facade=dt,C(dt,Lt,D),D},K=function(dt){return B(dt,Lt)?dt[Lt]:{}},V=function(dt){return B(dt,Lt)}}g.exports={set:nt,get:K,has:V,enforce:tt,getterFor:kt}},6733:g=>{g.exports=function(_){return typeof _=="function"}},6541:(g,_,a)=>{var d=a(4229),p=a(6733),w=/#|\.prototype\./,x=function(H,L){var M=B[C(H)];return M==R?!0:M==I?!1:p(L)?d(L):!!L},C=x.normalize=function(H){return String(H).replace(w,".").toLowerCase()},B=x.data={},I=x.NATIVE="N",R=x.POLYFILL="P";g.exports=x},5052:(g,_,a)=>{var d=a(6733);g.exports=function(p){return typeof p=="object"?p!==null:d(p)}},4231:g=>{g.exports=!1},9395:(g,_,a)=>{var d=a(1333),p=a(6733),w=a(1321),x=a(6969),C=Object;g.exports=x?function(B){return typeof B=="symbol"}:function(B){var I=d("Symbol");return p(I)&&w(I.prototype,C(B))}},9646:(g,_,a)=>{var d=a(4237);g.exports=function(p){return d(p.length)}},6039:(g,_,a)=>{var d=a(4229),p=a(6733),w=a(8270),x=a(7400),C=a(1805).CONFIGURABLE,B=a(8511),I=a(6407),R=I.enforce,H=I.get,L=Object.defineProperty,M=x&&!d(function(){return L(function(){},"length",{value:8}).length!==8}),W=String(String).split("String"),nt=g.exports=function(K,V,tt){String(V).slice(0,7)==="Symbol("&&(V="["+String(V).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),tt&&tt.getter&&(V="get "+V),tt&&tt.setter&&(V="set "+V),(!w(K,"name")||C&&K.name!==V)&&(x?L(K,"name",{value:V,configurable:!0}):K.name=V),M&&tt&&w(tt,"arity")&&K.length!==tt.arity&&L(K,"length",{value:tt.arity});try{tt&&w(tt,"constructor")&&tt.constructor?x&&L(K,"prototype",{writable:!1}):K.prototype&&(K.prototype=void 0)}catch{}var kt=R(K);return w(kt,"source")||(kt.source=W.join(typeof V=="string"?V:"")),K};Function.prototype.toString=nt(function(){return p(this)&&H(this).source||B(this)},"toString")},917:g=>{var _=Math.ceil,a=Math.floor;g.exports=Math.trunc||function(p){var w=+p;return(w>0?a:_)(w)}},3839:(g,_,a)=>{var d=a(6358),p=a(4229);g.exports=!!Object.getOwnPropertySymbols&&!p(function(){var w=Symbol();return!String(w)||!(Object(w)instanceof Symbol)||!Symbol.sham&&d&&d<41})},8694:(g,_,a)=>{var d=a(9859),p=a(6733),w=a(8511),x=d.WeakMap;g.exports=p(x)&&/native code/.test(w(x))},1787:(g,_,a)=>{var d=a(7400),p=a(4394),w=a(7137),x=a(1176),C=a(9310),B=TypeError,I=Object.defineProperty,R=Object.getOwnPropertyDescriptor,H="enumerable",L="configurable",M="writable";_.f=d?w?function(nt,K,V){if(x(nt),K=C(K),x(V),typeof nt=="function"&&K==="prototype"&&"value"in V&&M in V&&!V[M]){var tt=R(nt,K);tt&&tt[M]&&(nt[K]=V.value,V={configurable:L in V?V[L]:tt[L],enumerable:H in V?V[H]:tt[H],writable:!1})}return I(nt,K,V)}:I:function(nt,K,V){if(x(nt),K=C(K),x(V),p)try{return I(nt,K,V)}catch{}if("get"in V||"set"in V)throw B("Accessors not supported");return"value"in V&&(nt[K]=V.value),nt}},7933:(g,_,a)=>{var d=a(7400),p=a(266),w=a(9195),x=a(5358),C=a(905),B=a(9310),I=a(8270),R=a(4394),H=Object.getOwnPropertyDescriptor;_.f=d?H:function(M,W){if(M=C(M),W=B(W),R)try{return H(M,W)}catch{}if(I(M,W))return x(!p(w.f,M,W),M[W])}},8151:(g,_,a)=>{var d=a(140),p=a(3837),w=p.concat("length","prototype");_.f=Object.getOwnPropertyNames||function(C){return d(C,w)}},894:(g,_)=>{_.f=Object.getOwnPropertySymbols},1321:(g,_,a)=>{var d=a(5968);g.exports=d({}.isPrototypeOf)},140:(g,_,a)=>{var d=a(5968),p=a(8270),w=a(905),x=a(9540).indexOf,C=a(5977),B=d([].push);g.exports=function(I,R){var H=w(I),L=0,M=[],W;for(W in H)!p(C,W)&&p(H,W)&&B(M,W);for(;R.length>L;)p(H,W=R[L++])&&(~x(M,W)||B(M,W));return M}},5632:(g,_,a)=>{var d=a(140),p=a(3837);g.exports=Object.keys||function(x){return d(x,p)}},9195:(g,_)=>{var a={}.propertyIsEnumerable,d=Object.getOwnPropertyDescriptor,p=d&&!a.call({1:2},1);_.f=p?function(x){var C=d(this,x);return!!C&&C.enumerable}:a},2914:(g,_,a)=>{var d=a(266),p=a(6733),w=a(5052),x=TypeError;g.exports=function(C,B){var I,R;if(B==="string"&&p(I=C.toString)&&!w(R=d(I,C))||p(I=C.valueOf)&&!w(R=d(I,C))||B!=="string"&&p(I=C.toString)&&!w(R=d(I,C)))return R;throw x("Can't convert object to primitive value")}},4826:(g,_,a)=>{var d=a(1333),p=a(5968),w=a(8151),x=a(894),C=a(1176),B=p([].concat);g.exports=d("Reflect","ownKeys")||function(R){var H=w.f(C(R)),L=x.f;return L?B(H,L(R)):H}},9276:(g,_,a)=>{var d=a(9859);g.exports=d},8885:g=>{var _=TypeError;g.exports=function(a){if(a==null)throw _("Can't call method on "+a);return a}},4399:(g,_,a)=>{var d=a(3036),p=a(1441),w=d("keys");g.exports=function(x){return w[x]||(w[x]=p(x))}},5353:(g,_,a)=>{var d=a(9859),p=a(8400),w="__core-js_shared__",x=d[w]||p(w,{});g.exports=x},3036:(g,_,a)=>{var d=a(4231),p=a(5353);(g.exports=function(w,x){return p[w]||(p[w]=x!==void 0?x:{})})("versions",[]).push({version:"3.23.3",mode:d?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"})},3231:(g,_,a)=>{var d=a(3329),p=Math.max,w=Math.min;g.exports=function(x,C){var B=d(x);return B<0?p(B+C,0):w(B,C)}},905:(g,_,a)=>{var d=a(9337),p=a(8885);g.exports=function(w){return d(p(w))}},3329:(g,_,a)=>{var d=a(917);g.exports=function(p){var w=+p;return w!==w||w===0?0:d(w)}},4237:(g,_,a)=>{var d=a(3329),p=Math.min;g.exports=function(w){return w>0?p(d(w),9007199254740991):0}},2991:(g,_,a)=>{var d=a(8885),p=Object;g.exports=function(w){return p(d(w))}},2066:(g,_,a)=>{var d=a(266),p=a(5052),w=a(9395),x=a(5300),C=a(2914),B=a(95),I=TypeError,R=B("toPrimitive");g.exports=function(H,L){if(!p(H)||w(H))return H;var M=x(H,R),W;if(M){if(L===void 0&&(L="default"),W=d(M,H,L),!p(W)||w(W))return W;throw I("Can't convert object to primitive value")}return L===void 0&&(L="number"),C(H,L)}},9310:(g,_,a)=>{var d=a(2066),p=a(9395);g.exports=function(w){var x=d(w,"string");return p(x)?x:x+""}},1601:(g,_,a)=>{var d=a(95),p=d("toStringTag"),w={};w[p]="z",g.exports=String(w)==="[object z]"},3326:(g,_,a)=>{var d=a(1589),p=String;g.exports=function(w){if(d(w)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return p(w)}},9821:g=>{var _=String;g.exports=function(a){try{return _(a)}catch{return"Object"}}},1441:(g,_,a)=>{var d=a(5968),p=0,w=Math.random(),x=d(1 .toString);g.exports=function(C){return"Symbol("+(C===void 0?"":C)+")_"+x(++p+w,36)}},6969:(g,_,a)=>{var d=a(3839);g.exports=d&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7137:(g,_,a)=>{var d=a(7400),p=a(4229);g.exports=d&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},95:(g,_,a)=>{var d=a(9859),p=a(3036),w=a(8270),x=a(1441),C=a(3839),B=a(6969),I=p("wks"),R=d.Symbol,H=R&&R.for,L=B?R:R&&R.withoutSetter||x;g.exports=function(M){if(!w(I,M)||!(C||typeof I[M]=="string")){var W="Symbol."+M;C&&w(R,M)?I[M]=R[M]:B&&H?I[M]=H(W):I[M]=L(W)}return I[M]}},3430:(g,_,a)=>{var d=a(3103),p=a(5968),w=a(7111),x=a(2991),C=a(9646),B=a(9563),I=a(3326),R=a(4229),H=a(3867),L=a(6038),M=a(2671),W=a(8506),nt=a(6358),K=a(9811),V=[],tt=p(V.sort),kt=p(V.push),v=R(function(){V.sort(void 0)}),P=R(function(){V.sort(null)}),mt=L("sort"),j=!R(function(){if(nt)return nt<70;if(!(M&&M>3)){if(W)return!0;if(K)return K<603;var D="",at,et,Z,At;for(at=65;at<76;at++){switch(et=String.fromCharCode(at),at){case 66:case 69:case 70:case 72:Z=3;break;case 68:case 71:Z=4;break;default:Z=2}for(At=0;At<47;At++)V.push({k:et+At,v:Z})}for(V.sort(function(Xt,It){return It.v-Xt.v}),At=0;At<V.length;At++)et=V[At].k.charAt(0),D.charAt(D.length-1)!==et&&(D+=et);return D!=="DGBEFHACIJK"}}),Lt=v||!P||!mt||!j,dt=function(D){return function(at,et){return et===void 0?-1:at===void 0?1:D!==void 0?+D(at,et)||0:I(at)>I(et)?1:-1}};d({target:"Array",proto:!0,forced:Lt},{sort:function(at){at!==void 0&&w(at);var et=x(this);if(j)return at===void 0?tt(et):tt(et,at);var Z=[],At=C(et),Xt,It;for(It=0;It<At;It++)It in et&&kt(Z,et[It]);for(H(Z,dt(at)),Xt=Z.length,It=0;It<Xt;)et[It]=Z[It++];for(;It<At;)B(et,It++);return et}})},4769:(g,_,a)=>{var d=a(3103),p=a(2991),w=a(5632),x=a(4229),C=x(function(){w(1)});d({target:"Object",stat:!0,forced:C},{keys:function(I){return w(p(I))}})},1388:(g,_,a)=>{a.d(_,{Z:()=>B});var d=a(272),p=a.n(d),w=a(2609),x=a.n(w),C=x()(p());C.push([g.id,`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition: background 250ms ease-in-out, transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`,"",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition: background 250ms ease-in-out, transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const B=C},7379:(g,_,a)=>{a.d(_,{Z:()=>B});var d=a(272),p=a.n(d),w=a(2609),x=a.n(w),C=x()(p());C.push([g.id,`\r
#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB",sourcesContent:[`\r
#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}`],sourceRoot:""}]);const B=C},2609:g=>{g.exports=function(_){var a=[];return a.toString=function(){return this.map(function(p){var w="",x=typeof p[5]<"u";return p[4]&&(w+="@supports (".concat(p[4],") {")),p[2]&&(w+="@media ".concat(p[2]," {")),x&&(w+="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {")),w+=_(p),x&&(w+="}"),p[2]&&(w+="}"),p[4]&&(w+="}"),w}).join("")},a.i=function(p,w,x,C,B){typeof p=="string"&&(p=[[null,p,void 0]]);var I={};if(x)for(var R=0;R<this.length;R++){var H=this[R][0];H!=null&&(I[H]=!0)}for(var L=0;L<p.length;L++){var M=[].concat(p[L]);x&&I[M[0]]||(typeof B<"u"&&(typeof M[5]>"u"||(M[1]="@layer".concat(M[5].length>0?" ".concat(M[5]):""," {").concat(M[1],"}")),M[5]=B),w&&(M[2]&&(M[1]="@media ".concat(M[2]," {").concat(M[1],"}")),M[2]=w),C&&(M[4]?(M[1]="@supports (".concat(M[4],") {").concat(M[1],"}"),M[4]=C):M[4]="".concat(C)),a.push(M))}},a}},272:g=>{g.exports=function(_){var a=_[1],d=_[3];if(!d)return a;if(typeof btoa=="function"){var p=btoa(unescape(encodeURIComponent(JSON.stringify(d)))),w="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(p),x="/*# ".concat(w," */"),C=d.sources.map(function(B){return"/*# sourceURL=".concat(d.sourceRoot||"").concat(B," */")});return[a].concat(C).concat([x]).join(`
`)}return[a].join(`
`)}}},ao={};function Tt(g){var _=ao[g];if(_!==void 0)return _.exports;var a=ao[g]={id:g,exports:{}};return Ia[g](a,a.exports,Tt),a.exports}Tt.n=g=>{var _=g&&g.__esModule?()=>g.default:()=>g;return Tt.d(_,{a:_}),_};Tt.d=(g,_)=>{for(var a in _)Tt.o(_,a)&&!Tt.o(g,a)&&Object.defineProperty(g,a,{enumerable:!0,get:_[a]})};Tt.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();Tt.o=(g,_)=>Object.prototype.hasOwnProperty.call(g,_);Tt.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var f={};(()=>{Tt.d(f,{fWn:()=>Qs,Ia8:()=>tr,rqv:()=>Sn,hLI:()=>Rs,yyv:()=>Wr,tX5:()=>Yi,vtX:()=>Ke,r7K:()=>Qn,lCh:()=>Pr,cE4:()=>wt,fwF:()=>ps,sce:()=>Ks,_c7:()=>Be,KUs:()=>Rr,Ajp:()=>Fs,RDh:()=>Ti,_H9:()=>yi,mxs:()=>ur,OmD:()=>ht,kBf:()=>Z,C4F:()=>fi,NQt:()=>bn,JjN:()=>qr,V1s:()=>Sr,Xz7:()=>di,Cdc:()=>wi,FKn:()=>Nt,wTW:()=>_e,SUY:()=>An,ab2:()=>_i,GfZ:()=>Ne,YMS:()=>us,oyv:()=>Ut,aUb:()=>As,SdD:()=>Qe,JUv:()=>qe,jEj:()=>Ss,TFq:()=>Ee,HDU:()=>as,R_y:()=>os,ydN:()=>bs,t50:()=>Te,s$$:()=>xn,v2G:()=>rt,Ilk:()=>D,s9i:()=>Zr,dxL:()=>Cs,LLX:()=>Yr,wA2:()=>re,R_p:()=>Zt,IQ$:()=>Ur,I5F:()=>Lt,X8$:()=>Lr,FR6:()=>rs,U8o:()=>je,kbG:()=>ne,iS_:()=>Zi,cGG:()=>jr,RPN:()=>Si,skb:()=>Nr,SLU:()=>Ji,RdJ:()=>$t,cNu:()=>fr,gU7:()=>Xn,LSk:()=>gr,Nmp:()=>Ai,d1Y:()=>zt,xrL:()=>un,sRW:()=>pn,cmV:()=>ro,qWz:()=>dr,N0Q:()=>cr,q8b:()=>Pt,ynB:()=>ee,jT9:()=>br,wAz:()=>Us,D4V:()=>Ns,N6H:()=>qi,W1A:()=>Qi,JHW:()=>Gt,v2K:()=>Ir,pBf:()=>hs,GMl:()=>ze,zW2:()=>g,B0K:()=>an,Nv7:()=>ci,C_p:()=>Ys,iqw:()=>Pe,MUA:()=>$i,xqU:()=>ji,pTp:()=>pr,vUK:()=>x,j9l:()=>mn,Zxw:()=>Ls,Hdx:()=>bi,Z$d:()=>vi,iqV:()=>Jr,o$7:()=>ei,olM:()=>At,Zm$:()=>ot,$QH:()=>Ye,i78:()=>Ze,h6u:()=>ct,hts:()=>Oe,j88:()=>Se,VME:()=>ue,nt:()=>Aa,Ukr:()=>ni,zsu:()=>te,oA6:()=>Kt,TVh:()=>Js,TwZ:()=>_n,GTT:()=>Jn,xxj:()=>Hr,XdK:()=>ns,Jmb:()=>fe,cXo:()=>Ki,Dm5:()=>N,IIB:()=>d,zI0:()=>gi,LYD:()=>Bi,cEG:()=>Gr,SEl:()=>pa,t9V:()=>so,SKZ:()=>Xe,__J:()=>ua,RI$:()=>Cr,x12:()=>Pn,ccz:()=>qt,aNw:()=>Gn,xwn:()=>yr,dNK:()=>xr,ini:()=>mt,YdH:()=>j,y3G:()=>Ct,l57:()=>Ve,xn0:()=>hn,t2V:()=>wn,uxB:()=>Ft,cpd:()=>kr,fiy:()=>ir,$XZ:()=>nr,uqK:()=>ds,STE:()=>Nn,y$z:()=>He,mAD:()=>Vr,sOq:()=>oe,hUw:()=>Ci,_0G:()=>fa,Sqs:()=>no,hpZ:()=>Ei,Vol:()=>Or,wIZ:()=>Q,cBi:()=>Fi,RFv:()=>ks,kfC:()=>Ii,mgq:()=>En,YVA:()=>Ot,Kgp:()=>On,HH$:()=>pe,M_d:()=>Ce,rgh:()=>be,Ra6:()=>de,KhR:()=>xe,BS5:()=>Yt,xhz:()=>ie,xOq:()=>Ae,a9j:()=>ye,bHk:()=>ce,CgK:()=>Ue,cuY:()=>Rt,kvE:()=>js,SBu:()=>li,AE_:()=>Br,ctO:()=>Fr,OLH:()=>Ar,kky:()=>I,nSF:()=>Ms,zHn:()=>$e,zwx:()=>zr,AeJ:()=>mi,hLz:()=>$n,D9g:()=>Er,wA:()=>er,jhr:()=>sr,GVs:()=>sn,_zO:()=>ai,w6$:()=>or,mhV:()=>rr,MOD:()=>ae,kwd:()=>hr,Lmr:()=>ar,xsS:()=>ti,lLr:()=>nn,Z$r:()=>dt,IXb:()=>vn,SGH:()=>Xr,SMj:()=>gs,L34:()=>Ta,exe:()=>ge,bnF:()=>Wt,MFA:()=>et,$uU:()=>Wn,jyi:()=>xs,E03:()=>hi,V6q:()=>Bs,rg2:()=>Cn,DVW:()=>ui,nVo:()=>vr,F6N:()=>io,xP7:()=>Ie,Odq:()=>Mr,Zif:()=>se,ZGJ:()=>cn,MJk:()=>to,xvT:()=>qs,PHM:()=>xi,dpR:()=>ut,n9L:()=>wr,KwO:()=>mr,B7y:()=>zs,x7r:()=>eo,wx7:()=>Zs,Uvn:()=>X,OFT:()=>dn,xzN:()=>Tr,M5Z:()=>R,ZrN:()=>p,OWs:()=>v,dF9:()=>ln,oZy:()=>ls,rD2:()=>cs,VHo:()=>is,ohE:()=>ys,R$E:()=>Hn,q3I:()=>Dr,Pab:()=>W,uZ5:()=>M,McK:()=>C,F9c:()=>H,k0b:()=>gn,hnT:()=>_a,RSJ:()=>xa,Mku:()=>wa,h90:()=>ba,rms:()=>ya,ErP:()=>ga,aVg:()=>va,lPc:()=>ma,Z8E:()=>qn,_N2:()=>$s,yFn:()=>oa,lNv:()=>Kn,cu9:()=>_r,MZQ:()=>Yn,FUM:()=>Zn,BxR:()=>lt,vdf:()=>tt,iaL:()=>kt,w6H:()=>V,Q4c:()=>sa,Xxe:()=>L,Uxb:()=>nt,Yr5:()=>K,Bhw:()=>P,yOA:()=>_});var g={};Tt.r(g),Tt.d(g,{ActivateEvent:()=>Yi,CollisionEndEvent:()=>Qe,CollisionPostSolveEvent:()=>as,CollisionPreSolveEvent:()=>os,CollisionStartEvent:()=>Te,ContactEndEvent:()=>rs,ContactStartEvent:()=>je,DeactivateEvent:()=>Zi,EnterTriggerEvent:()=>qi,EnterViewPortEvent:()=>Qi,EventTypes:()=>ze,ExitTriggerEvent:()=>$i,ExitViewPortEvent:()=>ji,GameEvent:()=>ot,GameStartEvent:()=>Ye,GameStopEvent:()=>Ze,GamepadAxisEvent:()=>ct,GamepadButtonEvent:()=>Oe,GamepadConnectEvent:()=>Se,GamepadDisconnectEvent:()=>ue,HiddenEvent:()=>ns,InitializeEvent:()=>N,KillEvent:()=>Xe,PostCollisionEvent:()=>pe,PostDebugDrawEvent:()=>Ce,PostDrawEvent:()=>be,PostFrameEvent:()=>de,PostKillEvent:()=>xe,PostUpdateEvent:()=>Yt,PreCollisionEvent:()=>ie,PreDebugDrawEvent:()=>Ae,PreDrawEvent:()=>ye,PreFrameEvent:()=>ce,PreKillEvent:()=>Ue,PreUpdateEvent:()=>Rt,VisibleEvent:()=>is});var _={};Tt.r(_),Tt.d(_,{getAttributeComponentSize:()=>zn,getAttributePointerType:()=>Un,getGlTypeSizeBytes:()=>en});var a={};Tt.r(a),Tt.d(a,{circle:()=>Ko,line:()=>rn,point:()=>qo,roundRect:()=>on,vector:()=>$o});var d={};Tt.r(d),Tt.d(d,{Axes:()=>ii,Buttons:()=>si,Gamepad:()=>ki,Gamepads:()=>Di,KeyEvent:()=>Mi,Keyboard:()=>Qr,Keys:()=>yn,NativePointerButton:()=>fs,PointerButton:()=>Je,PointerComponent:()=>ks,PointerEvent:()=>ri,PointerEventReceiver:()=>Ri,PointerScope:()=>Os,PointerSystem:()=>Ii,PointerType:()=>ts,WheelDeltaMode:()=>Hs,WheelEvent:()=>$r});var p={};Tt.r(p),Tt.d(p,{ConsoleAppender:()=>Lt,DrawUtil:()=>a,EasingFunctions:()=>Pt,LogLevel:()=>mt,Logger:()=>j,Observable:()=>He,ScreenAppender:()=>dt,addItemToArray:()=>It,contains:()=>We,delay:()=>Re,fail:()=>Ge,getPosition:()=>Xt,removeItemFromArray:()=>Qt}),Tt(4662),Tt(8343);function w(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(r){window.setInterval(r,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((s,i)=>{t.call(this,e,s,i)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1)}class x{static useCanvasGraphicsContext(){x.enable("use-canvas-context")}static freeze(){x._FROZEN=!0}static _reset(){x._FROZEN=!1,x._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");x._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");x._FLAGS[t]=!1}static isEnabled(t){return!!x._FLAGS[t]}static show(){return Object.keys(x._FLAGS)}}x._FROZEN=!1,x._FLAGS={};function C(r,t){return{type:r,value:t}}const B=4294967295;class I{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let e=1;e<this._n;e++){const s=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((s&4294901760)>>>16)<<16)+this._f*(s&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,s=0;for(;s<this._n-this._m;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+this._m]^e>>>1^t[e&1]&B;for(;s<this._n-1;s++)e=this._mt[s]&this._upperMask|this._mt[s+1]&this._lowerMask,this._mt[s]=this._mt[s+(this._m-this._n)]^e>>>1^t[e&1]&B;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&B,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,s=!1){return s?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const s=new Array(e);let i=0;const n=t.slice(0);for(;i<e;){const o=this.integer(0,n.length-1);s[i++]=n[o],n.splice(o,1)}return s}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const s=new Array(e);for(let i=0;i<e;i++)s[i]=this.pickOne(t);return s}shuffle(t){const e=t.slice(0);let s=null;for(let i=0;i<e.length-2;i++){const n=this.integer(i,e.length-1);s=e[i],e[i]=e[n],e[n]=s}return e}range(t,e,s){const i=new Array(t);for(let n=0;n<t;n++)i[n]=this.integer(e,s);return i}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const R=Math.PI*2;function H(r){return r>=0?r-Math.floor(r):r-Math.ceil(r)}function L(r){return r===0?0:r<0?-1:1}function M(r,t,e){return Math.min(Math.max(t,r),e)}function W(r){let t=r;if(r>R)for(;t>R;)t-=R;if(r<0)for(;t<0;)t+=R;return t}function nt(r){return 180/Math.PI*r}function K(r){return r/180*Math.PI}const V=(r,t)=>Array.from(new Array(t-r+1),(e,s)=>s+r);function tt(r,t,e=new I){return e?e.floating(r,t):r+Math.random()*(t-r)}function kt(r,t,e=new I){return e?e.integer(r,t):Math.round(tt(r,t))}class v{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new v(0,0)}static get One(){return new v(1,1)}static get Half(){return new v(.5,.5)}static get Up(){return new v(0,-1)}static get Down(){return new v(0,1)}static get Left(){return new v(-1,0)}static get Right(){return new v(1,0)}static fromAngle(t){return new v(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new v(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new v(Math.max(t.x,e.x),Math.max(t.y,e.y))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}squareDistance(t){t||(t=v.Zero);const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}clampMagnitude(t){const e=this.size,s=M(e,0,t);return this.size=s,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new v(this.x/t,this.y/t):new v(0,1)}average(t){return this.add(t).scale(.5)}scale(t,e){const s=e||new v(0,0);return t instanceof v?(s.x=this.x*t.x,s.y=this.y*t.y):(s.x=this.x*t,s.y=this.y*t),s}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new v(this.x+t.x,this.y+t.y)}sub(t){return new v(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof v)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new v(t*this.y,-t*this.x)}static cross(t,e){return new v(-t*e.y,t*e.x)}perpendicular(){return new v(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new v(0,0));const s=Math.sin(t),i=Math.cos(t),n=i*(this.x-e.x)-s*(this.y-e.y)+e.x,o=s*(this.x-e.x)+i*(this.y-e.y)+e.y;return new v(n,o)}clone(t){const e=t??new v(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}function P(r,t){return new v(r,t)}var mt;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Fatal=4]="Fatal"})(mt||(mt={}));class j{constructor(){if(this._appenders=[],this.defaultLevel=mt.Info,j._INSTANCE)throw new Error("Logger is a singleton");return j._INSTANCE=this,j._INSTANCE.addAppender(new Lt),j._INSTANCE}static getInstance(){return j._INSTANCE==null&&(j._INSTANCE=new j),j._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const s=this._appenders.length;for(let i=0;i<s;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)}debug(...t){this._log(mt.Debug,t)}info(...t){this._log(mt.Info,t)}warn(...t){this._log(mt.Warn,t)}error(...t){this._log(mt.Error,t)}fatal(...t){this._log(mt.Fatal,t)}}j._INSTANCE=null;class Lt{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const s=[];s.unshift.apply(s,e),s.unshift("["+mt[t]+"] : "),t<mt.Warn?console.log.apply?console.log.apply(console,s):console.log(s.join(" ")):t<mt.Error?console.warn.apply?console.warn.apply(console,s):console.warn(s.join(" ")):console.error.apply?console.error.apply(console,s):console.error(s.join(" "))}}class dt{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const s=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+mt[t]+"] : "+s);let i=10,n=1;for(let o=0;o<this._messages.length;o++)this._ctx.fillStyle="rgba(255,255,255,"+n.toFixed(2)+")",this._ctx.fillText(this._messages[o],200,i),i+=10,n=n>0?n-.05:0}}class D{constructor(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i??1}static fromRGB(t,e,s,i){return new D(t,e,s,i)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let s=null;if(s=t.match(e)){const i=parseInt(s[1],10),n=parseInt(s[2],10),o=parseInt(s[3],10);let h=1;return s[4]&&(h=parseFloat(s[4])),new D(i,n,o,h)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let s=null;if(s=t.match(e)){const i=parseInt(s[1],16),n=parseInt(s[2],16),o=parseInt(s[3],16);let h=1;return s[4]&&(h=parseInt(s[4],16)/255),new D(i,n,o,h)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,s,i=1){return new at(t,e,s,i).toRGBA()}lighten(t=.1){const e=at.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=at.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=at.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=at.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,s=t.g/255*this.g/255*255,i=t.b/255*this.b/255*255,n=t.a*this.a;return new D(e,s,i,n)}screen(t){const e=t.invert(),s=t.invert();return e.multiply(s).invert()}invert(){return new D(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,s=(t.g+this.g)/2,i=(t.b+this.b)/2,n=(t.a+this.a)/2;return new D(e,s,i,n)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return e.length===1?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return at.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new D(this.r,this.g,this.b,this.a)}static get Black(){return D.fromHex("#000000")}static get White(){return D.fromHex("#FFFFFF")}static get Gray(){return D.fromHex("#808080")}static get LightGray(){return D.fromHex("#D3D3D3")}static get DarkGray(){return D.fromHex("#A9A9A9")}static get Yellow(){return D.fromHex("#FFFF00")}static get Orange(){return D.fromHex("#FFA500")}static get Red(){return D.fromHex("#FF0000")}static get Vermilion(){return D.fromHex("#FF5B31")}static get Rose(){return D.fromHex("#FF007F")}static get Magenta(){return D.fromHex("#FF00FF")}static get Violet(){return D.fromHex("#7F00FF")}static get Blue(){return D.fromHex("#0000FF")}static get Azure(){return D.fromHex("#007FFF")}static get Cyan(){return D.fromHex("#00FFFF")}static get Viridian(){return D.fromHex("#59978F")}static get Green(){return D.fromHex("#00FF00")}static get Chartreuse(){return D.fromHex("#7FFF00")}static get Transparent(){return D.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return D.fromHex("#176BAA")}}class at{constructor(t,e,s,i){this.h=t,this.s=e,this.l=s,this.a=i}static hue2rgb(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}static fromRGBA(t,e,s,i){t/=255,e/=255,s/=255;const n=Math.max(t,e,s),o=Math.min(t,e,s);let h,l;const c=(n+o)/2;if(n===o)h=l=0;else{const u=n-o;switch(l=c>.5?u/(2-n-o):u/(n+o),n){case t:h=(e-s)/u+(e<s?6:0);break;case e:h=(s-t)/u+2;break;case s:h=(t-e)/u+4;break}h/=6}return new at(h,l,c,i)}toRGBA(){let t,e,s;if(this.s===0)t=e=s=this.l;else{const i=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,n=2*this.l-i;t=at.hue2rgb(n,i,this.h+1/3),e=at.hue2rgb(n,i,this.h),s=at.hue2rgb(n,i,this.h-1/3)}return new D(t*255,e*255,s*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),s=this.l.toFixed(0),i=this.a.toFixed(0);return`hsla(${t}, ${e}, ${s}, ${i})`}}var et;(function(r){r.None="None",r.Top="Top",r.Bottom="Bottom",r.Left="Left",r.Right="Right"})(et||(et={})),function(r){function t(s){return s===r.Top?r.Bottom:s===r.Bottom?r.Top:s===r.Left?r.Right:s===r.Right?r.Left:r.None}r.getOpposite=t;function e(s){const i=[v.Left,v.Right,v.Up,v.Down],n=[r.Left,r.Right,r.Top,r.Bottom];let o=-Number.MAX_VALUE,h=-1;for(let l=0;l<i.length;l++)i[l].dot(s)>o&&(o=i[l].dot(s),h=l);return n[h]}r.fromDirection=e}(et||(et={}));class Z{constructor(t=0,e=0,s=0,i=0){typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=s,this.bottom=i)}clone(){return new Z(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?et.Right:et.Left:t.y<0?et.Bottom:et.Top:et.None}static fromPoints(t){let e=1/0,s=1/0,i=-1/0,n=-1/0;for(let o=0;o<t.length;o++)t[o].x<e&&(e=t[o].x),t[o].x>i&&(i=t[o].x),t[o].y<s&&(s=t[o].y),t[o].y>n&&(n=t[o].y);return new Z(e,s,i,n)}static fromDimension(t,e,s=v.Half,i=v.Zero){return new Z(-t*s.x+i.x,-e*s.y+i.y,t-t*s.x+i.x,e-e*s.y+i.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new v((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new Z(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=v.Zero){const s=this.getPoints().map(i=>i.rotate(t,e));return Z.fromPoints(s)}scale(t,e=v.Zero){const s=this.translate(e);return new Z(s.left*t.x,s.top*t.y,s.right*t.x,s.bottom*t.y)}transform(t){const e=t.data[0]*this.left,s=t.data[1]*this.left,i=t.data[0]*this.right,n=t.data[1]*this.right,o=t.data[2]*this.top,h=t.data[3]*this.top,l=t.data[2]*this.bottom,c=t.data[3]*this.bottom,u=t.getPosition(),m=Math.min(e,i)+Math.min(o,l)+u.x,y=Math.min(s,n)+Math.min(h,c)+u.y,A=Math.max(e,i)+Math.max(o,l)+u.x,F=Math.max(s,n)+Math.max(h,c)+u.y;return new Z({left:m,top:y,right:A,bottom:F})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){const t=[];return t.push(new v(this.left,this.top)),t.push(new v(this.right,this.top)),t.push(new v(this.right,this.bottom)),t.push(new v(this.left,this.bottom)),t}rayCast(t,e=1/0){let s=-1/0,i=1/0;const n=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,h=(this.left-t.pos.x)*n,l=(this.right-t.pos.x)*n;s=Math.min(h,l),i=Math.max(h,l);const c=(this.top-t.pos.y)*o,u=(this.bottom-t.pos.y)*o;return s=Math.max(s,Math.min(c,u)),i=Math.min(i,Math.max(c,u)),i>=Math.max(0,s)&&s<e}rayCastTime(t,e=1/0){let s=-1/0,i=1/0;const n=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,h=(this.left-t.pos.x)*n,l=(this.right-t.pos.x)*n;s=Math.min(h,l),i=Math.max(h,l);const c=(this.top-t.pos.y)*o,u=(this.bottom-t.pos.y)*o;return s=Math.max(s,Math.min(c,u)),i=Math.min(i,Math.max(c,u)),i>=Math.max(0,s)&&s<e?s:-1}contains(t){return t instanceof v?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof Z?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t){return new Z(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new v(this.width,this.height)}overlaps(t,e){const s=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const i=this.combine(t);return i.width+s<t.width+this.width&&i.height+s<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let s=0;this.right>=t.left&&this.right<=t.right?s=t.left-this.right:s=t.right-this.left;let i=0;return this.top<=t.bottom&&this.top>=t.top?i=t.bottom-this.top:i=t.top-this.bottom,Math.abs(s)<Math.abs(i)?new v(s,0):new v(0,i)}else if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let s=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?s=t.left-this.right:s=t.right-this.left:t.right-this.right<=this.left-t.left?s=this.left-t.right:s=this.right-t.left;let i=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?i=t.top-this.bottom:i=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?i=this.top-t.bottom:i=this.bottom-t.top,Math.abs(s)<Math.abs(i)?new v(s,0):new v(0,i)}else return null}intersectWithSide(t){const e=this.intersect(t);return Z.getSideFromIntersection(e)}draw(t,e=D.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}class At{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}function Xt(r){let t=0,e=0;const s=n=>{t+=n.offsetLeft,n.offsetParent&&s(n.offsetParent)},i=n=>{e+=n.offsetTop,n.offsetParent&&i(n.offsetParent)};return s(r),i(r),new v(t,e)}function It(r,t){return t.indexOf(r)===-1?(t.push(r),!0):!1}function Qt(r,t){let e=-1;return(e=t.indexOf(r))>-1?(t.splice(e,1),!0):!1}function We(r,t){for(let e=0;e<r.length;e++)if(r[e]===t)return!0;return!1}function Ge(r){throw new Error(r)}function Re(r,t){var e;const s=new At;return((e=t==null?void 0:t.schedule.bind(t))!==null&&e!==void 0?e:setTimeout)(()=>{s.resolve()},r),s.promise}var Ve;(function(r){r[r.X=12]="X",r[r.Y=13]="Y"})(Ve||(Ve={}));class Ct{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,s,i,n,o){const h=new Ct;return h.data[0]=2/(e-t),h.data[1]=0,h.data[2]=0,h.data[3]=0,h.data[4]=0,h.data[5]=2/(i-s),h.data[6]=0,h.data[7]=0,h.data[8]=0,h.data[9]=0,h.data[10]=-2/(o-n),h.data[11]=0,h.data[12]=-(e+t)/(e-t),h.data[13]=-(i+s)/(i-s),h.data[14]=-(o+n)/(o-n),h.data[15]=1,h}clone(t){const e=t||new Ct;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Ct;return e.data=t,e}static identity(){const t=new Ct;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const s=Ct.identity();return s.data[12]=t,s.data[13]=e,s}static scale(t,e){const s=Ct.identity();return s.data[0]=t,s.data[5]=e,s.data[10]=1,s.data[15]=1,s}static rotation(t){const e=Ct.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof v){const s=e||new v(0,0),i=t,n=i.x*this.data[0]+i.y*this.data[4]+this.data[12],o=i.x*this.data[1]+i.y*this.data[5]+this.data[13];return s.x=n,s.y=o,s}else{const s=e||new Ct,i=t,n=this.data[0],o=this.data[1],h=this.data[2],l=this.data[3],c=this.data[4],u=this.data[5],m=this.data[6],y=this.data[7],A=this.data[8],F=this.data[9],z=this.data[10],U=this.data[11],S=this.data[12],T=this.data[13],Y=this.data[14],G=this.data[15],st=i.data[0],$=i.data[1],k=i.data[2],vt=i.data[3],yt=i.data[4],bt=i.data[5],ft=i.data[6],Vt=i.data[7],Fe=i.data[8],Me=i.data[9],Ts=i.data[10],Ps=i.data[11],Es=i.data[12],Is=i.data[13],it=i.data[14],zi=i.data[15];s.data[0]=n*st+c*$+A*k+S*vt,s.data[1]=o*st+u*$+F*k+T*vt,s.data[2]=h*st+m*$+z*k+Y*vt,s.data[3]=l*st+y*$+U*k+G*vt,s.data[4]=n*yt+c*bt+A*ft+S*Vt,s.data[5]=o*yt+u*bt+F*ft+T*Vt,s.data[6]=h*yt+m*bt+z*ft+Y*Vt,s.data[7]=l*yt+y*bt+U*ft+G*Vt,s.data[8]=n*Fe+c*Me+A*Ts+S*Ps,s.data[9]=o*Fe+u*Me+F*Ts+T*Ps,s.data[10]=h*Fe+m*Me+z*Ts+Y*Ps,s.data[11]=l*Fe+y*Me+U*Ts+G*Ps,s.data[12]=n*Es+c*Is+A*it+S*zi,s.data[13]=o*Es+u*Is+F*it+T*zi,s.data[14]=h*Es+m*Is+z*it+Y*zi,s.data[15]=l*Es+y*Is+U*it+G*zi;const oo=this.getScale();return s._scaleSignX=L(oo.x)*L(s._scaleSignX),s._scaleSignY=L(oo.y)*L(s._scaleSignY),s}}translate(t,e){const s=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3],h=this.data[4],l=this.data[5],c=this.data[6],u=this.data[7],m=this.data[8],y=this.data[9],A=this.data[10],F=this.data[11],z=this.data[12],U=this.data[13],S=this.data[14],T=this.data[15],Y=0,G=1;return this.data[12]=s*t+h*e+m*Y+z*G,this.data[13]=i*t+l*e+y*Y+U*G,this.data[14]=n*t+c*e+A*Y+S*G,this.data[15]=o*t+u*e+F*Y+T*G,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return P(this.data[12],this.data[13])}rotate(t){const e=this.data[0],s=this.data[1],i=this.data[2],n=this.data[3],o=this.data[4],h=this.data[5],l=this.data[6],c=this.data[7],u=Math.sin(t),m=Math.cos(t);return this.data[0]=m*e+u*o,this.data[1]=m*s+u*h,this.data[2]=m*i+u*l,this.data[3]=m*n+u*c,this.data[4]=m*o-u*e,this.data[5]=m*h-u*s,this.data[6]=m*l-u*i,this.data[7]=m*c-u*n,this}scale(t,e){const s=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3],h=this.data[4],l=this.data[5],c=this.data[6],u=this.data[7];return this.data[0]=s*t,this.data[1]=i*t,this.data[2]=n*t,this.data[3]=o*t,this.data[4]=h*e,this.data[5]=l*e,this.data[6]=c*e,this.data[7]=u*e,this}setRotation(t){const e=this.getScale(),s=Math.sin(t),i=Math.cos(t);this.data[0]=i*e.x,this.data[1]=s*e.y,this.data[4]=-s*e.x,this.data[5]=i*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return W(t)}getScaleX(){const t=P(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=P(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return P(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=L(t);const e=P(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=L(t);const e=P(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const s=1/this.getBasisDeterminant(),i=this.data[0],n=this.data[4],o=this.data[1],h=this.data[5],l=t||Ct.identity();l.data[0]=h*s,l.data[1]=-o*s,l.data[4]=-n*s,l.data[5]=i*s;const c=this.data[12],u=this.data[13];return l.data[12]=-(c*l.data[0]+u*l.data[4]),l.data[13]=-(c*l.data[1]+u*l.data[5]),l}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class wt{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new wt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const s=wt.identity();return s.data[4]=t,s.data[5]=e,s}static scale(t,e){const s=wt.identity();return s.data[0]=t,s.data[3]=e,s._scale[0]=t,s._scale[1]=e,s}static rotation(t){const e=wt.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return P(this.data[4],this.data[5])}rotate(t){const e=this.data[0],s=this.data[1],i=this.data[2],n=this.data[3],o=Math.sin(t),h=Math.cos(t);return this.data[0]=h*e+o*i,this.data[1]=h*s+o*n,this.data[2]=h*i-o*e,this.data[3]=h*n-o*s,this}translate(t,e){const s=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3],h=this.data[4],l=this.data[5];return this.data[4]=s*t+n*e+h,this.data[5]=i*t+o*e+l,this}scale(t,e){const s=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3];return this.data[0]=s*t,this.data[1]=i*t,this.data[2]=n*e,this.data[3]=o*e,this._scale[0]=t,this._scale[1]=e,this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const s=1/this.determinant(),i=this.data[0],n=this.data[2],o=this.data[1],h=this.data[3],l=t||wt.identity();l.data[0]=h*s,l.data[1]=-o*s,l.data[2]=-n*s,l.data[3]=i*s;const c=this.data[4],u=this.data[5];return l.data[4]=-(c*l.data[0]+u*l.data[2]),l.data[5]=-(c*l.data[1]+u*l.data[3]),l}multiply(t,e){if(t instanceof v){const s=e||new v(0,0),i=t,n=i.x*this.data[0]+i.y*this.data[2]+this.data[4],o=i.x*this.data[1]+i.y*this.data[3]+this.data[5];return s.x=n,s.y=o,s}else{const s=e||new wt,i=t,n=this.data[0],o=this.data[1],h=this.data[2],l=this.data[3],c=this.data[4],u=this.data[5],m=i.data[0],y=i.data[1],A=i.data[2],F=i.data[3],z=i.data[4],U=i.data[5];s.data[0]=n*m+h*y,s.data[1]=o*m+l*y,s.data[2]=n*A+h*F,s.data[3]=o*A+l*F,s.data[4]=n*z+h*U+c,s.data[5]=o*z+l*U+u;const S=this.getScale();return s._scaleSignX=L(S.x)*L(s._scaleSignX),s._scaleSignY=L(S.y)*L(s._scaleSignY),s}}to4x4(){const t=new Ct;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),s=Math.sin(t),i=Math.cos(t);this.data[0]=i*e.x,this.data[1]=s*e.y,this.data[2]=-s*e.x,this.data[3]=i*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return W(t)}getScaleX(){const t=P(this.data[0],this.data[2]).distance();return this._scaleSignX*t}getScaleY(){const t=P(this.data[1],this.data[3]).distance();return this._scaleSignY*t}getScale(){return P(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=L(t);const e=P(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=L(t);const e=P(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new wt;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class ws{constructor(){this._transforms=[],this._currentTransform=wt.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Le{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1,z:0,tint:D.White}}_cloneState(){return{opacity:this._currentState.opacity,z:this._currentState.z,tint:this._currentState.tint.clone()}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}set current(t){this._currentState=t}}var ze;(function(r){r.Kill="kill",r.PreKill="prekill",r.PostKill="postkill",r.PreDraw="predraw",r.PostDraw="postdraw",r.PreDebugDraw="predebugdraw",r.PostDebugDraw="postdebugdraw",r.PreUpdate="preupdate",r.PostUpdate="postupdate",r.PreFrame="preframe",r.PostFrame="postframe",r.PreCollision="precollision",r.CollisionStart="collisionstart",r.CollisionEnd="collisionend",r.PostCollision="postcollision",r.Initialize="initialize",r.Activate="activate",r.Deactivate="deactivate",r.ExitViewport="exitviewport",r.EnterViewport="enterviewport",r.ExitTrigger="exit",r.EnterTrigger="enter",r.Connect="connect",r.Disconnect="disconnect",r.Button="button",r.Axis="axis",r.Visible="visible",r.Hidden="hidden",r.Start="start",r.Stop="stop",r.PointerUp="pointerup",r.PointerDown="pointerdown",r.PointerMove="pointermove",r.PointerEnter="pointerenter",r.PointerLeave="pointerleave",r.PointerCancel="pointercancel",r.PointerWheel="pointerwheel",r.Up="up",r.Down="down",r.Move="move",r.Enter="enter",r.Leave="leave",r.Cancel="cancel",r.Wheel="wheel",r.Press="press",r.Release="release",r.Hold="hold",r.PointerDragStart="pointerdragstart",r.PointerDragEnd="pointerdragend",r.PointerDragEnter="pointerdragenter",r.PointerDragLeave="pointerdragleave",r.PointerDragMove="pointerdragmove"})(ze||(ze={}));class ot{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class Xe extends ot{constructor(t){super(),this.target=t}}class Ue extends ot{constructor(t){super(),this.target=t}}class xe extends ot{constructor(t){super(),this.target=t}}class Ye extends ot{constructor(t){super(),this.target=t}}class Ze extends ot{constructor(t){super(),this.target=t}}class ye extends ot{constructor(t,e,s){super(),this.ctx=t,this.delta=e,this.target=s}}class be extends ot{constructor(t,e,s){super(),this.ctx=t,this.delta=e,this.target=s}}class Ae extends ot{constructor(t,e){super(),this.ctx=t,this.target=e}}class Ce extends ot{constructor(t,e){super(),this.ctx=t,this.target=e}}class Rt extends ot{constructor(t,e,s){super(),this.engine=t,this.delta=e,this.target=s}}class Yt extends ot{constructor(t,e,s){super(),this.engine=t,this.delta=e,this.target=s}}class ce extends ot{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class de extends ot{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class Se extends ot{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class ue extends ot{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Oe extends ot{constructor(t,e,s){super(),this.button=t,this.value=e,this.target=s}}class ct extends ot{constructor(t,e,s){super(),this.axis=t,this.value=e,this.target=s}}class is extends ot{constructor(t){super(),this.target=t}}class ns extends ot{constructor(t){super(),this.target=t}}class ie extends ot{constructor(t,e,s,i){super(),this.other=e,this.side=s,this.intersection=i,this.target=t}}class pe extends ot{constructor(t,e,s,i){super(),this.other=e,this.side=s,this.intersection=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class je{constructor(t,e,s){this.target=t,this.other=e,this.contact=s}}class rs{constructor(t,e){this.target=t,this.other=e}}class os{constructor(t,e,s,i,n){this.target=t,this.other=e,this.side=s,this.intersection=i,this.contact=n}}class as{constructor(t,e,s,i,n){this.target=t,this.other=e,this.side=s,this.intersection=i,this.contact=n}}class Te extends ot{constructor(t,e,s){super(),this.other=e,this.contact=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Qe extends ot{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class N extends ot{constructor(t,e){super(),this.engine=t,this.target=e}}class Yi extends ot{constructor(t,e){super(),this.context=t,this.target=e}}class Zi extends ot{constructor(t,e){super(),this.context=t,this.target=e}}class ji extends ot{constructor(t){super(),this.target=t}}class Qi extends ot{constructor(t){super(),this.target=t}}class qi extends ot{constructor(t,e){super(),this.target=t,this.actor=e}}class $i extends ot{constructor(t,e){super(),this.target=t,this.actor=e}}class hs{constructor(){this._handlers={},this._wiredEventDispatchers=[],this._deferedHandlerRemovals=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}_processDeferredHandlerRemovals(){for(const t of this._deferedHandlerRemovals)this._removeHandler(t.name,t.handler);this._deferedHandlerRemovals.length=0}emit(t,e){if(this._processDeferredHandlerRemovals(),!t)return;t=t.toLowerCase(),e||(e=new ot);let s,i;if(this._handlers[t])for(s=0,i=this._handlers[t].length,s;s<i;s++)this._handlers[t][s](e);for(s=0,i=this._wiredEventDispatchers.length,s;s<i;s++)this._wiredEventDispatchers[s].emit(t,e)}on(t,e){this._processDeferredHandlerRemovals(),t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e)}off(t,e){this._deferedHandlerRemovals.push({name:t,handler:e})}_removeHandler(t,e){t=t.toLowerCase();const s=this._handlers[t];if(s)if(!e)this._handlers[t].length=0;else{const i=s.indexOf(e);i>-1&&this._handlers[t].splice(i,1)}}once(t,e){this._processDeferredHandlerRemovals();const s=i=>{const n=i||new ot;this.off(t,s),e(n)};this.on(t,s)}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class ai{constructor(t,e,s=!0){this.path=t,this.responseType=e,this.bustCache=s,this.data=null,this.logger=j.getInstance(),this.events=new hs}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const s=new XMLHttpRequest;s.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),s.responseType=this.responseType,s.addEventListener("loadstart",i=>this.events.emit("loadstart",i)),s.addEventListener("progress",i=>this.events.emit("progress",i)),s.addEventListener("error",i=>this.events.emit("error",i)),s.addEventListener("load",i=>this.events.emit("load",i)),s.addEventListener("load",()=>{if(s.status!==0&&s.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",s.status),this.events.emit("error",s.response),e(new Error(s.statusText));return}this.data=s.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),s.send()})}}function vs(r,t){return r&&(r.__isProxy===void 0?new Proxy(r,{set:(e,s,i)=>(e[s]!==i&&(e[s]=i,typeof s=="string"&&s[0]!=="_"&&t(e)),!0),get:(e,s)=>s!=="__isProxy"?e[s]:!0}):r)}function Ln(r,t){return r&&(r.__isProxy===void 0?new Proxy(r,{set:(e,s,i)=>(e[s]=i,typeof s=="string"&&s[0]!=="_"&&t(e),!0),get:(e,s)=>s!=="__isProxy"?e[s]:!0}):r)}class te{constructor(t){var e,s,i,n,o,h;this.id=te._ID++,this.transform=wt.identity(),this.tint=null,this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=v.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=(e=t.origin)!==null&&e!==void 0?e:this.origin,this.flipHorizontal=(s=t.flipHorizontal)!==null&&s!==void 0?s:this.flipHorizontal,this.flipVertical=(i=t.flipVertical)!==null&&i!==void 0?i:this.flipVertical,this.rotation=(n=t.rotation)!==null&&n!==void 0?n:this.rotation,this.opacity=(o=t.opacity)!==null&&o!==void 0?o:this.opacity,this.scale=(h=t.scale)!==null&&h!==void 0?h:this.scale)}isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=vs(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=vs(t,()=>{this._transformStale=!0}),this._transformStale=!0}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return Z.fromDimension(this.width,this.height,v.Zero)}draw(t,e,s){this._preDraw(t,e,s),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,s){t.save(),t.translate(e,s),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const s=this.scale.x>0?1:-1,i=this.scale.y>0?1:-1,n=(e=this.origin)!==null&&e!==void 0?e:P(this.width/2,this.height/2);t.translate(n.x,n.y),t.rotate(this.rotation),t.scale(s,i),t.translate(-n.x,-n.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}te._ID=0;class xs extends te{constructor(t){var e,s;super(t),this._logger=j.getInstance(),this._dirty=!0,this._logNotLoadedWarning=!1,this.image=t.image;const{width:i,height:n}=t;this.sourceView=(e=t.sourceView)!==null&&e!==void 0?e:{x:0,y:0,width:i??0,height:n??0},this.destSize=(s=t.destSize)!==null&&s!==void 0?s:{width:i??0,height:n??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}static from(t){return new xs({image:t})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,s,i,n,o;const{width:h,height:l}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||h,this.sourceView.height=((e=this.sourceView)===null||e===void 0?void 0:e.height)||l,this.destSize.width=((s=this.destSize)===null||s===void 0?void 0:s.width)||((i=this.sourceView)===null||i===void 0?void 0:i.width)||h,this.destSize.height=((n=this.destSize)===null||n===void 0?void 0:n.height)||((o=this.sourceView)===null||o===void 0?void 0:o.height)||l,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,s){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,s)}_drawImage(t,e,s){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,s,this.destSize.width,this.destSize.height):(this._logNotLoadedWarning||this._logger.warn(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`),this._logNotLoadedWarning=!0)}clone(){return new xs({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var fe;(function(r){r.Pixel="Pixel",r.Blended="Blended"})(fe||(fe={}));class ut{static register(t){ut._GL=t,ut._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}static get(t){return ut._TEXTURE_MAP.get(t)}static has(t){return ut._TEXTURE_MAP.has(t)}static load(t,e,s=!1){const i=ut._GL;if(!i)return null;let n=null;if(ut.has(t)&&(n=ut.get(t)),n)return s&&(i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)),n;n=i.createTexture(),ut.checkImageSizeSupportedAndLog(t),i.bindTexture(i.TEXTURE_2D,n),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);const o=e??ut.filtering;return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,o===fe.Pixel?i.NEAREST:i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,o===fe.Pixel?i.NEAREST:i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),ut._TEXTURE_MAP.set(t,n),n}static delete(t){const e=ut._GL;if(!e)return null;let s=null;ut.has(t)&&(s=ut.get(t),e.deleteTexture(s))}static checkImageSizeSupportedAndLog(t){var e;const s=(e=t.dataset.originalSrc)!==null&&e!==void 0?e:"internal canvas bitmap";return t.width>ut._MAX_TEXTURE_SIZE||t.height>ut._MAX_TEXTURE_SIZE?(ut._LOGGER.error(`The image [${s}] provided to Excalibur is too large for the device's maximum texture size of (${ut._MAX_TEXTURE_SIZE}x${ut._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&ut._LOGGER.warn(`The image [${s}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}ut._LOGGER=j.getInstance(),ut.filtering=fe.Blended,ut._TEXTURE_MAP=new Map,ut._MAX_TEXTURE_SIZE=0;class Ki{constructor(t,e=!1,s){this.path=t,this._logger=j.getInstance(),this.data=new Image,this._readyFuture=new At,this.ready=this._readyFuture.promise,this._resource=new ai(t,"blob",e),this._filtering=s,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`)}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}async load(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{const i=await this._resource.load();t=URL.createObjectURL(i)}const e=new Image,s=new At;e.onload=()=>s.resolve(),e.src=t,e.setAttribute("data-original-src",this.path),await s.promise,this.data=e}catch(t){throw`Error loading ImageSource from path '${this.path}' with error [${t.message}]`}return ut.load(this.data,this._filtering),this._readyFuture.resolve(this.data),this.data}toSprite(){return xs.from(this)}unload(){this.data=new Image}}class Bs{constructor(t){this._logger=j.getInstance(),this.sprites=[];const{sprites:e,rows:s,columns:i}=t;this.sprites=e,this.rows=s??1,this.columns=i??this.sprites.length}getSprite(t,e){if(t>=this.columns||t<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1}`),null;if(e>=this.rows||e<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1}`),null;const s=t+e*this.columns;return this.sprites[s]}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(s=>new xs({image:t.image,sourceView:s}));return new Bs({sprites:e})}static fromImageSource(t){var e;const s=[];t.spacing=(e=t.spacing)!==null&&e!==void 0?e:{};const{image:i,grid:{rows:n,columns:o,spriteWidth:h,spriteHeight:l},spacing:{originOffset:c,margin:u}}=t,m={x:0,y:0,...c},y={x:0,y:0,...u};for(let A=0;A<o;A++)for(let F=0;F<n;F++)s[A+F*o]=new xs({image:i,sourceView:{x:A*h+y.x*A+m.x,y:F*l+y.y*F+m.y,width:h,height:l},destSize:{height:l,width:h}});return new Bs({sprites:s,rows:n,columns:o})}}class hi extends te{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=j.getInstance(),this._alreadyWarnedAlphabet=!1,this._alreadyWarnedSpriteSheet=!1;const{alphabet:e,spriteSheet:s,caseInsensitive:i,spacing:n,shadow:o}=t;this.alphabet=e,this.spriteSheet=s,this.caseInsensitive=i??this.caseInsensitive,this.spacing=n??this.spacing,this.shadow=o??this.shadow}_getCharacterSprites(t){const e=[],s=this.caseInsensitive?t.toLocaleLowerCase():t,i=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let n=0;n<s.length;n++){const o=s[n];let h=i.indexOf(o);h===-1&&(h=0,this._alreadyWarnedAlphabet||(this._logger.warn(`SpriteFont - Cannot find letter '${o}' in configured alphabet '${i}'.`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedAlphabet=!0));const l=this.spriteSheet.sprites[h];l?e.push(l):this._alreadyWarnedSpriteSheet||(this._logger.warn(`SpriteFont - Cannot find sprite for '${o}' at index '${h}' in configured SpriteSheet`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedSpriteSheet=!0)}return e}measureText(t){const e=t.split(`
`),s=e.reduce((h,l)=>h.length>l.length?h:l),i=this._getCharacterSprites(s);let n=0,o=0;for(const h of i)n+=h.width+this.spacing,o=Math.max(o,h.height);return Z.fromDimension(n,o*e.length,v.Zero)}_drawImage(t,e,s){let i=0,n=0,o=0;const h=this._text.split(`
`);for(const l of h){for(const c of this._getCharacterSprites(l))c.draw(t,e+i,s+n),i+=c.width+this.spacing,o=Math.max(o,c.height);i=0,n+=o}}render(t,e,s,i,n){this._text=e;const o=this.measureText(e);this.width=o.width,this.height=o.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this.draw(t,i,n),t.restore()),this.draw(t,i,n)}clone(){return new hi({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}}const To="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAwCAYAAAD+f6R/AAAAAXNSR0IArs4c6QAABcJJREFUeJztnemu7CgMhGE07//KmT9NhrAFVzkQndQntXRP3/bCZkwCSQhCCCGEEEIIIYQQQog/TRz953Ecx/nDGIe/vdNhlc9tIz605Fk/ZmWfsO1hn9Gxuv1KHbvb3iL/VN+d1WORbyr7yR/5b9M4vjNeqko6jPJHq5wGHU151o9J2Udse9hndCxuv0rH7rY3yD/Wdyf13MrnQeDfkZIUSGKM4ff3cWN82pEZuTyQGX2IxeyR63va//8VNCYCq+1yEkLtWyagXv1P1r1H+110gP3PzT4gT8uW/mdQ8mUG8E9DqOz4MS9ICKGbXpS2BpnIrRzYeS96cll08INlCMl2/glzdcfazuuPqQO03lmqrBHsf272Q6NODXj6zzZIJd/LAHYTg3Mays5gBi7ZR27fOgs0yj8rm36DLMFiPgkAdXHKOwUQeMCQ/adSh/qBQrT/tPxbAwA9+DOZEILPAATSuHMgTv7+Auk/df2lHPCZLvMSLJe34LkEQ9PwXF1SRTllMYgvIaflqyVAjLGbsiCDcOK76jflxZ+sINPyROc5071yKWK5CJTV3dMp6+tBlyCtNlhAq/+XbWoBDcRNXYBMzD4VvQygSuPYC2jGGaSSOxXfy3dTUEsanIvNeepm38N/hssSALTPZnAXfwIYRJn2b7UBcw0FKX+nDdAMpm2j9WVnxrUa7TXaVAca/B+TgaAVh6R/rH0P/5m01dt/RLYViJn+w/bhVX2P7f/duqom5qb02pRLCLGIMgBU1wCEEN9BAUCID6MAIMSHUQAQ4sMoAAjxYRQAhPgwd1uB0fuZ7H3cnn2P+9mr/Pe4B8/eB/fwP4eRtci/0f6OfTCPt/9oHwC6G6y19RHZDumxmwzR4eE/s/2Tte/q/+XLdc9DeJ19diesQc/j7Z8fCe4tAS4CxZ7sp7eiJi7HiZmjmOTGJs+93CbS3nP0XIPH3vW8/qz6QPnX2QdsV/1uw/iZYvg8ACeHd28rpPzfNfhL+7vkw/4Ou9s+Onhbv91elpKZ48Dl6bzpwwibHigRArf+Ptk9+L3Y1Q5OB4LgCeSBw1iuB3GeJh1/HrX/zF0A9Mk+u45zMkc3r4rWPomma5+p/514LB+Zo93MErJ1JHxXPzByGa/licRYVKbpeQCoQ6Q8yxuCwJF9IPsoDkHAo/3Tx26cvA4EtJ/n04w8QOq/mrR7ddfLAC5BYFNlVI/0CnOVUflOpvJUQMx9AIMIW/nWDM67/qw0+95v9goBqD9j+72u/KD9U89IbnQbMIR2Zbneh5zUY7Hdk7XIP3UffVb+r+wDYAZLq+1n1+C7y3/ny2r7p5yeByDEh9HzAIQQJwoAQnwYBQAhPowCgBBjoNu3hNxSFACE6INuKvPajPZ4EFEAEKINcybGYzOd247WEd3TgA2jlmjEyrd+j9hvfVbD2PWQ3ZmGlu2HyO8og8eBuNUvNYWoDgMVpwHTJoLWdz1Y+ZYOy5uF7t6PPruZxANrud1lQXkP0jsGz/Yz+vGGMuygFyhSPcJnc1pMnQZElc+cRnoAlxdTvoDuK7puqF7uCQy+3fyFMiA02/vJQHh7DQDogMPTSGFNA56HTzbZ9yAfBOb1Zyo3qGM3MfMZ3f76huXf6xlmAHknMlLNXsBBBvbljIz9Uyz5Y5TzIBLR/qy/rNyrZ8+L/0BZ0m+tgXD0OK5XZxC/9P7I/g4hVFvzXf1/6i5A7+3AlijMPBLMZfCvuAp7A9rY56ApHitmLQc7c8bOv6ftAxlM9Xp35nkEK7nJetBsaMhtAAAuOLQGXwhh2dXQnn1rZ/a42BI3dL7L+jkFAbQddwdA9Ah35yMKhgEgVT46EFh5D4jz+OgavNKxeBCd1wDSJ/97oR8eoJkLi9t9/BDgDHTJ5NE7Dnzechh914OVv9M1K9PCqsfqb88XVg9qN9lm6nG176UPu+zn17GOxuO0vOWEEC/j+LFKTgghlvEfYJaLS+SA2O0AAAAASUVORK5CYII=";class Ji{constructor(){this.fontSheet=To,this.size=16,this.load()}load(){return this._imageSource=new Ki(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=Bs.fromImageSource({image:this._imageSource,grid:{rows:3,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new hi({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+ `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,s){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,s.x,s.y)}}class Po{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class tn{constructor(t){this.width=t.width,this.height=t.height,this._gl=t.gl,this._setupFramebuffer()}setResolution(t,e){const s=this._gl;this.width=t,this.height=e,s.bindTexture(s.TEXTURE_2D,this._frameTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null)}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return new Po(this._gl,this._frameTexture)}use(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}class Pe{static clear(){Pe._GL=null}static register(t){Pe._GL=t}static get gl(){if(!Pe._GL)throw Error("Attempted gl access before init");return Pe._GL}}const Eo=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,Io=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function en(r,t){switch(t){case r.FLOAT:return 4;case r.SHORT:return 2;case r.UNSIGNED_SHORT:return 2;case r.BYTE:return 1;case r.UNSIGNED_BYTE:return 1;default:return 1}}function zn(r,t){switch(t){case r.LOW_FLOAT:case r.HIGH_FLOAT:case r.FLOAT:return 1;case r.FLOAT_VEC2:return 2;case r.FLOAT_VEC3:return 3;case r.FLOAT_VEC4:return 4;case r.BYTE:return 1;case r.UNSIGNED_BYTE:return 1;case r.UNSIGNED_SHORT:case r.SHORT:return 1;default:return 1}}function Un(r,t){switch(t){case r.LOW_FLOAT:case r.HIGH_FLOAT:case r.FLOAT:case r.FLOAT_VEC2:case r.FLOAT_VEC3:case r.FLOAT_VEC4:return r.FLOAT;case r.BYTE:return r.BYTE;case r.UNSIGNED_BYTE:return r.UNSIGNED_BYTE;case r.SHORT:return r.SHORT;case r.UNSIGNED_SHORT:return r.UNSIGNED_SHORT;default:return r.FLOAT}}class ge{constructor(t){this._gl=Pe.gl,this.uniforms={},this.attributes={},this._compiled=!1;const{vertexSource:e,fragmentSource:s}=t;this.vertexSource=e,this.fragmentSource=s}get compiled(){return this._compiled}use(){this._gl.useProgram(this.program),ge._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return ge._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),s=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,s);const i=this.getAttributes();for(const o of i)this.attributes[o.name]=o;const n=this.getUniforms();for(const o of n)this.uniforms[o.name]=o;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),s=[];for(let i=0;i<e;i++){const n=t.getActiveUniform(this.program,i),o=t.getUniformLocation(this.program,n.name);s.push({name:n.name,glType:n.type,location:o})}return s}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),s=[];for(let i=0;i<e;i++){const n=t.getActiveAttrib(this.program,i),o=t.getAttribLocation(this.program,n.name);s.push({name:n.name,glType:Un(t,n.type),size:zn(t,n.type),location:o,normalized:!1})}return s}setTexture(t,e){const s=this._gl;s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...s){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const n=this._gl.getUniformLocation(this.program,e);if(n){const o=[n,...s];this._gl[t].apply(this._gl,o)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}_createProgram(t,e,s){const i=t.createProgram();if(i===null)throw Error("Could not create graphics shader program");if(t.attachShader(i,e),t.attachShader(i,s),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(i)}]`);return i}_compileShader(t,e,s){const i=t.VERTEX_SHADER===s?"vertex":"fragment",n=t.createShader(s);if(n===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const h=t.getShaderInfoLog(n);throw Error(`Could not compile ${i} shader:

${h}${this._processSourceForError(e,h)}`)}return n}_processSourceForError(t,e){const s=t.split(`
`),i=e.search(/\d:\d/),n=e.indexOf(" ",i),[o,h]=e.slice(i,n).split(":").map(l=>Number(l));for(let l=0;l<s.length;l++)s[l]=`${l+1}: ${s[l]}${h===l+1?" <----- ERROR!":""}`;return`

Source:
`+s.join(`
`)}}ge._ACTIVE_SHADER_INSTANCE=null;class ls{constructor(t){this._gl=Pe.gl,this.type="dynamic";const{size:e,type:s,data:i}=t;if(this.buffer=this._gl.createBuffer(),!i&&!e)throw Error("Must either provide data or a size to the VertexBuffer");i?this.bufferData=i:this.bufferData=new Float32Array(e),this.type=s??this.type;const n=this._gl;n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,this.bufferData,this.type==="static"?n.STATIC_DRAW:n.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}}class cs{constructor(t){this._gl=Pe.gl,this._logger=j.getInstance(),this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0;const{shader:e,vertexBuffer:s,attributes:i}=t;this._vertexBuffer=s,this._attributes=i,this._shader=e,this.initialize()}get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}initialize(){if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._layout.length=0;const t=this._shader.attributes;for(const s of this._attributes){const i=t[s[0]];if(!i)throw Error(`The attribute named: ${s[0]} size ${s[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);if(i.size!==s[1])throw Error(`VertexLayout size definition for attribute: [${s[0]}, ${s[1]}], doesnt match shader source size ${i.size}:
 ${this._shader.vertexSource}`);this._layout.push(i)}let e=0;for(const s of this._layout){const i=en(this._gl,s.glType);this._vertexTotalSizeBytes+=i*s.size,e+=s.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`)}use(t=!1,e){const s=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e);let i=0;for(const n of this._layout)s.vertexAttribPointer(n.location,n.size,n.glType,n.normalized,this.totalVertexSizeBytes,i),s.enableVertexAttribArray(n.location),i+=en(s,n.glType)*n.size}}class Dt{static clear(){Dt.DrawCallCount=0,Dt.DrawnImagesCount=0}}Dt.DrawCallCount=0,Dt.DrawnImagesCount=0;class Bo{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ge({vertexSource:Eo,fragmentSource:Io}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new ls({size:6*2*this._maxLines,type:"dynamic"}),this._layout=new cs({vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}draw(t,e,s){this._isFull()&&this.flush(),this._lineCount++;const i=this._context.getTransform(),n=i.multiply(t),o=i.multiply(e),h=this._vertexBuffer.bufferData;h[this._vertexIndex++]=n.x,h[this._vertexIndex++]=n.y,h[this._vertexIndex++]=s.r/255,h[this._vertexIndex++]=s.g/255,h[this._vertexIndex++]=s.b/255,h[this._vertexIndex++]=s.a,h[this._vertexIndex++]=o.x,h[this._vertexIndex++]=o.y,h[this._vertexIndex++]=s.r/255,h[this._vertexIndex++]=s.g/255,h[this._vertexIndex++]=s.b/255,h[this._vertexIndex++]=s.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),Dt.DrawnImagesCount+=this._lineCount,Dt.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const Fo=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,Mo=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class Do{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ge({vertexSource:Fo,fragmentSource:Mo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new ls({size:7*this._maxPoints,type:"dynamic"}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}draw(t,e,s){this._isFull()&&this.flush(),this._pointCount++;const i=this._context.getTransform(),n=this._context.opacity,o=this._context.snapToPixel,h=i.multiply(t);o&&(h.x=~~(h.x+lt),h.y=~~(h.y+lt));const l=this._buffer.bufferData;l[this._vertexIndex++]=h.x,l[this._vertexIndex++]=h.y,l[this._vertexIndex++]=e.r/255,l[this._vertexIndex++]=e.g/255,l[this._vertexIndex++]=e.b/255,l[this._vertexIndex++]=e.a*n,l[this._vertexIndex++]=s*Math.max(i.getScaleX(),i.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),Dt.DrawnImagesCount+=this._pointCount,Dt.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const ko=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,Ro=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class Lo{constructor(t){this._gl=t,this._shader=new ge({vertexSource:ko,fragmentSource:Ro}),this._shader.compile(),this._buffer=new ls({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl;t.getShader().use(),t.getLayout().use(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class li{constructor(t,e){this._gl=Pe.gl,this._logger=j.getInstance();const s=this._gl;this.buffer=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.buffer);const i=t*6;if(!e)this.bufferData=new Uint32Array(i);else{const h=Math.floor(16383.5);this.bufferGlType=s.UNSIGNED_SHORT,this.bufferData=new Uint16Array(i),t>h&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${h}) requested quads(${t})`)}let n=0;for(let o=0;o<i;o+=6)this.bufferData[o+0]=n+0,this.bufferData[o+1]=n+1,this.bufferData[o+2]=n+2,this.bufferData[o+3]=n+2,this.bufferData[o+4]=n+1,this.bufferData[o+5]=n+3,n+=4;s.bufferData(s.ELEMENT_ARRAY_BUFFER,this.bufferData,s.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}}const zo=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   // In order to support the most efficient sprite batching, we have multiple\r
   // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
   // that do not apply to a particular sprite.\r
\r
   vec4 color = vec4(1.0, 0, 0, 1.0);\r
\r
   // GLSL is templated out to pick the right texture and set the vec4 color\r
   %%texture_picker%%\r
\r
   color.rgb = color.rgb * v_opacity;\r
   color.a = color.a * v_opacity;\r
   fragColor = color * v_tint;\r
}`,Uo=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the UV coord to the fragment shader\r
   v_texcoord = a_texcoord;\r
   // Pass through the texture number to the fragment shader\r
   v_textureIndex = a_textureIndex;\r
   // Pass through the tint\r
   v_tint = a_tint;\r
}`;class Oo{constructor(){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const s=this._transformFragmentSource(zo,this._maxTextures);this._shader=new ge({fragmentSource:s,vertexSource:Uo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((i,n)=>n)),this._buffer=new ls({size:10*4*this._maxImages,type:"dynamic"}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new li(this._maxImages,!0)}_transformFragmentSource(t,e){let s=t.replace("%%count%%",e.toString()),i="";for(let n=0;n<e;n++)n===0?i+=`if (v_textureIndex <= ${n}.5) {
`:i+=`   else if (v_textureIndex <= ${n}.5) {
`,i+=`      color = texture(u_textures[${n}], v_texcoord);
`,i+=`   }
`;return s=s.replace("%%texture_picker%%",i),s}_addImageAsTexture(t){const e=ut.load(t);this._textures.indexOf(e)===-1&&this._textures.push(e)}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){return t?this._textures.indexOf(ut.get(t)):-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}draw(t,e,s,i,n,o,h,l,c){var u,m,y,A;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);let F=(t==null?void 0:t.width)||i||0,z=(t==null?void 0:t.height)||n||0,U=[0,0,(u=i??(t==null?void 0:t.width))!==null&&u!==void 0?u:0,(m=n??(t==null?void 0:t.height))!==null&&m!==void 0?m:0],S=[e??1,s??1];o!==void 0&&h!==void 0&&l!==void 0&&c!==void 0&&(U=[e??1,s??1,(y=i??(t==null?void 0:t.width))!==null&&y!==void 0?y:0,(A=n??(t==null?void 0:t.height))!==null&&A!==void 0?A:0],S=[o,h],F=l,z=c),e=U[0],s=U[1];const T=U[2],Y=U[3],G=this._context.getTransform(),st=this._context.opacity,$=this._context.snapToPixel;let k=P(S[0],S[1]),vt=P(S[0]+F,S[1]),yt=P(S[0],S[1]+z),bt=P(S[0]+F,S[1]+z);k=G.multiply(k),vt=G.multiply(vt),yt=G.multiply(yt),bt=G.multiply(bt),$&&(k.x=~~(k.x+lt),k.y=~~(k.y+lt),vt.x=~~(vt.x+lt),vt.y=~~(vt.y+lt),yt.x=~~(yt.x+lt),yt.y=~~(yt.y+lt),bt.x=~~(bt.x+lt),bt.y=~~(bt.y+lt));const ft=this._context.tint,Vt=this._getTextureIdForImage(t),Fe=t.width||F,Me=t.height||z,Ts=e/Fe,Ps=s/Me,Es=(e+T-.01)/Fe,Is=(s+Y-.01)/Me,it=this._layout.vertexBuffer.bufferData;it[this._vertexIndex++]=k.x,it[this._vertexIndex++]=k.y,it[this._vertexIndex++]=st,it[this._vertexIndex++]=Ts,it[this._vertexIndex++]=Ps,it[this._vertexIndex++]=Vt,it[this._vertexIndex++]=ft.r/255,it[this._vertexIndex++]=ft.g/255,it[this._vertexIndex++]=ft.b/255,it[this._vertexIndex++]=ft.a,it[this._vertexIndex++]=yt.x,it[this._vertexIndex++]=yt.y,it[this._vertexIndex++]=st,it[this._vertexIndex++]=Ts,it[this._vertexIndex++]=Is,it[this._vertexIndex++]=Vt,it[this._vertexIndex++]=ft.r/255,it[this._vertexIndex++]=ft.g/255,it[this._vertexIndex++]=ft.b/255,it[this._vertexIndex++]=ft.a,it[this._vertexIndex++]=vt.x,it[this._vertexIndex++]=vt.y,it[this._vertexIndex++]=st,it[this._vertexIndex++]=Es,it[this._vertexIndex++]=Ps,it[this._vertexIndex++]=Vt,it[this._vertexIndex++]=ft.r/255,it[this._vertexIndex++]=ft.g/255,it[this._vertexIndex++]=ft.b/255,it[this._vertexIndex++]=ft.a,it[this._vertexIndex++]=bt.x,it[this._vertexIndex++]=bt.y,it[this._vertexIndex++]=st,it[this._vertexIndex++]=Es,it[this._vertexIndex++]=Is,it[this._vertexIndex++]=Vt,it[this._vertexIndex++]=ft.r/255,it[this._vertexIndex++]=ft.g/255,it[this._vertexIndex++]=ft.b/255,it[this._vertexIndex++]=ft.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*10*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),Dt.DrawnImagesCount+=this._imageCount,Dt.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0}}const Ho=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,No=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Wo{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ge({fragmentSource:Ho,vertexSource:No}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new ls({size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new li(this._maxRectangles,!0)}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof v&&t[1]instanceof v?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,s,i=1){this._isFull()&&this.flush(),this._rectangleCount++;const n=this._context.getTransform(),o=this._context.opacity,h=this._context.snapToPixel,l=e.sub(t),c=l.size,u=l.normalize().perpendicular(),m=i/2,y=n.multiply(u.scale(m).add(t)),A=n.multiply(u.scale(-m).add(t)),F=n.multiply(u.scale(m).add(e)),z=n.multiply(u.scale(-m).add(e));h&&(y.x=~~(y.x+lt),y.y=~~(y.y+lt),F.x=~~(F.x+lt),F.y=~~(F.y+lt),A.x=~~(A.x+lt),A.y=~~(A.y+lt),z.x=~~(z.x+lt),z.y=~~(z.y+lt));const U=0,S=0,T=1,Y=1,G=D.Transparent,st=0,$=1,k=this._layout.vertexBuffer.bufferData;k[this._vertexIndex++]=y.x,k[this._vertexIndex++]=y.y,k[this._vertexIndex++]=U,k[this._vertexIndex++]=S,k[this._vertexIndex++]=c,k[this._vertexIndex++]=i,k[this._vertexIndex++]=o,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=st/$,k[this._vertexIndex++]=A.x,k[this._vertexIndex++]=A.y,k[this._vertexIndex++]=U,k[this._vertexIndex++]=Y,k[this._vertexIndex++]=c,k[this._vertexIndex++]=i,k[this._vertexIndex++]=o,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=st/$,k[this._vertexIndex++]=F.x,k[this._vertexIndex++]=F.y,k[this._vertexIndex++]=T,k[this._vertexIndex++]=S,k[this._vertexIndex++]=c,k[this._vertexIndex++]=i,k[this._vertexIndex++]=o,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=st/$,k[this._vertexIndex++]=z.x,k[this._vertexIndex++]=z.y,k[this._vertexIndex++]=T,k[this._vertexIndex++]=Y,k[this._vertexIndex++]=c,k[this._vertexIndex++]=i,k[this._vertexIndex++]=o,k[this._vertexIndex++]=s.r/255,k[this._vertexIndex++]=s.g/255,k[this._vertexIndex++]=s.b/255,k[this._vertexIndex++]=s.a,k[this._vertexIndex++]=G.r/255,k[this._vertexIndex++]=G.g/255,k[this._vertexIndex++]=G.b/255,k[this._vertexIndex++]=G.a,k[this._vertexIndex++]=st/$}drawRectangle(t,e,s,i,n=D.Transparent,o=0){this._isFull()&&this.flush(),this._rectangleCount++;const h=this._context.getTransform(),l=this._context.opacity,c=this._context.snapToPixel,u=h.multiply(t.add(P(0,0))),m=h.multiply(t.add(P(e,0))),y=h.multiply(t.add(P(e,s))),A=h.multiply(t.add(P(0,s)));c&&(u.x=~~(u.x+lt),u.y=~~(u.y+lt),m.x=~~(m.x+lt),m.y=~~(m.y+lt),A.x=~~(A.x+lt),A.y=~~(A.y+lt),y.x=~~(y.x+lt),y.y=~~(y.y+lt));const F=0,z=0,U=1,S=1,T=this._layout.vertexBuffer.bufferData;T[this._vertexIndex++]=u.x,T[this._vertexIndex++]=u.y,T[this._vertexIndex++]=F,T[this._vertexIndex++]=z,T[this._vertexIndex++]=e,T[this._vertexIndex++]=s,T[this._vertexIndex++]=l,T[this._vertexIndex++]=i.r/255,T[this._vertexIndex++]=i.g/255,T[this._vertexIndex++]=i.b/255,T[this._vertexIndex++]=i.a,T[this._vertexIndex++]=n.r/255,T[this._vertexIndex++]=n.g/255,T[this._vertexIndex++]=n.b/255,T[this._vertexIndex++]=n.a,T[this._vertexIndex++]=o,T[this._vertexIndex++]=A.x,T[this._vertexIndex++]=A.y,T[this._vertexIndex++]=F,T[this._vertexIndex++]=S,T[this._vertexIndex++]=e,T[this._vertexIndex++]=s,T[this._vertexIndex++]=l,T[this._vertexIndex++]=i.r/255,T[this._vertexIndex++]=i.g/255,T[this._vertexIndex++]=i.b/255,T[this._vertexIndex++]=i.a,T[this._vertexIndex++]=n.r/255,T[this._vertexIndex++]=n.g/255,T[this._vertexIndex++]=n.b/255,T[this._vertexIndex++]=n.a,T[this._vertexIndex++]=o,T[this._vertexIndex++]=m.x,T[this._vertexIndex++]=m.y,T[this._vertexIndex++]=U,T[this._vertexIndex++]=z,T[this._vertexIndex++]=e,T[this._vertexIndex++]=s,T[this._vertexIndex++]=l,T[this._vertexIndex++]=i.r/255,T[this._vertexIndex++]=i.g/255,T[this._vertexIndex++]=i.b/255,T[this._vertexIndex++]=i.a,T[this._vertexIndex++]=n.r/255,T[this._vertexIndex++]=n.g/255,T[this._vertexIndex++]=n.b/255,T[this._vertexIndex++]=n.a,T[this._vertexIndex++]=o,T[this._vertexIndex++]=y.x,T[this._vertexIndex++]=y.y,T[this._vertexIndex++]=U,T[this._vertexIndex++]=S,T[this._vertexIndex++]=e,T[this._vertexIndex++]=s,T[this._vertexIndex++]=l,T[this._vertexIndex++]=i.r/255,T[this._vertexIndex++]=i.g/255,T[this._vertexIndex++]=i.b/255,T[this._vertexIndex++]=i.a,T[this._vertexIndex++]=n.r/255,T[this._vertexIndex++]=n.g/255,T[this._vertexIndex++]=n.b/255,T[this._vertexIndex++]=n.a,T[this._vertexIndex++]=o}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),Dt.DrawnImagesCount+=this._rectangleCount,Dt.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const Go=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,Vo=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Xo{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new ge({fragmentSource:Go,vertexSource:Vo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new ls({size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new li(this._maxCircles,!0)}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,s,i=D.Transparent,n=0){this._isFull()&&this.flush(),this._circleCount++;const o=this._context.getTransform(),h=this._context.opacity,l=this._context.snapToPixel,c=o.multiply(t.add(P(-e,-e))),u=o.multiply(t.add(P(e,-e))),m=o.multiply(t.add(P(e,e))),y=o.multiply(t.add(P(-e,e)));l&&(c.x=~~(c.x+lt),c.y=~~(c.y+lt),u.x=~~(u.x+lt),u.y=~~(u.y+lt),y.x=~~(y.x+lt),y.y=~~(y.y+lt),m.x=~~(m.x+lt),m.y=~~(m.y+lt));const A=0,F=0,z=1,U=1,S=this._layout.vertexBuffer.bufferData;S[this._vertexIndex++]=c.x,S[this._vertexIndex++]=c.y,S[this._vertexIndex++]=A,S[this._vertexIndex++]=F,S[this._vertexIndex++]=h,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=i.r/255,S[this._vertexIndex++]=i.g/255,S[this._vertexIndex++]=i.b/255,S[this._vertexIndex++]=i.a,S[this._vertexIndex++]=n/e,S[this._vertexIndex++]=y.x,S[this._vertexIndex++]=y.y,S[this._vertexIndex++]=A,S[this._vertexIndex++]=U,S[this._vertexIndex++]=h,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=i.r/255,S[this._vertexIndex++]=i.g/255,S[this._vertexIndex++]=i.b/255,S[this._vertexIndex++]=i.a,S[this._vertexIndex++]=n/e,S[this._vertexIndex++]=u.x,S[this._vertexIndex++]=u.y,S[this._vertexIndex++]=z,S[this._vertexIndex++]=F,S[this._vertexIndex++]=h,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=i.r/255,S[this._vertexIndex++]=i.g/255,S[this._vertexIndex++]=i.b/255,S[this._vertexIndex++]=i.a,S[this._vertexIndex++]=n/e,S[this._vertexIndex++]=m.x,S[this._vertexIndex++]=m.y,S[this._vertexIndex++]=z,S[this._vertexIndex++]=U,S[this._vertexIndex++]=h,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=i.r/255,S[this._vertexIndex++]=i.g/255,S[this._vertexIndex++]=i.b/255,S[this._vertexIndex++]=i.a,S[this._vertexIndex++]=n/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),Dt.DrawnImagesCount+=this._circleCount,Dt.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class On{constructor(t,e,s=100){this.builder=t,this.recycler=e,this.maxObjects=s,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=j.getInstance()}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(...t){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler(this.objects[this.index++],...t):(this.totalAllocations++,this.objects[this.index++]=this.builder(...t))}done(...t){this.index=0;for(const e of t){const s=this.objects.indexOf(e);this.objects[s]=this.builder(),this.totalAllocations++}return t}}class Yo{constructor(){this.z=0,this.priority=0,this.transform=wt.identity(),this.state={z:0,opacity:1,tint:D.White}}}const lt=1e-4;class Zo{constructor(t){this._webglCtx=t,this._debugText=new Ji}drawRect(t,e,s,i,n={color:D.Black}){this.drawLine(P(t,e),P(t+s,e),{...n}),this.drawLine(P(t+s,e),P(t+s,e+i),{...n}),this.drawLine(P(t+s,e+i),P(t,e+i),{...n}),this.drawLine(P(t,e+i),P(t,e),{...n})}drawLine(t,e,s={color:D.Black}){this._webglCtx.draw("ex.line",t,e,s.color)}drawPoint(t,e={color:D.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class Ys{constructor(t){this._logger=j.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new On(()=>new Yo,l=>(l.priority=0,l.z=0,l.renderer=void 0,l.args=void 0,l),4e3),this._drawCalls=[],this._postProcessTargets=[],this._postprocessors=[],this._transform=new ws,this._state=new Le,this.snapToPixel=!1,this.smoothing=!1,this.backgroundColor=D.ExcaliburBlue,this._alreadyWarnedDrawLifecycle=!1,this.debug=new Zo(this);const{canvasElement:e,enableTransparency:s,smoothing:i,snapToPixel:n,backgroundColor:o,useDrawSorting:h}=t;if(this.__gl=e.getContext("webgl2",{antialias:i??this.smoothing,premultipliedAlpha:!1,alpha:s??!0,depth:!0,powerPreference:"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");Pe.register(this.__gl),ut.register(this.__gl),this.snapToPixel=n??this.snapToPixel,this.smoothing=i??this.smoothing,this.backgroundColor=o??this.backgroundColor,this.useDrawSorting=h??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}_init(){const t=this.__gl;this._ortho=Ct.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new Oo),this.register(new Wo),this.register(new Xo),this.register(new Do),this.register(new Bo),this._screenRenderer=new Lo(t),this._renderTarget=new tn({gl:t,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new tn({gl:t,width:t.canvas.width,height:t.canvas.height}),new tn({gl:t,width:t.canvas.width,height:t.canvas.height})]}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){!this._isDrawLifecycle&&!this._alreadyWarnedDrawLifecycle&&(this._logger.warn(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._alreadyWarnedDrawLifecycle=!0);const s=this._renderers.get(t);if(s)if(this.useDrawSorting){const i=this._drawCallPool.get();i.z=this._state.current.z,i.priority=s.priority,i.renderer=t,this.getTransform().clone(i.transform),i.state.z=this._state.current.z,i.state.opacity=this._state.current.opacity,i.state.tint=this._state.current.tint,i.args=e,this._drawCalls.push(i)}else this._currentRenderer||(this._currentRenderer=s),this._isCurrentRenderer(s)||this._currentRenderer.flush(),s.draw(...e),this._currentRenderer=s;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.current=wt.identity()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Ct.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}drawImage(t,e,s,i,n,o,h,l,c){if(!(i===0||n===0)){{if(l===0||c===0)return;if(t.width===0||t.height===0)return}if(!t){j.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this.draw("ex.image",t,e,s,i,n,o,h,l,c)}}drawLine(t,e,s,i=1){this.draw("ex.rectangle",t,e,s,i)}drawRectangle(t,e,s,i,n,o){this.draw("ex.rectangle",t,e,s,i,n,o)}drawCircle(t,e,s,i,n){this.draw("ex.circle",t,e,s,i,n)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+lt):t,this.snapToPixel?~~(e+lt):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}clear(){const t=this.__gl;this._renderTarget.use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){const t=this.__gl;if(this._renderTarget.use(),this.useDrawSorting){const s=new Map;for(const[o]of this._renderers){const h=this._drawCalls.findIndex(l=>l.renderer===o);s.set(o,h)}this._drawCalls.sort((o,h)=>{const l=o.z-h.z,c=s.get(o.renderer)-s.get(h.renderer),u=o.priority-h.priority;return l===0?u===0?c:u:l});const i=this._transform.current,n=this._state.current;if(this._drawCalls.length){let o=this._drawCalls[0].renderer,h=this._renderers.get(o);for(let l=0;l<this._drawCalls.length;l++)this._transform.current=this._drawCalls[l].transform,this._state.current=this._drawCalls[l].state,this._drawCalls[l].renderer!==o&&(h.flush(),o=this._drawCalls[l].renderer,h=this._renderers.get(o)),h.draw(...this._drawCalls[l].args);h.hasPendingDraws()&&h.flush()}this._transform.current=i,this._state.current=n,this._drawCallPool.done(),this._drawCalls.length=0}else for(const s of this._renderers.values())s.hasPendingDraws()&&s.flush();this._renderTarget.disable(),this._renderTarget.toRenderSource().use();for(let s=0;s<this._postprocessors.length;s++)this._postProcessTargets[s%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[s]),this._postProcessTargets[s%2].toRenderSource().use();t.bindFramebuffer(t.FRAMEBUFFER,null),this._screenRenderer.renderToScreen()}}const Bt=1e-4;class jo{constructor(t){this._ex=t,this._debugText=new Ji}drawRect(t,e,s,i){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+Bt):t,this._ex.snapToPixel?~~(e+Bt):e,this._ex.snapToPixel?~~(s+Bt):s,this._ex.snapToPixel?~~(i+Bt):i),this._ex.__ctx.restore()}drawLine(t,e,s={color:D.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=s.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+Bt):t.x,this._ex.snapToPixel?~~(t.y+Bt):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+Bt):e.x,this._ex.snapToPixel?~~(e.y+Bt):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:D.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+Bt):t.x,this._ex.snapToPixel?~~(t.y+Bt):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class ci{constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=D.ExcaliburBlue,this._state=new Le,this.snapToPixel=!1,this.debug=new jo(this);const{canvasElement:e,enableTransparency:s,snapToPixel:i,smoothing:n,backgroundColor:o}=t;this.__ctx=e.getContext("2d",{alpha:s??!0}),this.backgroundColor=o??this.backgroundColor,this.snapToPixel=i??this.snapToPixel,this.smoothing=n??this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,s,i,n,o,h,l,c){if(i===0||n===0)return;if(l===0||c===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const u=[t,e,s,i,n,o,h,l,c].filter(m=>m!==void 0).map(m=>typeof m=="number"&&this.snapToPixel?~~m:m);this.__ctx.drawImage.apply(this.__ctx,u),Dt.DrawCallCount++,Dt.DrawnImagesCount=1}drawLine(t,e,s,i=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=s.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+Bt):t.x,this.snapToPixel?~~(t.y+Bt):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+Bt):e.x,this.snapToPixel?~~(e.y+Bt):e.y),this.__ctx.lineWidth=i,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,s,i){this.__ctx.save(),this.__ctx.fillStyle=i.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+Bt):t.x,this.snapToPixel?~~(t.y+Bt):t.y,this.snapToPixel?~~(e+Bt):e,this.snapToPixel?~~(s+Bt):s),this.__ctx.restore()}drawCircle(t,e,s,i,n){this.__ctx.save(),this.__ctx.beginPath(),i&&(this.__ctx.strokeStyle=i.toString()),n&&(this.__ctx.lineWidth=n),this.__ctx.fillStyle=s.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+Bt):t.x,this.snapToPixel?~~(t.y+Bt):t.y,e,0,Math.PI*2),this.__ctx.fill(),i&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+Bt):t,this.snapToPixel?~~(e+Bt):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}beginDrawLifecycle(){}endDrawLifecycle(){}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Dt.clear()}flush(){}}var zt;(function(r){r.Fixed="Fixed",r.FitContainerAndFill="FitContainerAndFill",r.FitScreenAndFill="FitScreenAndFill",r.FitContainerAndZoom="FitContainerAndZoom",r.FitScreenAndZoom="FitScreenAndZoom",r.FitScreen="FitScreen",r.FillScreen="FillScreen",r.FitContainer="FitContainer",r.FillContainer="FillContainer"})(zt||(zt={}));class sn{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class nn{constructor(t){var e,s,i;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=j.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._resizeHandler=()=>{const n=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(n),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._alreadyWarned=!1,this._contentArea=new Z,this.viewport=t.viewport,this.resolution=(e=t.resolution)!==null&&e!==void 0?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(s=t.displayMode)!==null&&s!==void 0?s:zt.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(i=t.antialiasing)!==null&&i!==void 0?i:this._antialiasing,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._resizeHandler),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case zt.FillContainer:case zt.FitContainer:case zt.FitContainerAndFill:case zt.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this.graphicsContext instanceof Ys&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&!this._alreadyWarned&&(this._alreadyWarned=!0,this._logger.warn(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)),this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof ci&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio)}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(t){if(t){const e=document.getElementById(t);if(e)return e.requestFullscreen()}return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let e=t.x,s=t.y;if(this._isFullScreen||(e-=Xt(this._canvas).x,s-=Xt(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const i=window.innerWidth/this.aspectRatio,n=(window.innerHeight-i)/2;s=(s-n)/i*this.viewport.height,e=e/window.innerWidth*this.viewport.width}else{const i=window.innerHeight*this.aspectRatio,n=(window.innerWidth-i)/2;e=(e-n)/i*this.viewport.width,s=s/window.innerHeight*this.viewport.height}return e=e/this.viewport.width*this.resolution.width,s=s/this.viewport.height*this.resolution.height,new v(e,s)}screenToPageCoordinates(t){let e=t.x,s=t.y;if(e=e/this.resolution.width*this.viewport.width,s=s/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const i=window.innerWidth/this.aspectRatio,n=(window.innerHeight-i)/2;s=s/this.viewport.height*i+n,e=e/this.viewport.width*window.innerWidth}else{const i=window.innerHeight*this.aspectRatio,n=(window.innerWidth-i)/2;e=e/this.viewport.width*i+n,s=s/this.viewport.height*window.innerHeight}return this._isFullScreen||(e+=Xt(this._canvas).x,s+=Xt(this._canvas).y),new v(e,s)}screenToWorldCoordinates(t){return this._camera?this._camera.inverse.multiply(t):t.sub(P(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(P(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){const t=this.screenToWorldCoordinates(v.Zero),e=t.x+this.drawWidth,s=t.y+this.drawHeight;return new Z(t.x,t.y,e,s)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return P(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,s=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,s=window.innerWidth/t):(e=window.innerHeight*t,s=window.innerHeight),this.viewport={width:e,height:s},this._contentArea=Z.fromDimension(this.resolution.width,this.resolution.height,v.Zero)}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e)}_computeFitContainerAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.canvas.parentElement,e=t.clientWidth,s=t.clientHeight;this._computeFitAndFill(e,s)}_computeFitAndFill(t,e){if(this.viewport={width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const s=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new Z({top:s,left:0,right:this._contentResolution.width,bottom:this.resolution.height-s})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const s=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new Z({top:0,left:s,right:this.resolution.width-s,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e)}_computeFitContainerAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=this.canvas.parentElement;t.style.position="relative",t.style.overflow="hidden";const e=t.clientWidth,s=t.clientHeight;this._computeFitAndZoom(e,s)}_computeFitAndZoom(t,e){const s=this.aspectRatio;let i=0,n=0;t/s<e?(i=t,n=t/s):(i=e*s,n=e);const o=t/i,h=e/n,l=Math.max(o,h),c=i*l,u=n*l;c>t?this.canvas.style.left=-(c-t)/2+"px":this.canvas.style.left="",u>e?this.canvas.style.top=-(u-e)/2+"px":this.canvas.style.top="",this.viewport={width:c,height:u};const m=Z.fromDimension(this.viewport.width,this.viewport.height,v.Zero);if(this.viewport.width>t){const y=(this.viewport.width-t)/this.viewport.width*this.resolution.width;m.top=0,m.left=y/2,m.right=this.resolution.width-y/2,m.bottom=this.resolution.height}if(this.viewport.height>e){const y=(this.viewport.height-e)/this.viewport.height*this.resolution.height;m.top=y/2,m.left=0,m.bottom=this.resolution.height-y/2,m.right=this.resolution.width}this._contentArea=m}_computeFitContainer(){const t=this.aspectRatio;let e=0,s=0;const i=this.canvas.parentElement;i.clientWidth/t<i.clientHeight?(e=i.clientWidth,s=i.clientWidth/t):(e=i.clientHeight*t,s=i.clientHeight),this.viewport={width:e,height:s},this._contentArea=Z.fromDimension(this.resolution.width,this.resolution.height,v.Zero)}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===zt.FillContainer&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===zt.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this.displayMode===zt.FitScreen&&this._computeFit(),this.displayMode===zt.FitContainer&&this._computeFitContainer(),this.displayMode===zt.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===zt.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===zt.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===zt.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class Fs{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}Fs._INSTANCE=null;function Qo(r){return!!r.playbackState}class ys{static unlock(){return new Promise((e,s)=>{if(ys._UNLOCKED||!Fs.create())return e(!0);const i=setTimeout(()=>{j.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),n=Fs.create();n.resume().then(()=>{const o=n.createBuffer(1,1,22050),h=n.createBufferSource();let l=!1;h.buffer=o,h.connect(n.destination),h.onended=()=>l=!0,h.start(0),setTimeout(()=>{Qo(h)?(h.playbackState===h.PLAYING_STATE||h.playbackState===h.FINISHED_STATE)&&(ys._UNLOCKED=!0):(n.currentTime>0||l)&&(ys._UNLOCKED=!0)},0),clearTimeout(i),e(!0)},()=>{s()})})}static isUnlocked(){return this._UNLOCKED}}ys._UNLOCKED=!1;class _e{constructor(){this.eventDispatcher=new hs}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}function rn(r,t=D.Red,e,s,i,n,o=1,h="butt"){r.save(),r.beginPath(),r.lineWidth=o,r.lineCap=h,r.strokeStyle=t.toString(),r.moveTo(e,s),r.lineTo(i,n),r.closePath(),r.stroke(),r.restore()}function qo(r,t=D.Red,e){r.beginPath(),r.strokeStyle=t.toString(),r.arc(e.x,e.y,5,0,Math.PI*2),r.closePath(),r.stroke()}function $o(r,t,e,s,i=1){const n=t?t.toString():"blue",o=s.scale(i);r.beginPath(),r.strokeStyle=n,r.moveTo(e.x,e.y),r.lineTo(e.x+o.x,e.y+o.y),r.closePath(),r.stroke()}function on(r,t,e,s,i,n=5,o=D.White,h=null){let l;if(typeof n=="number")l={tl:n,tr:n,br:n,bl:n};else{const c={tl:0,tr:0,br:0,bl:0};for(const u in c)if(c.hasOwnProperty(u)){const m=u;l[m]=n[m]||c[m]}}r.beginPath(),r.moveTo(t+l.tl,e),r.lineTo(t+s-l.tr,e),r.quadraticCurveTo(t+s,e,t+s,e+l.tr),r.lineTo(t+s,e+i-l.br),r.quadraticCurveTo(t+s,e+i,t+s-l.br,e+i),r.lineTo(t+l.bl,e+i),r.quadraticCurveTo(t,e+i,t,e+i-l.bl),r.lineTo(t,e+l.tl),r.quadraticCurveTo(t,e,t+l.tl,e),r.closePath(),h&&(r.fillStyle=h.toString(),r.fill()),o&&(r.strokeStyle=o.toString(),r.stroke())}function Ko(r,t,e,s,i=D.White,n=null){r.beginPath(),r.arc(t,e,s,0,Math.PI*2),r.closePath(),n&&(r.fillStyle=n.toString(),r.fill()),i&&(r.strokeStyle=i.toString(),r.stroke())}const Jo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var ta=Tt(1388);class Ms extends te{constructor(t){var e,s,i,n,o,h,l,c,u,m;super(t),this.filtering=null,this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=vs(D.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this.color=(s=t.color)!==null&&s!==void 0?s:D.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(i=t.smoothing)!==null&&i!==void 0?i:this.smoothing,this.lineWidth=(n=t.lineWidth)!==null&&n!==void 0?n:this.lineWidth,this.lineDash=(o=t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineCap=(h=t.lineCap)!==null&&h!==void 0?h:this.lineCap,this.padding=(l=t.padding)!==null&&l!==void 0?l:this.padding,this.filtering=(c=t.filtering)!==null&&c!==void 0?c:this.filtering),this._bitmap=document.createElement("canvas");const y=(u=t==null?void 0:t.width)!==null&&u!==void 0?u:this._bitmap.width,A=(m=t==null?void 0:t.height)!==null&&m!==void 0?m:this._bitmap.height;this.width=y,this.height=A;const F=this._bitmap.getContext("2d");if(F)this._ctx=F;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return Z.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,v.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=vs(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=vs(t,()=>this.flagDirty())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore(),ut.load(this._bitmap,this.filtering,!0)}_applyRasterProperties(t){var e,s,i;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(s=this.strokeColor)===null||s===void 0?void 0:s.toString(),t.fillStyle=(i=this.color)===null||i===void 0?void 0:i.toString()}_drawImage(t,e,s){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,s)}}class di extends Ms{constructor(t){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new di({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,s;!((e=this._options)===null||e===void 0)&&e.draw&&((s=this._options)===null||s===void 0||s.draw(t)),this._options.cache||this.flagDirty()}}class an{}an.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class ui{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const s=new ui;s.data=e;for(const i in t.states)s.states.set(i,{name:i,...t.states[i]});for(const i of s.states.values())for(const n of i.transitions)if(n!=="*"&&!s.states.has(n))throw Error(`Invalid state machine, state [${i.name}] has a transition to another state that doesn't exist [${n}]`);return s.currentState=s.startState=s.states.get(t.start),s}in(t){return this.currentState.name===t}go(t,e){var s,i;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const n=this.states.get(t);return this.currentState.onExit&&((s=this.currentState)===null||s===void 0?void 0:s.onExit({to:n.name,data:this.data}))===!1||n!=null&&n.onEnter&&(n==null?void 0:n.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=n,!((i=this.currentState)===null||i===void 0)&&i.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class Hn{constructor(t){this._src=t,this._audioContext=Fs.create(),this._volumeNode=this._audioContext.createGain(),this._playingPromise=new Promise(e=>{this._playingResolve=e}),this._stateMachine=ui.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingResolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:s})=>{s.pausedAt=(e??0)/this._playbackRate,s.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingResolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingResolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingResolve(!0)}))}get loop(){return this._loop}set volume(t){t=M(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingPromise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class hn extends ot{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class ds extends hn{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Nn extends hn{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function ea(r){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)$/,s=r.match(e)[1];return!!t.canPlayType("audio/"+s)}catch(t){return j.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}class Wn extends _e{constructor(...t){super(),this.logger=j.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=Fs.create(),this._resource=new ai("",an.type.arraybuffer);for(const e of t)if(ea(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.emit("volumechange",new ds(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const s=await this._resource.load(),i=await this.decodeAudio(s.slice(0));return this._duration=(e=(t=this._duration)!==null&&t!==void 0?t:i==null?void 0:i.duration)!==null&&e!==void 0?e:void 0,this.emit("processed",new Nn(this,i)),this.data=i}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.emit("pause",new ds(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new ds(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.data.duration}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this.emit("playbackend",new ds(this,e)),this._tracks.splice(this.getTrackId(e),1),!0)));this.emit("resume",new ds(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=await this._getTrackInstance(this.data),e=await t.play(()=>{this.emit("playbackstart",new ds(this,t)),this.logger.debug("Playing new instance for sound",this.path)});return this.emit("playbackend",new ds(this,t)),this._tracks.splice(this.getTrackId(t),1),e}_getTrackInstance(t){const e=new Hn(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,e.playbackRate=this._playbackRate,this._tracks.push(e),e}}class Gn extends _e{constructor(t){super(),this.canvas=new di({filtering:fe.Blended,smoothing:!0,cache:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo=Jo,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=D.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=ta.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let e=document.getElementById("excalibur-play");return e||(e=document.createElement("button")),e.id="excalibur-play",e.textContent=this.playButtonText,e.style.display="none",e},this._loadingFuture=new At,t&&this.addResources(t)}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const s=t.length;for(e;e<s;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Re(500,(t=this._engine)===null||t===void 0?void 0:t.clock);else{const s=()=>{this._positionPlayButton()};return!((e=this._engine)===null||e===void 0)&&e.browser&&this._engine.browser.window.on("resize",s),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",n=>{n.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(n=>{const o=h=>{var l;h.stopPropagation(),this.hidePlayButton(),!((l=this._engine)===null||l===void 0)&&l.browser&&this._engine.browser.window.off("resize",s),n()};this._playButton.addEventListener("click",o),this._playButton.addEventListener("touchend",o),this._playButton.addEventListener("pointerup",o)})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}areResourcesLoaded(){return this._loadingFuture.promise}async load(){var t,e;await((t=this._image)===null||t===void 0?void 0:t.decode()),this.canvas.flagDirty(),await Promise.all(this._resourceList.map(async s=>{await s.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty()})}));for(const s of this._resourceList)s instanceof Wn&&s.wireEngine(this._engine);return this._loadingFuture.resolve(),await Re(200,(e=this._engine)===null||e===void 0?void 0:e.clock),this.canvas.flagDirty(),await this.showPlayButton(),await ys.unlock(),this.data=this._resourceList}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?M(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}_positionPlayButton(){if(this._engine){const t=this._engine.screen.viewport.height,e=this._engine.screen.viewport.width;if(this._playButtonRootElement){const s=this._engine.canvas.offsetLeft,i=this._engine.canvas.offsetTop,n=this._playButton.clientWidth,o=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${s+e/2-n/2}px`,this._playButtonRootElement.style.top=`${i+t/2-o/2+100}px`)}}}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,s=this._engine.canvasWidth/this._engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,s,e);let i=e/2;const n=Math.min(this.logoWidth,s*.75);let o=s/2-n/2;this.logoPosition&&(o=this.logoPosition.x,i=this.logoPosition.y);const h=Math.floor(n*(this.logoHeight/this.logoWidth)),l=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,i,n,h):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,i-h-20,n,h),!this.suppressPlayButton&&this._playButtonShown){this._engine.setAntialiasing(l);return}let c=o,u=i;this.loadingBarPosition&&(c=this.loadingBarPosition.x,u=this.loadingBarPosition.y),t.lineWidth=2,on(t,c,u,n,20,10,this.loadingBarColor);const m=n*this.progress,y=5,A=m-y*2,F=20-y*2;on(t,c+y,u+y,A>10?A:10,F,5,null,this.loadingBarColor),this._engine.setAntialiasing(l)}}const Vn={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Xn{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],s=this.getBrowserFeatures();for(const i of Object.keys(Vn))s[i]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Vn[i]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:(()=>!!navigator.getGamepads)()}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),j.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||j.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}var rt;(function(r){r.PreventCollision="PreventCollision",r.Passive="Passive",r.Active="Active",r.Fixed="Fixed"})(rt||(rt={}));const Yn=5,Ds={},sa=()=>{for(const r in Ds)Ds[r]=0},pi=(r,t)=>{const e=x.isEnabled("suppress-obsolete-message");Ds[r]<Yn&&!e&&(j.getInstance().warn(r),console.trace&&t.showStackTrace&&console.trace()),Ds[r]++};function Zn(r){return r={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...r},function(t,e,s){if(s&&!(typeof s.value=="function"||typeof s.get=="function"||typeof s.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const n=`${`${t.name||""}${t.name&&e?".":""}${e||""}`} is marked obsolete: ${r.message}`+(r.alternateMethod?` Use ${r.alternateMethod} instead`:"");Ds[n]||(Ds[n]=0);const o=s?{...s}:t;if(!s){class h extends o{constructor(...c){pi(n,r),super(...c)}}return h}return s&&s.value?(o.value=function(){return pi(n,r),s.value.apply(this,arguments)},o):(s&&s.get&&(o.get=function(){return pi(n,r),s.get.apply(this,arguments)}),s&&s.set&&(o.set=function(){return pi(n,r),s.set.apply(this,arguments)}),o)}}var ia=function(r,t,e,s){var i=arguments.length,n=i<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,s);else for(var h=r.length-1;h>=0;h--)(o=r[h])&&(n=(i<3?o(n):i>3?o(t,e,n):o(t,e))||n);return i>3&&n&&Object.defineProperty(t,e,n),n},bs;(function(r){r.Arcade="arcade",r.Realistic="realistic"})(bs||(bs={}));var fi;(function(r){r[r.DynamicAABBTree=0]="DynamicAABBTree"})(fi||(fi={}));var gi;(function(r){r[r.Euler=0]="Euler"})(gi||(gi={}));class Q{static get gravity(){return Q.acc}static set gravity(t){Q.acc=t}static useArcadePhysics(){Q.collisionResolutionStrategy=bs.Arcade}static useRealisticPhysics(){Q.collisionResolutionStrategy=bs.Realistic}static get dynamicTreeVelocityMultiplyer(){return Q.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){Q.dynamicTreeVelocityMultiplier=t}}Q.acc=new v(0,0),Q.enabled=!0,Q.broadphaseStrategy=fi.DynamicAABBTree,Q.collisionResolutionStrategy=bs.Arcade,Q.defaultMass=10,Q.integrator=gi.Euler,Q.dynamicTreeVelocityMultiplier=2,Q.boundsPadding=5,Q.positionIterations=3,Q.velocityIterations=8,Q.slop=1,Q.steeringFactor=.2,Q.warmStart=!0,Q.bodiesCanSleepByDefault=!1,Q.surfaceEpsilon=.1,Q.sleepEpsilon=.07,Q.wakeThreshold=Q.sleepEpsilon*3,Q.sleepBias=.9,Q.checkForFastBodies=!0,Q.disableMinimumSpeedForFastBody=!1,ia([Zn({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],Q,"dynamicTreeVelocityMultiplyer",null);var ne;(function(r){r.World="world",r.Screen="screen"})(ne||(ne={}));class ln extends v{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class jn extends v{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){this.change(t,this._y),this._x=this.original.x=t}get y(){return this._y=this.original.y}set y(t){this.change(this._x,t),this._y=this.original.y=t}}class Zs{constructor(){this._parent=null,this._children=[],this._pos=P(0,0),this._rotation=0,this._scale=P(1,1),this._isDirty=!1,this._isInverseDirty=!1,this._matrix=wt.identity(),this._inverse=wt.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){t.equals(this._pos)||(this._pos.x=t.x,this._pos.y=t.y,this.flagDirty())}get pos(){return new jn(this._pos,(t,e)=>{(t!==this._pos.x||e!==this._pos.y)&&this.flagDirty()})}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return new ln({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(P(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(P(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}})}set rotation(t){const e=W(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const s=W(t+e);s!==this._rotation&&this.flagDirty(),this._rotation=s}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){t.equals(this._scale)||(this._scale.x=t.x,this._scale.y=t.y,this.flagDirty())}get scale(){return new jn(this._scale,(t,e)=>{(t!==this._scale.x||e!==this._scale.y)&&this.flagDirty()})}set globalScale(t){let e=P(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(P(1/e.x,1/e.y))}get globalScale(){return new ln({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}})}get matrix(){return this._isDirty&&(this.parent===null?this._matrix=this._calculateMatrix():this._matrix=this.parent.matrix.multiply(this._calculateMatrix()),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this._inverse=this.matrix.inverse(),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return wt.identity().translate(this.pos.x,this.pos.y).rotate(this.rotation).scale(this.scale.x,this.scale.y)}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,s){this._pos.x=t.x,this._pos.y=t.y,this._rotation=W(e),this._scale.x=s.x,this._scale.y=s.y,this.flagDirty()}clone(t){const e=t??new Zs;this._pos.clone(e._pos),e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty()}}function na(r){return!!(r!=null&&r.clone)}class re{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const s=this[e];na(s)&&e!=="owner"&&e!=="clone"?t[e]=s.clone():t[e]=s}return t}}class cn extends re{constructor(t,e){super(),this.type=t,this.value=e}}class He{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let i=0;i<e;i++)this.observers[i].notify(t);const s=this.subscriptions.length;for(let i=0;i<s;i++)this.subscriptions[i](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class X extends re{constructor(){super(...arguments),this.type="ex.transform",this._transform=new Zs,this._addChildTransform=t=>{const e=t.get(X);e&&(e._transform.parent=this._transform)},this.zIndexChanged$=new He,this._z=0,this.coordPlane=ne.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const s=e.get(X);s&&(s._transform.parent=null)})}onRemove(t){this._transform.parent=null}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}}class Ft extends re{constructor(){super(...arguments),this.type="ex.motion",this.vel=v.Zero,this.acc=v.Zero,this.scaleFactor=v.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class qe{constructor(t,e,s){this._name=t,this._category=e,this._mask=s}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return(this.category&t.mask)!==0&&(t.category&this.mask)!==0}invert(){return new qe("~("+this.name+")",~this.category,~this.mask)}static combine(t){const e=t.map(n=>n.name).join("+"),s=t.reduce((n,o)=>o.category|n,0),i=~s;return new qe(e,s,i)}static collidesWith(t){return qe.combine(t).invert()}}qe.All=new qe("Collide with all groups",-1,-1);class oe{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=oe.calculatePairHash(t.id,e.id)}static canCollide(t,e){var s,i;const n=(s=t==null?void 0:t.owner)===null||s===void 0?void 0:s.get(ht),o=(i=e==null?void 0:e.owner)===null||i===void 0?void 0:i.get(ht);return!(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions()||!n||!o||!n.group.canCollide(o.group)||n.collisionType===rt.Fixed&&o.collisionType===rt.Fixed||o.collisionType===rt.PreventCollision||n.collisionType===rt.PreventCollision||!n.active||!o.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return oe.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class js{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class dn{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new Z,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class un{constructor(t=new Z(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let s=this.root;for(;!s.isLeaf();){const h=s.left,l=s.right,c=s.bounds.getPerimeter(),m=s.bounds.combine(e).getPerimeter(),y=2*m,A=2*(m-c);let F=0;const z=e.combine(h.bounds);let U,S;h.isLeaf()?F=z.getPerimeter()+A:(S=h.bounds.getPerimeter(),U=z.getPerimeter(),F=U-S+A);let T=0;const Y=e.combine(l.bounds);if(l.isLeaf()?T=Y.getPerimeter()+A:(S=l.bounds.getPerimeter(),U=Y.getPerimeter(),T=U-S+A),y<F&&y<T)break;F<T?s=h:s=l}const i=s.parent,n=new dn(i);n.bounds=e.combine(s.bounds),n.height=s.height+1,i!==null?(i.left===s?i.left=n:i.right=n,n.left=s,n.right=t,s.parent=n,t.parent=n):(n.left=s,n.right=t,s.parent=n,t.parent=n,this.root=n);let o=t.parent;for(;o;){if(o=this._balance(o),!o.left)throw new Error("Parent of current leaf cannot have a null left child"+o);if(!o.right)throw new Error("Parent of current leaf cannot have a null right child"+o);o.height=1+Math.max(o.left.height,o.right.height),o.bounds=o.left.bounds.combine(o.right.bounds),o=o.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,s=e.parent;let i;if(e.left===t?i=e.right:i=e.left,s){s.left===e?s.left=i:s.right=i,i.parent=s;let n=s;for(;n;)n=this._balance(n),n.bounds=n.left.bounds.combine(n.right.bounds),n.height=1+Math.max(n.left.height,n.right.height),n=n.parent}else this.root=i,i.parent=null}trackCollider(t){const e=new dn;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const s=this.nodes[t.id.value];if(!s)return!1;const i=t.bounds;if(!this.worldBounds.contains(i))return j.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(s.bounds.contains(i))return!1;if(this._remove(s),i.left-=Q.boundsPadding,i.top-=Q.boundsPadding,i.right+=Q.boundsPadding,i.bottom+=Q.boundsPadding,t.owner){const n=(e=t.owner)===null||e===void 0?void 0:e.get(ht);if(n){const o=n.vel.x*32/1e3*Q.dynamicTreeVelocityMultiplier,h=n.vel.y*32/1e3*Q.dynamicTreeVelocityMultiplier;o<0?i.left+=o:i.right+=o,h<0?i.top+=h:i.bottom+=h}}return s.bounds=i,this._insert(s),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,s=t.right,i=t,n=e,o=s,h=e.left,l=e.right,c=s.left,u=s.right,m=o.height-n.height;if(m>1)return o.left=i,o.parent=i.parent,i.parent=o,o.parent?o.parent.left===i?o.parent.left=o:o.parent.right=o:this.root=o,c.height>u.height?(o.right=c,i.right=u,u.parent=i,i.bounds=n.bounds.combine(u.bounds),o.bounds=i.bounds.combine(c.bounds),i.height=1+Math.max(n.height,u.height),o.height=1+Math.max(i.height,c.height)):(o.right=u,i.right=c,c.parent=i,i.bounds=n.bounds.combine(c.bounds),o.bounds=i.bounds.combine(u.bounds),i.height=1+Math.max(n.height,c.height),o.height=1+Math.max(i.height,u.height)),o;if(m<-1){if(n.left=i,n.parent=i.parent,i.parent=n,n.parent)if(n.parent.left===i)n.parent.left=n;else{if(n.parent.right!==i)throw"Error rotating Dynamic Tree";n.parent.right=n}else this.root=n;return h.height>l.height?(n.right=h,i.left=l,l.parent=i,i.bounds=o.bounds.combine(l.bounds),n.bounds=i.bounds.combine(h.bounds),i.height=1+Math.max(o.height,l.height),n.height=1+Math.max(i.height,h.height)):(n.right=l,i.left=h,h.parent=i,i.bounds=o.bounds.combine(h.bounds),n.bounds=i.bounds.combine(l.bounds),i.height=1+Math.max(o.height,h.height),n.height=1+Math.max(i.height,l.height)),n}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const s=t.bounds,i=n=>{if(n&&n.bounds.overlaps(s))if(n.isLeaf()&&n.data!==t){if(e.call(t,n.data))return!0}else return i(n.left)||i(n.right);return!1};i(this.root)}rayCastQuery(t,e=1/0,s){const i=n=>{if(n&&n.bounds.rayCast(t,e))if(n.isLeaf()){if(s.call(t,n.data))return!0}else return i(n.left)||i(n.right);return!1};i(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=s=>{s&&(s.isLeaf()?s.bounds.draw(t,D.Green):s.bounds.draw(t,D.White),s.left&&e(s.left),s.right&&e(s.right))};e(this.root)}}class $e{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const s=this.dir.cross(t.getSlope());if(s===0)return-1;const i=e.cross(t.getSlope())/s;if(i>=0){const n=e.cross(this.dir)/s/t.getLength();if(n>=0&&n<=1)return i}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class pn{constructor(){this._dynamicCollisionTree=new un,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[]}getColliders(){return this._colliders}track(t){if(!t){j.getInstance().warn("Cannot track null collider");return}if(t instanceof Zt){const e=t.getColliders();for(const s of e)s.owner=t.owner,this._colliders.push(s),this._dynamicCollisionTree.trackCollider(s)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){j.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof Zt){const e=t.getColliders();for(const s of e){const i=this._colliders.indexOf(s);i!==-1&&this._colliders.splice(i,1),this._dynamicCollisionTree.untrackCollider(s)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const s=oe.calculatePairHash(t.id,e.id);return this._pairs.has(s)}broadphase(t,e,s){const i=e/1e3,n=t.filter(h=>{var l,c;const u=(l=h.owner)===null||l===void 0?void 0:l.get(ht);return((c=h.owner)===null||c===void 0?void 0:c.active)&&u.collisionType!==rt.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let o;for(let h=0,l=n.length;h<l;h++)o=n[h],this._dynamicCollisionTree.query(o,c=>{if(!this._pairExists(o,c)&&oe.canCollide(o,c)){const u=new oe(o,c);this._pairs.add(u.id),this._collisionPairCache.push(u)}return!1});if(s&&(s.physics.pairs=this._collisionPairCache.length),Q.checkForFastBodies)for(const h of n){const l=h.owner.get(ht);if(l.collisionType!==rt.Active)continue;const c=l.vel.size*i+l.acc.size*.5*i*i,u=Math.min(h.bounds.height,h.bounds.width);if(Q.disableMinimumSpeedForFastBody||c>u/2){s&&s.physics.fastBodies++;const m=l.globalPos.sub(l.oldPos),y=h.center,A=h.getFurthestPoint(l.vel),F=A.sub(m),z=new $e(F,l.vel);z.pos=z.pos.add(z.dir.scale(-2*Q.surfaceEpsilon));let U,S=new v(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(z,c+Q.surfaceEpsilon*2,T=>{if(!this._pairExists(h,T)&&oe.canCollide(h,T)){const Y=T.rayCast(z,c+Q.surfaceEpsilon*10);if(Y){const G=Y.sub(F);G.size<S.size&&(S=G,U=T)}}return!1}),U&&v.isValid(S)){const T=new oe(h,U);this._pairs.has(T.id)||(this._pairs.add(T.id),this._collisionPairCache.push(T));const Y=y.sub(A);l.globalPos=F.add(Y).add(S).add(z.dir.scale(10*Q.surfaceEpsilon)),h.update(l.transform.get()),s&&s.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let s=[];for(let i=0;i<t.length;i++){const n=t[i].collide();if(s=s.concat(n),e&&n.length>0)for(const o of n)e.physics.contacts.set(o.id,o)}return e&&(e.physics.collisions+=s.length),s}update(t){let e=0;const s=t.length;for(let i=0;i<s;i++)this._dynamicCollisionTree.updateCollider(t[i])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class us{constructor(){this.id=C("collider",us._ID++),this.__compositeColliderId=null,this.events=new hs}touching(t){return!!this.collide(t)}}us._ID=0;class Zt extends us{constructor(t){super(),this._collisionProcessor=new pn,this._dynamicAABBTree=new un,this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){this.events.wire(t.events),t.__compositeColliderId=this.id,this._colliders.push(t),this._collisionProcessor.track(t),this._dynamicAABBTree.trackCollider(t)}removeCollider(t){this.events.unwire(t.events),t.__compositeColliderId=null,Qt(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:v.Zero}get center(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:v.Zero}get bounds(){var t,e;const s=this.getColliders();return s.reduce((n,o)=>n.combine(o.bounds),(e=(t=s[0])===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new Z().translate(this.worldPos))}get localBounds(){var t,e;const s=this.getColliders();return s.reduce((n,o)=>n.combine(o.localBounds),(e=(t=s[0])===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new Z)}get axes(){const t=this.getColliders();let e=[];for(const s of t)e=e.concat(s.axes);return e}getFurthestPoint(t){const e=this.getColliders(),s=[];for(const o of e)s.push(o.getFurthestPoint(t));let i=s[0],n=-Number.MAX_VALUE;for(const o of s){const h=o.dot(t);h>n&&(i=o,n=h)}return i}getInertia(t){const e=this.getColliders();let s=0;for(const i of e)s+=i.getInertia(t);return s}collide(t){let e=[t];t instanceof Zt&&(e=t.getColliders());const s=[];for(const n of e)this._dynamicAABBTree.query(n,o=>(s.push(new oe(n,o)),!1));let i=[];for(const n of s)i=i.concat(n.collide());return i}getClosestLineBetween(t){const e=this.getColliders(),s=[];if(t instanceof Zt){const i=t.getColliders();for(const n of e)for(const o of i){const h=n.getClosestLineBetween(o);h&&s.push(h)}}else for(const i of e){const n=t.getClosestLineBetween(i);n&&s.push(n)}if(s.length){let i=s[0].getLength(),n=s[0];for(const o of s){const h=o.getLength();h<i&&(i=h,n=o)}return n}return null}contains(t){const e=this.getColliders();for(const s of e)if(s.contains(t))return!0;return!1}rayCast(t,e){const s=this.getColliders(),i=[];for(const n of s){const o=n.rayCast(t,e);o&&i.push(o)}if(i.length){let n=i[0],o=n.dot(t.dir);for(const h of i){const l=t.dir.dot(h);l<o&&(n=h,o=l)}return n}return null}project(t){const e=this.getColliders(),s=[];for(const i of e){const n=i.project(t);n&&s.push(n)}if(s.length){const i=new js(s[0].min,s[0].max);for(const n of s)i.min=Math.min(n.min,i.min),i.max=Math.max(n.max,i.max);return i}return null}update(t){if(t){const e=this.getColliders();for(const s of e)s.owner=this.owner,s.update(t)}}debug(t,e){const s=this.getColliders();for(const i of s)i.debug(t,e)}clone(){return new Zt(this._colliders.map(t=>t.clone()))}}class qt{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,s=t.distance(e);return this._slope=e.sub(t).scale(1/s)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){if(this._length)return this._length;const t=this.begin,e=this.end,s=t.distance(e);return this._length=s}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new qt(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e){let s=t;s=s.normalize();const i=s.dot(this.begin)-e,n=s.dot(this.end)-e,o=[];if(i<=0&&o.push(this.begin),n<=0&&o.push(this.end),i*n<0){const h=i/(i-n);o.push(this.begin.add(this.end.sub(this.begin).scale(h)))}return o.length!==2?null:new qt(o[0],o[1])}distanceToPoint(t,e=!1){const s=t.x,i=t.y,n=this.getLength(),o=this.end.y-this.begin.y,h=this.end.x-this.begin.x,l=(o*s-h*i+this.end.x*this.begin.y-this.end.y*this.begin.x)/n;return e?l:Math.abs(l)}findVectorToPoint(t){const e=this.begin.sub(t),s=this.getSlope();return e.sub(s.scale(e.dot(s)))}findPoint(t=null,e=null){const s=this.slope,i=this.intercept;if(t!==null)return new v(t,s*t+i);if(e!==null)return new v((e-i)/s,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new v(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof v)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const s=t.x-this.begin.x,i=t.y-this.begin.y,n=this.end.x-this.begin.x,o=this.end.y-this.begin.y,h=s*o-i*n;return Math.abs(h)>e?!1:Math.abs(n)>=Math.abs(o)?n>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:o>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function _i(r,t,e,s){const i=r.sub(e),n=t.dot(t),o=t.dot(s),h=s.dot(s),l=t.dot(i),c=s.dot(i),u=n*h-o*o;let m=u,y=u;if(u===0||u<=.01){const z=l/o;return new qt(r,e.add(s.scale(z)))}let A=o*c-h*l,F=n*c-o*l;return A<0?(A=0,F=c,y=h):A>m&&(A=m,F=c+o,y=h),F<0?(F=0,-l<0?A=0:-l>n?A=m:(A=-l,m=n)):F>y&&(F=y,-l+o<0?A=0:-l+o>n?A=m:(A=-l+o,m=n)),A=Math.abs(A)<.001?0:A/m,F=Math.abs(F)<.001?0:F/y,new qt(r.add(t.scale(A)),e.add(s.scale(F)))}const Ne={PolygonPolygonClosestLine(r,t){const e=t.worldPos,s=e.sub(r.worldPos),i=s.negate(),n=new $e(r.worldPos,s),o=new $e(e,i),h=r.rayCast(n).add(n.dir.scale(.1)),l=t.rayCast(o).add(o.dir.scale(.1)),c=r.getClosestFace(h),u=t.getClosestFace(l),m=c.face.begin,y=c.face.getEdge(),A=u.face.begin,F=u.face.getEdge();return _i(m,y,A,F)},PolygonEdgeClosestLine(r,t){const s=t.worldPos.sub(r.worldPos),i=new $e(r.worldPos,s),n=r.rayCast(i).add(i.dir.scale(.1)),o=r.getClosestFace(n),h=o.face.begin,l=o.face.getEdge(),c=t.asLine(),u=c.begin,m=c.getEdge();return _i(h,l,u,m)},PolygonCircleClosestLine(r,t){const e=t.worldPos,s=e.sub(r.worldPos),i=new $e(r.worldPos,s.normalize()),n=r.rayCast(i).add(i.dir.scale(.1)),o=r.getClosestFace(n),h=o.face.begin,l=o.face.getEdge();let c=(l.x*(e.x-h.x)+l.y*(e.y-h.y))/(l.x*l.x+l.y*l.y);c>1?c=1:c<0&&(c=0);const u=Math.sqrt(Math.pow(h.x+l.x*c-e.x,2)+Math.pow(h.y+l.y*c-e.y,2))-t.radius,m=(h.x+l.x*c-e.x)*t.radius/(t.radius+u),y=(h.y+l.y*c-e.y)*t.radius/(t.radius+u);return new qt(l.scale(c).add(h),new v(e.x+m,e.y+y))},CircleCircleClosestLine(r,t){const s=t.worldPos.sub(r.worldPos),n=r.worldPos.sub(t.worldPos),o=new $e(r.worldPos,s),h=new $e(t.worldPos,n),l=r.rayCast(o),c=t.rayCast(h);return new qt(l,c)},CircleEdgeClosestLine(r,t){const e=r.worldPos,s=t.asLine(),i=s.begin,n=s.getEdge(),o=i,h=n;let l=(h.x*(e.x-o.x)+h.y*(e.y-o.y))/(h.x*h.x+h.y*h.y);l>1?l=1:l<0&&(l=0);const c=Math.sqrt(Math.pow(o.x+h.x*l-e.x,2)+Math.pow(o.y+h.y*l-e.y,2))-r.radius,u=(o.x+h.x*l-e.x)*r.radius/(r.radius+c),m=(o.y+h.y*l-e.y)*r.radius/(r.radius+c);return new qt(h.scale(l).add(o),new v(e.x+u,e.y+m))},EdgeEdgeClosestLine(r,t){const e=r.asLine(),s=e.begin,i=e.getEdge(),n=s,o=i,h=t.asLine(),l=h.begin,c=h.getEdge();return _i(n,o,l,c)}};class Nt extends us{constructor(t){super(),this.offset=v.Zero,this._globalMatrix=wt.identity(),this.offset=t.offset||v.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;const e=this._transform,s=(t=e==null?void 0:e.globalScale)!==null&&t!==void 0?t:v.One;return this._naturalRadius*Math.min(s.x,s.y)}set radius(t){var e;const s=this._transform,i=(e=s==null?void 0:s.globalScale)!==null&&e!==void 0?e:v.One;this._naturalRadius=t/Math.min(i.x,i.y)}clone(){return new Nt({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,s;return((s=(e=this._transform)===null||e===void 0?void 0:e.pos)!==null&&s!==void 0?s:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){const s=this.center,i=t.dir,n=t.pos,o=Math.sqrt(Math.pow(i.dot(n.sub(s)),2)-Math.pow(n.sub(s).distance(),2)+Math.pow(this.radius,2));if(o<0)return null;{let h=0;if(o===0)return h=-i.dot(n.sub(s)),h>0&&h<e?t.getPoint(h):null;{const l=-i.dot(n.sub(s))+o,c=-i.dot(n.sub(s))-o,u=[];l>=0&&u.push(l),c>=0&&u.push(c);const m=Math.min(...u);return m<=e?t.getPoint(m):null}}}getClosestLineBetween(t){if(t instanceof Nt)return Ne.CircleCircleClosestLine(this,t);if(t instanceof Ot)return Ne.PolygonCircleClosestLine(t,this).flip();if(t instanceof ee)return Ne.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Nt)return Ee.CollideCircleCircle(this,t);if(t instanceof Ot)return Ee.CollideCirclePolygon(this,t);if(t instanceof ee)return Ee.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,e,s;const i=this._transform,n=(t=i==null?void 0:i.globalScale)!==null&&t!==void 0?t:v.One,o=(e=i==null?void 0:i.globalRotation)!==null&&e!==void 0?e:0,h=(s=i==null?void 0:i.globalPos)!==null&&s!==void 0?s:v.Zero;return new Z(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(o).scale(n).translate(h)}get localBounds(){return new Z(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],i=this.center.dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new js(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){var s,i,n,o;const h=this._transform,l=(s=h==null?void 0:h.globalScale)!==null&&s!==void 0?s:v.One,c=(i=h==null?void 0:h.globalRotation)!==null&&i!==void 0?i:0,u=(n=h==null?void 0:h.globalPos)!==null&&n!==void 0?n:v.Zero;t.save(),t.translate(u.x,u.y),t.rotate(c),t.scale(l.x,l.y),t.drawCircle((o=this.offset)!==null&&o!==void 0?o:v.Zero,this._naturalRadius,D.Transparent,e,2),t.restore()}}class As{constructor(t,e,s,i,n,o,h,l){var c,u;this._canceled=!1,this.colliderA=t,this.colliderB=e,this.mtv=s,this.normal=i,this.tangent=n,this.points=o,this.localPoints=h,this.info=l,this.id=oe.calculatePairHash(t.id,e.id),(t.__compositeColliderId||e.__compositeColliderId)&&(this.id+="|"+oe.calculatePairHash((c=t.__compositeColliderId)!==null&&c!==void 0?c:t.id,(u=e.__compositeColliderId)!==null&&u!==void 0?u:e.id))}matchAwake(){const t=this.colliderA.owner.get(ht),e=this.colliderB.owner.get(ht);t&&e&&t.sleeping!==e.sleeping&&(t.sleeping&&t.collisionType!==rt.Fixed&&e.sleepMotion>=Q.wakeThreshold&&t.setSleeping(!1),e.sleeping&&e.collisionType!==rt.Fixed&&t.sleepMotion>=Q.wakeThreshold&&e.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class fn{static findPolygonPolygonSeparation(t,e){let s=-Number.MAX_VALUE,i=null,n=null,o=-1,h=null;const l=t.getSides(),c=t.getLocalSides();for(let u=0;u<l.length;u++){const m=l[u],y=m.normal(),A=e.getFurthestPoint(y.negate()),F=m.distanceToPoint(A,!0);F>s&&(s=F,i=m,n=y,o=u,h=A)}return{collider:t,separation:n?s:99,axis:n,side:i,localSide:c[o],sideId:o,point:h,localPoint:n?e.getFurthestLocalPoint(n.negate()):null}}static findCirclePolygonSeparation(t,e){const s=e.axes,n=e.center.sub(t.worldPos),o=e.getFurthestPoint(n.negate());s.push(o.sub(t.worldPos).normalize());let h=Number.MAX_VALUE,l=null,c=-1;for(let u=0;u<s.length;u++){const m=e.project(s[u]),y=t.project(s[u]),A=m.getOverlap(y);if(A<=0)return null;A<h&&(h=A,l=s[u],c=u)}return c<0?null:l.normalize().scale(h)}}const Ee={CollideCircleCircle(r,t){const e=r.worldPos,s=t.worldPos,i=r.radius+t.radius,n=e.distance(s);if(n>i)return[];const o=i-n,h=s.sub(e).normalize(),l=h.perpendicular(),c=h.scale(o),u=r.getFurthestPoint(h),m=r.getFurthestLocalPoint(h),y={collider:r,separation:o,axis:h,point:u};return[new As(r,t,c,h,l,[u],[m],y)]},CollideCirclePolygon(r,t){var e,s;let i=fn.findCirclePolygonSeparation(r,t);if(!i)return[];i=i.dot(t.center.sub(r.center))<0?i.negate():i;const o=r.getFurthestPoint(i),l=((s=(e=r.owner)===null||e===void 0?void 0:e.get(X))!==null&&s!==void 0?s:new X).applyInverse(o),c=i.normalize(),u={collider:r,separation:-i.size,axis:c,point:o,localPoint:l,side:t.findSide(c.negate()),localSide:t.findLocalSide(c.negate())};return[new As(r,t,i,c,c.perpendicular(),[o],[l],u)]},CollideCircleEdge(r,t){const e=r.center,s=t.asLine(),i=s.end.sub(s.begin),n=i.dot(s.end.sub(e)),o=i.dot(e.sub(s.begin)),h=t.asLine(),l=t.asLocalLine();if(o<=0){const S=s.begin.sub(e),T=S.dot(S);if(T>r.radius*r.radius)return[];const Y=S.normalize(),G=r.radius-Math.sqrt(T),st={collider:r,separation:G,axis:Y,point:h.begin,side:h,localSide:l};return[new As(r,t,Y.scale(G),Y,Y.perpendicular(),[h.begin],[l.begin],st)]}if(n<=0){const S=s.end.sub(e),T=S.dot(S);if(T>r.radius*r.radius)return[];const Y=S.normalize(),G=r.radius-Math.sqrt(T),st={collider:r,separation:G,axis:Y,point:h.end,side:h,localSide:l};return[new As(r,t,Y.scale(G),Y,Y.perpendicular(),[h.end],[l.end],st)]}const c=i.dot(i),u=s.begin.scale(n).add(s.end.scale(o)).scale(1/c),m=e.sub(u),y=m.dot(m);if(y>r.radius*r.radius)return[];let A=i.perpendicular();A.dot(e.sub(s.begin))<0&&(A.x=-A.x,A.y=-A.y),A=A.normalize();const F=r.radius-Math.sqrt(y),z=A.scale(F),U={collider:r,separation:F,axis:A,point:u,side:h,localSide:l};return[new As(r,t,z,A.negate(),A.negate().perpendicular(),[u],[u.sub(t.worldPos)],U)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(r,t){var e;const s=r.center,n=t.center.sub(s).normalize(),o=new Ot({points:[t.begin,t.end,t.end.add(n.scale(100)),t.begin.add(n.scale(100))],offset:t.offset});o.owner=t.owner,((e=t.owner)===null||e===void 0?void 0:e.get(X))&&o.update(t.owner.get(X).get());const l=this.CollidePolygonPolygon(r,o);return l.length&&(l[0].colliderB=t,l[0].id=oe.calculatePairHash(r.id,t.id)),l},CollidePolygonPolygon(r,t){var e,s,i,n;const o=fn.findPolygonPolygonSeparation(r,t);if(o.separation>0)return[];const h=fn.findPolygonPolygonSeparation(t,r);if(h.separation>0)return[];const l=o.separation>h.separation?o:h,u=(l.collider===r?t:r).findSide(l.axis.negate()),m=l.side,y=m.dir().normalize(),A=u.clip(y.negate(),-y.dot(m.begin));let F=null;if(A&&(F=A.clip(y,y.dot(m.end))),F){const z=F.getPoints().filter(Y=>m.below(Y));let U=l.axis,S=U.perpendicular();t.center.sub(r.center).dot(U)<0&&(U=U.negate(),S=U.perpendicular());let T=[];if(l.collider===r){const Y=(s=(e=t.owner)===null||e===void 0?void 0:e.get(X))!==null&&s!==void 0?s:new X;T=z.map(G=>Y.applyInverse(G))}else{const Y=(n=(i=r.owner)===null||i===void 0?void 0:i.get(X))!==null&&n!==void 0?n:new X;T=z.map(G=>Y.applyInverse(G))}return[new As(r,t,U.scale(-l.separation),U,S,z,T,l)]}return[]},FindContactSeparation(r,t){var e,s,i,n;const o=r.colliderA,h=(s=(e=r.colliderA.owner)===null||e===void 0?void 0:e.get(X))!==null&&s!==void 0?s:new X,l=r.colliderB,c=(n=(i=r.colliderB.owner)===null||i===void 0?void 0:i.get(X))!==null&&n!==void 0?n:new X;if(o instanceof Nt&&l instanceof Nt){const u=o.radius+l.radius,m=h.pos.distance(c.pos);return-(u-m)}if(o instanceof Ot&&l instanceof Ot&&r.info.localSide){let u,m;return r.info.collider===o?(u=new qt(h.apply(r.info.localSide.begin),h.apply(r.info.localSide.end)),m=c.apply(t)):(u=new qt(c.apply(r.info.localSide.begin),c.apply(r.info.localSide.end)),m=h.apply(t)),u.distanceToPoint(m,!0)}if(o instanceof Ot&&l instanceof Nt||l instanceof Ot&&o instanceof Nt){const u=h.apply(t);if(r.info.side)return r.info.side.distanceToPoint(u,!0)}if(o instanceof ee&&l instanceof Ot||l instanceof ee&&o instanceof Ot){let u;if(r.info.collider===o?u=c.apply(t):u=h.apply(t),r.info.side)return r.info.side.distanceToPoint(u,!0)}if(o instanceof Nt&&l instanceof ee||l instanceof Nt&&o instanceof ee){const u=c.apply(t);let m;o instanceof Nt&&(m=o.getFurthestPoint(r.normal));const y=u.distance(m);if(r.info.side)return y>0?-y:0}return 0}};class ee extends us{constructor(t){var e;super(),this._globalMatrix=wt.identity(),this.begin=t.begin||v.Zero,this.end=t.end||v.Zero,this.offset=(e=t.offset)!==null&&e!==void 0?e:v.Zero}clone(){return new ee({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),s=t.distance(e);return e.sub(t).scale(1/s)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const s=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&s.cross(t.dir)!==0)return null;const i=t.dir.cross(this.getSlope());if(i===0)return null;const n=s.cross(this.getSlope())/i;if(n>=0&&n<=e){const o=s.cross(t.dir)/i/this.getLength();if(o>=0&&o<=1)return t.getPoint(n)}return null}getClosestLineBetween(t){if(t instanceof Nt)return Ne.CircleEdgeClosestLine(t,this);if(t instanceof Ot)return Ne.PolygonEdgeClosestLine(t,this).flip();if(t instanceof ee)return Ne.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Nt)return Ee.CollideCircleEdge(t,this);if(t instanceof Ot)return Ee.CollidePolygonEdge(t,this);if(t instanceof ee)return Ee.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),s=this._getTransformedEnd();return t.dot(e)>0?e:s}_boundsFromBeginEnd(t,e,s=10){return new Z(Math.min(t.x,e.x)-s,Math.min(t.y,e.y)-s,Math.max(t.x,e.x)+s,Math.max(t.y,e.y)+s)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new qt(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new qt(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),s=[];return s.push(e),s.push(e.negate()),s.push(e.normal()),s.push(e.normal().negate()),s}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],s=[this._getTransformedBegin(),this._getTransformedEnd()],i=s.length;for(let n=0;n<i;n++)e.push(s[n].dot(t));return new js(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const s=this._getTransformedBegin(),i=this._getTransformedEnd();t.drawLine(s,i,e,2),t.drawCircle(s,2,e),t.drawCircle(i,2,e)}}class Ot extends us{constructor(t){var e,s;super(),this._logger=j.getInstance(),this._transformedPoints=[],this._sides=[],this._localSides=[],this._globalMatrix=wt.identity(),this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!==null&&e!==void 0?e:v.Zero,this._globalMatrix.translate(this.offset.x,this.offset.y),this.points=(s=t.points)!==null&&s!==void 0?s:[],this._isCounterClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}set points(t){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._sidesDirty=!0,this._points=t}get points(){return this._points}_isCounterClockwiseWinding(t){let e=0;for(let s=0;s<t.length;s++)e+=(t[(s+1)%t.length].x-t[s].x)*(t[(s+1)%t.length].y+t[s].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],s=Math.atan2(e.y-t.y,e.x-t.x),i=0,n=0,o=0;for(const[h,l]of this.points.entries()){if(t=e,i=s,e=l,s=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let c=s-i;if(c<=-Math.PI?c+=Math.PI*2:c>Math.PI&&(c-=Math.PI*2),h===0){if(c===0)return!1;n=c>0?1:-1}else if(n*c<=0)return!1;o+=c}return Math.abs(Math.round(o/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Zt(t.map(e=>Wt.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");function t(o,h){return o>=h.length?h[o%h.length]:o<0?h[o%h.length+h.length]:h[o]}function e(o,h,l,c){const u=l.sub(h),m=c.sub(l),y=h.sub(c),A=o.sub(h),F=o.sub(l),z=o.sub(c),U=u.cross(A),S=m.cross(F),T=y.cross(z);return!(U>0||S>0||T>0)}const s=[],i=[...this.points],n=V(0,this.points.length-1);for(;n.length>3;)for(let o=0;o<n.length;o++){const h=n[o],l=t(o-1,n),c=t(o+1,n),u=i[h],m=i[l],y=i[c],A=m.sub(u);if(!(y.sub(u).cross(A)>0))continue;let U=!0;for(let S=0;S<n.length;S++){const T=n[S];if(T===h||T===l||T===c)continue;const Y=i[T];if(e(Y,m,u,y)){U=!1;break}}if(U){s.push([m,u,y]),n.splice(o,1);break}}return s.push([i[n[0]],i[n[1]],i[n[2]]]),new Zt(s.map(o=>Wt.Polygon(o)))}clone(){return new Ot({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let s=0;s<e;s++)this._transformedPoints[s]=this._globalMatrix.multiply(t[s].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),s=e.length;for(let i=0;i<s;i++)t.push(new qt(e[i],e[(i+1)%s]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,s=e.length;for(let i=0;i<s;i++)t.push(new qt(e[i],e[(i+1)%s]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let s=e[0],i=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const o=e[n],l=o.normal().dot(t);l>i&&(s=o,i=l)}return s}findLocalSide(t){const e=this.getLocalSides();let s=e[0],i=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const o=e[n],l=o.normal().dot(t);l>i&&(s=o,i=l)}return s}get axes(){const t=[],e=this.getSides();for(let s=0;s<e.length;s++)t.push(e[s].normal());return t}update(t){var e;this._transform=t,this._transformedPointsDirty=!0,this._sidesDirty=!0,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}contains(t){const e=new $e(t,new v(1,0));return this.getSides().reduce(function(i,n){return e.intersect(n)>=0?i+1:i},0)%2!==0}getClosestLineBetween(t){if(t instanceof Nt)return Ne.PolygonCircleClosestLine(this,t);if(t instanceof Ot)return Ne.PolygonPolygonClosestLine(this,t);if(t instanceof ee)return Ne.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Nt)return Ee.CollideCirclePolygon(t,this);if(t instanceof Ot)return Ee.CollidePolygonPolygon(this,t);if(t instanceof ee)return Ee.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let s=null,i=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const o=t.dot(e[n]);o>i&&(i=o,s=e[n])}return s}getFurthestLocalPoint(t){const e=this.points;let s=e[0],i=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const o=t.dot(e[n]);o>i&&(i=o,s=e[n])}return s}getClosestFace(t){const e=this.getSides();let s=Number.POSITIVE_INFINITY,i=-1,n=-1;for(let o=0;o<e.length;o++){const h=e[o].distanceToPoint(t);h<s&&(s=h,i=o,n=h)}return i!==-1?{distance:e[i].normal().scale(n),face:e[i]}:null}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=Z.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,s=0;const i=this.points;for(let n=0;n<i.length;n++){const o=(n+1)%i.length,h=i[o].cross(i[n]);e+=h*(i[n].dot(i[n])+i[n].dot(i[o])+i[o].dot(i[o])),s+=h}return this._cachedMass=t,this._cachedInertia=t/6*(e/s)}rayCast(t,e=1/0){const s=this.getSides(),i=s.length;let n=Number.MAX_VALUE,o=-1;for(let h=0;h<i;h++){const l=t.intersect(s[h]);l>=0&&l<n&&l<=e&&(n=l,o=h)}return o>=0?t.getPoint(n):null}project(t){const e=this.getTransformedPoints(),s=e.length;let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let o=0;o<s;o++){const h=e[o].dot(t);i=Math.min(i,h),n=Math.max(n,h)}return new js(i,n)}debug(t,e){const s=this.getTransformedPoints()[0],i=[s,...this.getTransformedPoints(),s];for(let n=0;n<i.length-1;n++)t.drawLine(i[n],i[n+1],e,2),t.drawCircle(i[n],2,e),t.drawCircle(i[n+1],2,e)}}class Wt{static Box(t,e,s=v.Half,i=v.Zero){return new Ot({points:new Z(-t*s.x,-e*s.y,t-t*s.x,e-e*s.y).getPoints(),offset:i})}static Polygon(t,e=v.Zero){return new Ot({points:t,offset:e})}static Circle(t,e=v.Zero){return new Nt({radius:t,offset:e})}static Edge(t,e){return new ee({begin:t,end:e})}static Capsule(t,e,s=v.Zero){const i=j.getInstance();return t===e&&i.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t?new Zt([Wt.Circle(t/2,P(0,-e/2+t/2).add(s)),Wt.Box(t,e-t,v.Half,s),Wt.Circle(t/2,P(0,e/2-t/2).add(s))]):new Zt([Wt.Circle(e/2,P(-t/2+e/2,0).add(s)),Wt.Box(t-e,e,v.Half,s),Wt.Circle(e/2,P(t/2-e/2,0).add(s))])}}class Ut extends re{constructor(t){super(),this.type="ex.collider",this.events=new hs,this.$colliderAdded=new He,this.$colliderRemoved=new He,this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,this.events.wire(t.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this.events.unwire(this._collider.events),this.$colliderRemoved.notifyAll(this._collider),this._collider.owner=null,this._collider=null)}get bounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new Z}get localBounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new Z}update(){var t;const e=(t=this.owner)===null||t===void 0?void 0:t.get(X);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,s=t._collider;if(!e||!s)return[];let i=!1;if(s instanceof Zt&&(e=s,s=this._collider,i=!0),this._collider){const n=e.collide(s);return n?(i&&n.forEach(o=>{o.mtv=o.mtv.negate(),o.normal=o.normal.negate(),o.tangent=o.normal.perpendicular(),o.colliderA=this._collider,o.colliderB=t._collider}),n):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const s=e;t.events.emit("precollision",new ie(s.target.owner,s.other.owner,s.side,s.intersection))}),this.events.on("postcollision",e=>{const s=e;t.events.emit("postcollision",new pe(s.target.owner,s.other.owner,s.side,s.intersection))}),this.events.on("collisionstart",e=>{const s=e;t.events.emit("collisionstart",new Te(s.target.owner,s.other.owner,s.contact))}),this.events.on("collisionend",e=>{const s=e;t.events.emit("collisionend",new Qe(s.target.owner,s.other.owner))})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,s=v.Half,i=v.Zero){const n=Wt.Box(t,e,s,i);return this.set(n)}usePolygonCollider(t,e=v.Zero){const s=Wt.Polygon(t,e);return this.set(s)}useCircleCollider(t,e=v.Zero){const s=Wt.Circle(t,e);return this.set(s)}useEdgeCollider(t,e){const s=Wt.Edge(t,e);return this.set(s)}useCompositeCollider(t){return this.set(new Zt(t))}}var $t;(function(r){r.Rotation="rotation",r.X="x",r.Y="y"})($t||($t={}));class ht extends re{constructor(t){var e,s,i;super(),this.type="ex.body",this.dependencies=[X,Ft],this.id=C("body",ht._ID++),this.events=new hs,this._oldTransform=new Zs,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=rt.PreventCollision,this.group=qe.All,this._mass=Q.defaultMass,this.sleepMotion=Q.sleepEpsilon*5,this.canSleep=Q.bodiesCanSleepByDefault,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldVel=new v(0,0),this.oldAcc=v.Zero,t&&(this.collisionType=(e=t.type)!==null&&e!==void 0?e:this.collisionType,this.group=(s=t.group)!==null&&s!==void 0?s:this.group,this.useGravity=(i=t.useGravity)!==null&&i!==void 0?i:this.useGravity)}get matrix(){return this.transform.get().matrix}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===rt.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=v.Zero,this.acc=v.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=Q.sleepEpsilon*5}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),e=Q.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=M(this.sleepMotion,0,10*Q.sleepEpsilon),this.canSleep&&this.sleepMotion<Q.sleepEpsilon&&this.setSleeping(!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Ut);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===rt.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.active)}get center(){return this.globalPos}get transform(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(X)}get motion(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(Ft)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this._oldTransform.pos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this._oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this._oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==rt.Active)return;const s=e.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes($t.X)&&(s.x=0),this.limitDegreeOfFreedom.includes($t.Y)&&(s.y=0),this.vel.addEqual(s),!this.limitDegreeOfFreedom.includes($t.Rotation)){const i=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==rt.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes($t.X)&&(e.x=0),this.limitDegreeOfFreedom.includes($t.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===rt.Active&&!this.limitDegreeOfFreedom.includes($t.Rotation)){const s=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*s.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0,this.transform.get().clone(this._oldTransform),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y)}}ht._ID=0;class Qn{constructor(t){this.data=t,this.type="Component Added"}}function qn(r){return!!r&&r.type==="Component Added"}class $n{constructor(t){this.data=t,this.type="Component Removed"}}function Kn(r){return!!r&&r.type==="Component Removed"}class Gt extends _e{constructor(t,e){if(super(),this.id=Gt._ID++,this._name="anonymous",this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new He,this.componentRemoved$=new He,this._parent=null,this.childrenAdded$=new He,this.childrenRemoved$=new He,this._children=[],this._isInitialized=!1,this._setName(e),t)for(const s of t)this.addComponent(s)}_setName(t){t&&(this._name=t)}get name(){return this._name}get events(){return this.eventDispatcher}kill(){this.active=!1}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new cn(t))}removeTag(t,e=!1){return this.removeComponent(t,e)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter(t=>t instanceof cn).map(t=>t.type),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();const e=new Qn({component:t,entity:this});this.componentAdded$.notifyAll(e)}_notifyRemoveComponent(t){const e=new $n({component:t,entity:this});this.componentRemoved$.notifyAll(e),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(Qt(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){return this.children.forEach(t=>{this.removeChild(t)}),this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const s=e.pop();e=e.concat(s.children),t=t.concat(s.children)}return t}clone(){const t=new Gt;for(const e of this.types)t.addComponent(this.get(e).clone());for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const s of t.getComponents())this.addComponent(s.clone(),e);for(const s of t.children)this.addChild(s.clone().addTemplate(s));return this}addComponent(t,e=!1){if(this.has(t.type))if(e)this.removeComponent(t);else return this;if(t.dependencies&&t.dependencies.length)for(const i of t.dependencies)this.addComponent(new i);t.owner=this;const s=t.constructor;return this._componentTypeToInstance.set(s,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,e=!1){return e?typeof t=="string"?this._removeComponentByType(t):t instanceof re&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){if(this.has(t)){const e=this.get(t);e.owner=null,e.onRemove&&e.onRemove(this);const s=e.constructor;this._componentTypeToInstance.delete(s),this._componentStringToInstance.delete(e.type),this._notifyRemoveComponent(e)}}processComponentRemoval(){for(const t of this._componentsToRemove){const e=typeof t=="string"?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return typeof t=="string"?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return typeof t=="string"?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new N(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new Rt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Yt(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const s of this.children)s.update(t,e);this._postupdate(t,e)}}Gt._ID=0;function gn(r){return!!r.tick}class _n{constructor(t,e){this._options=t,this._graphics=e,this.graphics=[]}get name(){return this._options.name}hide(t){if(!t)this.graphics.length=0;else{let e=null;t instanceof te?e=t:e=this._graphics.getGraphic(t),this.graphics=this.graphics.filter(s=>s.graphic!==e),this._graphics.recalculateBounds()}}show(t,e){e={...e};let s;return t instanceof te?s=this._graphics.copyGraphics?t.clone():t:(s=this._graphics.getGraphic(t),s||j.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),s?(this.graphics.push({graphic:s,options:e}),this._graphics.recalculateBounds(),s):null}use(t,e){return e={...e},this.hide(),this.show(t,e)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return(t=this._options.offset)!==null&&t!==void 0?t:v.Zero}set offset(t){this._options.offset=t}get currentKeys(){var t;return(t=this.name)!==null&&t!==void 0?t:"anonymous"}}class Jn{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new _n({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){const e=new _n(t,this._component);return this._maybeAddLayer(e)}get(t){return t?this._getLayer(t):this._layers}currentKeys(){const t=[];for(const e of this._layers)t.push(e.currentKeys);return t}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort((e,s)=>e.order-s.order),t)}_getLayer(t){return this._layerMap[t]}}class Kt extends re{constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=v.Zero,this.anchor=v.Half,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,...t};const{current:e,anchor:s,opacity:i,visible:n,graphics:o,offset:h,copyGraphics:l,onPreDraw:c,onPostDraw:u}=t;this._graphics=o||{},this.offset=h??this.offset,this.opacity=i??this.opacity,this.anchor=s??this.anchor,this.copyGraphics=l??this.copyGraphics,this.onPreDraw=c??this.onPreDraw,this.onPostDraw=u??this.onPostDraw,this.visible=!!n,this.layers=new Jn(this),e&&this._graphics[e]&&this.show(this._graphics[e])}getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,e){let s="default",i=null;return typeof t=="string"?(s=t,i=e):i=t,this._graphics[s]=this.copyGraphics?i.clone():i,s==="default"&&this.show("default"),i}show(t,e){const s=this.layers.default.show(t,e);return this.recalculateBounds(),s}use(t,e){const s=this.layers.default.use(t,e);return this.recalculateBounds(),s}hide(t){this.layers.default.hide(t)}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new Z;for(const e of this.layers.get())for(const{graphic:s,options:i}of e.graphics){let n=this.anchor,o=this.offset;i!=null&&i.anchor&&(n=i.anchor),i!=null&&i.offset&&(o=i.offset);const h=s.localBounds,l=-h.width*n.x+o.x,c=-h.height*n.y+o.y;t=s==null?void 0:s.localBounds.translate(P(l+e.offset.x,c+e.offset.y)).combine(t)}this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}update(t,e=0){for(const s of this.layers.get())for(const{graphic:i}of s.graphics)gn(i)&&(i==null||i.tick(t,e))}}class mi extends Ms{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new mi({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class wi extends Ms{constructor(t){var e,s;super(t),this._radius=0,this.padding=(e=t.padding)!==null&&e!==void 0?e:2,this.radius=t.radius,this.filtering=(s=t.filtering)!==null&&s!==void 0?s:fe.Blended,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}clone(){return new wi({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class ks extends re{constructor(){super(...arguments),this.type="ex.pointer",this.useColliderShape=!0,this.useGraphicsBounds=!1}}class Pt{static CreateReversibleEasingFunction(t){return(e,s,i,n)=>i<s?s-(t(e,i,s,n)-i):t(e,s,i,n)}static CreateVectorEasingFunction(t){return(e,s,i,n)=>new v(t(e,s.x,i.x,n),t(e,s.y,i.y,n))}}Pt.Linear=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,e*r/s+t)),Pt.EaseInQuad=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s,e*r*r+t)),Pt.EaseOutQuad=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s,-e*r*(r-2)+t)),Pt.EaseInOutQuad=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s/2,r<1?e/2*r*r+t:(r--,-e/2*(r*(r-2)-1)+t))),Pt.EaseInCubic=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s,e*r*r*r+t)),Pt.EaseOutCubic=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s,r--,e*(r*r*r+1)+t)),Pt.EaseInOutCubic=Pt.CreateReversibleEasingFunction((r,t,e,s)=>(e=e-t,r/=s/2,r<1?e/2*r*r*r+t:(r-=2,e/2*(r*r*r+2)+t)));class tr{constructor(t){this._actions=[],this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._entity)&&this._completedActions.push(this._actions.shift()))}}class er{constructor(t,e,s){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=s,this._originalRepeat=s,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class sr{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class ir{constructor(t,e,s,i){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(X),this._motion=t.get(Ft),this._speed=i,this._offset=new v(e,s),i<=0)throw j.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+i),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new v(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(X);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class nr{constructor(t,e,s,i){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._end=new v(e,s),this._speed=i}update(t){this._started||(this._started=!0,this._start=new v(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=P(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}isComplete(t){const e=t.get(X);return this._stopped||new v(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}var ae;(function(r){r[r.ShortestPath=0]="ShortestPath",r[r.LongestPath=1]="LongestPath",r[r.Clockwise=2]="Clockwise",r[r.CounterClockwise=3]="CounterClockwise"})(ae||(ae={}));class rr{constructor(t,e,s,i){this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._end=e,this._speed=s,this._rotationType=i||ae.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),s=R-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+R)%R>=Math.PI,this._rotationType){case ae.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ae.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ae.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ae.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class or{constructor(t,e,s,i){this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._speed=s,this._offset=e,this._rotationType=i||ae.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),s=R-e;switch(e>s?(this._shortDistance=s,this._longDistance=e):(this._shortDistance=e,this._longDistance=s),this._shortestPathIsPositive=(this._start-this._end+R)%R>=Math.PI,this._rotationType){case ae.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ae.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ae.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ae.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}class ar{constructor(t,e,s,i,n){this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._endX=e,this._endY=s,this._speedX=i,this._speedY=n}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=P(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.y-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class hr{constructor(t,e,s,i){this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._offset=new v(e,s),this._speedX=this._speedY=i}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class lr{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class cr{constructor(t,e,s,i,n){this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new v(0,0),this._lerpEnd=new v(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._lerpDuration=i,this._lerpEnd=new v(e,s)}_initialize(){this._lerpStart=new v(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=P((e-this._tx.pos.x)/(t/1e3),(s-this._tx.pos.y)/(t/1e3))):(this._tx.pos=P(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=v.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=P(0,0),this._stopped=!0}}class dr{constructor(t,e,s,i,n){this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new v(0,0),this._lerpEnd=new v(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._lerpDuration=i,this._offset=new v(e,s)}_initialize(){this._lerpStart=new v(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,s=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?s=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):s=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=P((e-this._tx.pos.x)/(t/1e3),(s-this._tx.pos.y)/(t/1e3))):(this._tx.pos=P(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=v.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=P(0,0),this._stopped=!0}}class ur{constructor(t,e,s,i=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Kt),this._timeVisible=e,this._timeNotVisible=s,this._duration=(e+s)*i}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class pr{constructor(t,e,s){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Kt),this._endOpacity=e,this._speed=this._ogspeed=s}update(t){this._graphics&&(this._started||(this._started=!0,this._speed=this._ogspeed,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),j.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class fr{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class gr{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(Rs).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class mn{constructor(t,e,s){this._started=!1,this._stopped=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._followTx=e.get(X),this._followMotion=e.get(Ft),this._current=new v(this._tx.pos.x,this._tx.pos.y),this._end=new v(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=s!==void 0?s:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=P(this._tx.pos.x,this._tx.pos.y),this._end=P(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const s=this._dir.scale(this._speed);this._motion.vel=P(s.x,s.y)}else this._motion.vel=P(0,0);this.isComplete()&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}stop(){this._motion.vel=P(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class wn{constructor(t,e,s){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(X),this._motion=t.get(Ft),this._meetTx=e.get(X),this._meetMotion=e.get(Ft),this._current=new v(this._tx.pos.x,this._tx.pos.y),this._end=new v(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=s||0,s!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=P(this._tx.pos.x,this._tx.pos.y),this._end=P(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const s=this._dir.scale(this._speed);this._motion.vel=P(s.x,s.y),this.isComplete()&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=void 0}}class Qs{constructor(t){this._entity=t,this._queue=new tr(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}easeTo(...t){var e,s;let i=0,n=0,o=0,h=Pt.Linear;return t[0]instanceof v?(i=t[0].x,n=t[0].y,o=t[1],h=(e=t[2])!==null&&e!==void 0?e:h):(i=t[0],n=t[1],o=t[2],h=(s=t[3])!==null&&s!==void 0?s:h),this._queue.add(new cr(this._entity,i,n,o,h)),this}easeBy(...t){var e,s;let i=0,n=0,o=0,h=Pt.Linear;return t[0]instanceof v?(i=t[0].x,n=t[0].y,o=t[1],h=(e=t[2])!==null&&e!==void 0?e:h):(i=t[0],n=t[1],o=t[2],h=(s=t[3])!==null&&s!==void 0?s:h),this._queue.add(new dr(this._entity,i,n,o,h)),this}moveTo(t,e,s){let i=0,n=0,o=0;return t instanceof v?(i=t.x,n=t.y,o=e):(i=t,n=e,o=s),this._queue.add(new nr(this._entity,i,n,o)),this}moveBy(t,e,s){let i=0,n=0,o=0;return t instanceof v?(i=t.x,n=t.y,o=e):(i=t,n=e,o=s),this._queue.add(new ir(this._entity,i,n,o)),this}rotateTo(t,e,s){return this._queue.add(new rr(this._entity,t,e,s)),this}rotateBy(t,e,s){return this._queue.add(new or(this._entity,t,e,s)),this}scaleTo(t,e,s,i){let n=1,o=1,h=0,l=0;return t instanceof v&&e instanceof v&&(n=t.x,o=t.y,h=e.x,l=e.y),typeof t=="number"&&typeof e=="number"&&(n=t,o=e,h=s,l=i),this._queue.add(new ar(this._entity,n,o,h,l)),this}scaleBy(t,e,s){let i=1,n=1;return t instanceof v&&(i=t.x,n=t.y,s=e),typeof t=="number"&&typeof e=="number"&&(i=t,n=e),this._queue.add(new hr(this._entity,i,n,s)),this}blink(t,e,s=1){return this._queue.add(new ur(this._entity,t,e,s)),this}fade(t,e){return this._queue.add(new pr(this._entity,t,e)),this}delay(t){return this._queue.add(new fr(t)),this}die(){return this._queue.add(new gr(this._entity)),this}callMethod(t){return this._queue.add(new lr(t)),this}repeat(t,e){return e?(this._queue.add(new er(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new sr(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new mn(this._entity,t)):this._queue.add(new mn(this._entity,t,e)),this}meet(t,e){return e===void 0?this._queue.add(new wn(this._entity,t)):this._queue.add(new wn(this._entity,t,e)),this}toPromise(){return new Promise(e=>{this._queue.add(new lr(()=>{e()}))})}}class Rs extends re{constructor(){super(...arguments),this.type="ex.actions",this.dependencies=[X,Ft]}onAdd(t){this._ctx=new Qs(t)}onRemove(){this._ctx=null}getQueue(){var t;return(t=this._ctx)===null||t===void 0?void 0:t.getQueue()}runAction(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.runAction(t)}update(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}easeTo(...t){return this._ctx.easeTo.apply(this._ctx,t)}easeBy(...t){return this._ctx.easeBy.apply(this._ctx,t)}moveTo(t,e,s){return this._ctx.moveTo.apply(this._ctx,[t,e,s])}moveBy(t,e,s){return this._ctx.moveBy.apply(this._ctx,[t,e,s])}rotateTo(t,e,s){return this._ctx.rotateTo(t,e,s)}rotateBy(t,e,s){return this._ctx.rotateBy(t,e,s)}scaleTo(t,e,s,i){return this._ctx.scaleTo.apply(this._ctx,[t,e,s,i])}scaleBy(t,e,s){return this._ctx.scaleBy.apply(this._ctx,[t,e,s])}blink(t,e,s){return this._ctx.blink(t,e,s)}fade(t,e){return this._ctx.fade(t,e)}delay(t){return this._ctx.delay(t)}die(){return this._ctx.die()}callMethod(t){return this._ctx.callMethod(t)}repeat(t,e){return this._ctx.repeat(t,e)}repeatForever(t){return this._ctx.repeatForever(t)}follow(t,e){return this._ctx.follow(t,e)}meet(t,e){return this._ctx.meet(t,e)}toPromise(){return this._ctx.toPromise()}}var vi;(function(r){r.Em="em",r.Rem="rem",r.Px="px",r.Pt="pt",r.Percent="%"})(vi||(vi={}));var xi;(function(r){r.Left="left",r.Right="right",r.Center="center",r.Start="start",r.End="end"})(xi||(xi={}));var yi;(function(r){r.Top="top",r.Hanging="hanging",r.Middle="middle",r.Alphabetic="alphabetic",r.Ideographic="ideographic",r.Bottom="bottom"})(yi||(yi={}));var bi;(function(r){r.Normal="normal",r.Italic="italic",r.Oblique="oblique"})(bi||(bi={}));var Ai;(function(r){r.LeftToRight="ltr",r.RightToLeft="rtl"})(Ai||(Ai={}));class Ls extends te{constructor(t={}){var e,s,i,n,o,h,l,c,u,m,y,A,F,z,U,S,T,Y,G;super(t),this.filtering=fe.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=D.Black,this.family="sans-serif",this.style=bi.Normal,this.bold=!1,this.unit=vi.Px,this.textAlign=xi.Left,this.baseAlign=yi.Alphabetic,this.direction=Ai.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new Z,this._cachedTextMeasurement=new Map,this._bitmapToTextMeasurement=new Map,this._textToBitmap=new Map,this._bitmapUsage=new Map,this._textFragments=[],this.smoothing=(e=t==null?void 0:t.smoothing)!==null&&e!==void 0?e:this.smoothing,this.padding=(s=t==null?void 0:t.padding)!==null&&s!==void 0?s:this.padding,this.color=(i=t==null?void 0:t.color)!==null&&i!==void 0?i:this.color,this.strokeColor=(n=t==null?void 0:t.strokeColor)!==null&&n!==void 0?n:this.strokeColor,this.lineDash=(o=t==null?void 0:t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineWidth=(h=t==null?void 0:t.lineWidth)!==null&&h!==void 0?h:this.lineWidth,this.filtering=(l=t==null?void 0:t.filtering)!==null&&l!==void 0?l:this.filtering,this.family=(c=t==null?void 0:t.family)!==null&&c!==void 0?c:this.family,this.style=(u=t==null?void 0:t.style)!==null&&u!==void 0?u:this.style,this.bold=(m=t==null?void 0:t.bold)!==null&&m!==void 0?m:this.bold,this.size=(y=t==null?void 0:t.size)!==null&&y!==void 0?y:this.size,this.unit=(A=t==null?void 0:t.unit)!==null&&A!==void 0?A:this.unit,this.textAlign=(F=t==null?void 0:t.textAlign)!==null&&F!==void 0?F:this.textAlign,this.baseAlign=(z=t==null?void 0:t.baseAlign)!==null&&z!==void 0?z:this.baseAlign,this.direction=(U=t==null?void 0:t.direction)!==null&&U!==void 0?U:this.direction,this.quality=(S=t==null?void 0:t.quality)!==null&&S!==void 0?S:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(T=t.shadow.blur)!==null&&T!==void 0?T:this.shadow.blur,this.shadow.offset=(Y=t.shadow.offset)!==null&&Y!==void 0?Y:this.shadow.offset,this.shadow.color=(G=t.shadow.color)!==null&&G!==void 0?G:this.shadow.color)}clone(){return new Ls({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,s){}_rotate(t){var e;const s=(e=this.origin)!==null&&e!==void 0?e:this._textBounds.center;t.translate(s.x,s.y),t.rotate(this.rotation),t.translate(-s.x,-s.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureText(t){let e=!1,s=this._cachedTextMeasurement.get(t);s||(e=!0);const i=this._getRasterPropertiesHash();if((!s||i!==s.rasterProps)&&(e=!0),e){const n=t.split(`
`),o=n.reduce((z,U)=>z.length>U.length?z:U),h=this._getTextBitmap(t);this._applyFont(h);const l=h.measureText(o);let c=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);const u=c*n.length;c=u;const m=u-Math.abs(l.actualBoundingBoxAscent),y=0,A=0,F=new Z({left:y-Math.abs(l.actualBoundingBoxLeft)-this.padding,top:A-Math.abs(l.actualBoundingBoxAscent)-this.padding,bottom:A+m+this.padding,right:y+Math.abs(l.actualBoundingBoxRight)+this.padding});return s={text:t,rasterProps:i,measurement:F},this._cachedTextMeasurement.set(t,s),this._bitmapToTextMeasurement.set(h,s),s.measurement}else return s.measurement}_setDimension(t,e){e.canvas.width=(t.width+this.padding*2)*2*this.quality,e.canvas.height=(t.height+this.padding*2)*2*this.quality}_postDraw(t){t.restore()}_getRasterPropertiesHash(t){var e,s;return"__hashcode__"+this.fontString+this.showDebug+this.textAlign+this.baseAlign+this.direction+JSON.stringify(this.shadow)+(this.padding.toString()+this.smoothing.toString()+this.lineWidth.toString()+this.lineDash.toString()+((e=this.strokeColor)===null||e===void 0?void 0:e.toString())+(t?t.toString():(s=this.color)===null||s===void 0?void 0:s.toString()).toString())}_applyRasterProperties(t,e){var s,i,n;t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((s=this.lineDash)!==null&&s!==void 0?s:t.getLineDash()),t.strokeStyle=(i=this.strokeColor)===null||i===void 0?void 0:i.toString(),t.fillStyle=e?e.toString():(n=this.color)===null||n===void 0?void 0:n.toString()}_applyFont(t){t.translate(this.padding+t.canvas.width/2,this.padding+t.canvas.height/2),t.scale(this.quality,this.quality),t.textAlign=this.textAlign,t.textBaseline=this.baseAlign,t.font=this.fontString,t.direction=this.direction,this.shadow&&(t.shadowColor=this.shadow.color.toString(),t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y)}_drawText(t,e,s,i){const n=e.split(`
`);this._applyRasterProperties(t,s),this._applyFont(t);for(let o=0;o<n.length;o++){const h=n[o];this.color&&t.fillText(h,0,o*i),this.strokeColor&&t.strokeText(h,0,o*i)}this.showDebug&&(rn(t,D.Red,-t.canvas.width/2,0,t.canvas.width/2,0,2),rn(t,D.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_getTextBitmap(t,e){const s=t+this._getRasterPropertiesHash(e),i=this._textToBitmap.get(s);if(i)return i;const o=document.createElement("canvas").getContext("2d");return this._textToBitmap.set(s,o),o}_splitTextBitmap(t){const e=[];let s=0,i=0;const n=Math.min(4096,t.canvas.width),o=Math.min(4096,t.canvas.height);for(;s<t.canvas.width;){for(;i<t.canvas.height;){const h=document.createElement("canvas");h.width=n,h.height=o,h.getContext("2d").drawImage(t.canvas,s,i,n,o,0,0,n,o),e.push({x:s,y:i,canvas:h}),i+=o}s+=n,i=0}return e}render(t,e,s,i,n){this.showDebug&&this.clearCache(),this.checkAndClearCache();const o=this._getTextBitmap(e,s),h=!this._bitmapUsage.get(o);this._textBounds=this.measureText(e),h&&this._setDimension(this._textBounds,o),this._preDraw(t,i,n);const l=e.split(`
`),c=this._textBounds.height/l.length;if(h){this._drawText(o,e,s,c);for(const u of this._textFragments)ut.delete(u.canvas);this._textFragments=this._splitTextBitmap(o);for(const u of this._textFragments)ut.load(u.canvas,this.filtering,!0)}for(const u of this._textFragments)t.drawImage(u.canvas,0,0,u.canvas.width,u.canvas.height,u.x/this.quality+i-o.canvas.width/this.quality/2,u.y/this.quality+n-o.canvas.height/this.quality/2,u.canvas.width/this.quality,u.canvas.height/this.quality);this._postDraw(t),this._bitmapUsage.set(o,performance.now())}get cacheSize(){return this._bitmapUsage.size}clearCache(){this._bitmapUsage.clear()}checkAndClearCache(){for(const[t,e]of this._bitmapUsage.entries())if(e+1e3<performance.now()){this._bitmapUsage.delete(t);const s=this._bitmapToTextMeasurement.get(t);s&&(this._cachedTextMeasurement.delete(s.text),this._bitmapToTextMeasurement.delete(t)),ut.delete(t.canvas)}}}class qs extends te{constructor(t){var e,s;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!==null&&e!==void 0?e:new Ls,this.color=(s=t.color)!==null&&s!==void 0?s:this.color,this.text=t.text}clone(){var t,e;return new qs({text:this.text.slice(),color:(e=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:D.Black,font:this.font.clone()})}get text(){return this._text}set text(t){this._text=t;const e=this.font.measureText(this._text);this._textWidth=e.width,this._textHeight=e.height}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text).scale(this.scale)}_rotate(t){}_flip(t){}_drawImage(t,e,s){var i;let n=D.Black;this.font instanceof Ls&&(n=(i=this.color)!==null&&i!==void 0?i:this.font.color),(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint;const{width:o,height:h}=this.font.measureText(this._text);this._textWidth=o,this._textHeight=h,this.font.render(t,this._text,n,e,s),this.font.showDebug&&t.debug.drawRect(e-o,s-h,o*2,h*2)}}class Ke extends Gt{constructor(t){super(),this._anchor=vs(v.Half,k=>this._handleAnchorChange(k)),this.logger=j.getInstance(),this.scene=null,this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=k=>{this._dragging&&(this.pos=k.worldPos)},this._pointerDragLeaveHandler=k=>{this._dragging&&(this.pos=k.worldPos)};const{name:e,x:s,y:i,pos:n,coordPlane:o,scale:h,width:l,height:c,radius:u,collider:m,vel:y,acc:A,rotation:F,angularVelocity:z,z:U,color:S,visible:T,anchor:Y,collisionType:G,collisionGroup:st}={...t};this._setName(e),this.anchor=Y??Ke.defaults.anchor.clone();const $=new X;this.addComponent($),this.pos=n??P(s??0,i??0),this.rotation=F??0,this.scale=h??P(1,1),this.z=U??0,$.coordPlane=o??ne.World,this.addComponent(new ks),this.addComponent(new Kt({anchor:this.anchor})),this.addComponent(new Ft),this.vel=y??v.Zero,this.acc=A??v.Zero,this.angularVelocity=z??0,this.addComponent(new Rs),this.addComponent(new ht),this.body.collisionType=G??rt.Passive,st&&(this.body.group=st),m?this.addComponent(new Ut(m)):u?this.addComponent(new Ut(Wt.Circle(u))):l>0&&c>0?this.addComponent(new Ut(Wt.Box(l,c,this.anchor))):this.addComponent(new Ut),this.graphics.visible=T??!0,S&&(this.color=S,l&&c?this.graphics.add(new mi({color:S,width:l,height:c})):u&&this.graphics.add(new wi({color:S,radius:u})))}get body(){return this.get(ht)}get transform(){return this.get(X)}get motion(){return this.get(Ft)}get graphics(){return this.get(Kt)}get collider(){return this.get(Ut)}get pointer(){return this.get(ks)}get actions(){return this.get(Rs)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(X).scale}set scale(t){this.get(X).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=vs(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){var e;this._color=t.clone();const i=(e=this.graphics.layers.default.graphics[0])===null||e===void 0?void 0:e.graphic;(i instanceof Ms||i instanceof qs)&&(i.color=this._color)}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new Ue(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new xe(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new Xe(this)),super.kill(),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")}unkill(){this.active=!0}isKilled(){return!this.active}get z(){return this.get(X).z}set z(t){this.get(X).z=t}get center(){const t=this.getGlobalPos();return new v(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new v(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(X).globalRotation}getGlobalPos(){return this.get(X).globalPos}getGlobalScale(){return this.get(X).globalScale}contains(t,e,s=!1){const i=P(t,e),n=this.get(Ut);n.update();const o=n.get();if(!o)return!1;const h=o.contains(i);return s?h||this.children.some(l=>l.contains(t,e,!0)):h}within(t,e){const s=this.get(Ut),i=t.get(Ut),n=s.get(),o=i.get();return n&&o?n.getClosestLineBetween(o).getLength()<=e:!1}update(t,e){this._initialize(t),this._preupdate(t,e),this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new Rt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Rt(t,e,this)),this.onPostUpdate(t,e)}}Ke.defaults={anchor:v.Half};function _r(r){return r instanceof vn}class vn extends Ke{constructor(t){super({...t}),this.get(X).coordPlane=ne.Screen,this.anchor=P(0,0),this.body.collisionType=rt.PreventCollision,this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,s=!0){if(s)return super.contains(t,e);const i=this._engine.worldToScreenCoordinates(new v(t,e));return super.contains(i.x,i.y)}}class zs{constructor(t,e,s,i,n,o){if(this._logger=j.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null,typeof t!="function"){const h=t;t=h.fcn,e=h.interval,s=h.repeats,i=h.numberOfRepeats,n=h.randomRange,o=h.random}if(i&&i>=0&&(this.maxNumberOfRepeats=i,!s))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=zs._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=e,n){if(n[0]>n[1])throw new Error("min value must be lower than max value for range");this.random=o??new I,this.randomRange=n,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=s||this.repeats,t&&this.on(t)}get complete(){return this._complete}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}zs._MAX_ID=0;class Ci extends re{constructor(t){super(),this.type="ex.parallax",this.parallaxFactor=P(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Si extends re{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e,this.type="ex.debuggraphics"}}class mr extends Gt{constructor(t){var e,s;super(null,t.name),this._token=0,this._onScreenXStart=0,this._onScreenXEnd=Number.MAX_VALUE,this._onScreenYStart=0,this._onScreenYEnd=Number.MAX_VALUE,this.logger=j.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this._collidersDirty=!0,this._originalOffsets=new WeakMap,this.addComponent(new X),this.addComponent(new Ft),this.addComponent(new ht({type:rt.Fixed})),this.addComponent(new Kt({onPostDraw:(n,o)=>this.draw(n,o)})),this.addComponent(new Si(n=>this.debug(n))),this.addComponent(new Ut),this._graphics=this.get(Kt),this._transform=this.get(X),this._motion=this.get(Ft),this._collider=this.get(Ut),this._composite=this._collider.useCompositeCollider([]),this._transform.pos=(e=t.pos)!==null&&e!==void 0?e:v.Zero,this._oldPos=this._transform.pos,this.renderFromTopOfGraphic=(s=t.renderFromTopOfGraphic)!==null&&s!==void 0?s:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let i=[];for(let n=0;n<this.columns;n++){for(let o=0;o<this.rows;o++){const h=new wr({x:n,y:o,map:this});h.map=this,this.tiles[n+o*this.columns]=h,i.push(h),this._rows[o]||(this._rows[o]=[]),this._rows[o].push(h)}this._cols[n]=i,i=[]}this._graphics.localBounds=new Z({left:0,top:0,right:this.columns*this.tileWidth,bottom:this.rows*this.tileHeight})}flagCollidersDirty(){this._collidersDirty=!0}get x(){var t;return(t=this._transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var e;!((e=this._transform)===null||e===void 0)&&e.pos&&(this.get(X).pos=P(t,this.y))}get y(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos.y)!==null&&e!==void 0?e:0}set y(t){var e;!((e=this._transform)===null||e===void 0)&&e.pos&&(this._transform.pos=P(this.x,t))}get z(){var t;return(t=this._transform.z)!==null&&t!==void 0?t:0}set z(t){this._transform&&(this._transform.z=t)}get rotation(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.rotation)!==null&&e!==void 0?e:0}set rotation(t){var e;!((e=this._transform)===null||e===void 0)&&e.rotation&&(this._transform.rotation=t)}get scale(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.scale)!==null&&e!==void 0?e:v.One}set scale(t){var e;!((e=this._transform)===null||e===void 0)&&e.scale&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}on(t,e){super.on(t,e)}_initialize(t){super._initialize(t)}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}_updateColliders(){this._composite.clearColliders();const t=[];this._composite=this._collider.useCompositeCollider([]);let e;for(let s=0;s<this.columns;s++){for(let i=0;i<this.rows;i++){i===0&&(e=null);const n=this.tiles[s+i*this.columns];if(n.solid)if(n.getColliders().length>0){for(const o of n.getColliders()){const h=this._getOrSetColliderOriginalOffset(o);o.offset=P(n.x*this.tileWidth,n.y*this.tileHeight).add(h),o.owner=this,this._composite.addCollider(o)}e=null}else e?e=e.combine(n.bounds):e=n.bounds;else e&&t.push(e),e=null}if(e){const i=t[t.length-1];i&&i.top===e.top&&i.bottom===e.bottom?t[t.length-1]=i.combine(e):t.push(e)}}for(const s of t){const i=Wt.Box(s.width,s.height,v.Zero,P(s.left-this.pos.x,s.top-this.pos.y));i.owner=this,this._composite.addCollider(i)}this._collider.update()}getTileByIndex(t){return this.tiles[t]}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=Math.floor((t.x-this.pos.x)/this.tileWidth),s=Math.floor((t.y-this.pos.y)/this.tileHeight),i=this.getTile(e,s);return e>=0&&s>=0&&e<this.columns&&s<this.rows&&i?i:null}getRows(){return this._rows}getColumns(){return this._cols}update(t,e){if(this.onPreUpdate(t,e),this.emit("preupdate",new Rt(t,e,this)),!this._oldPos.equals(this.pos)){this.flagCollidersDirty();for(let c=0;c<this.tiles.length;c++)this.tiles[c]&&this.tiles[c].flagDirty()}this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++;const s=t.getWorldBounds(),i=P(s.left,s.top),n=P(s.right,s.bottom);let o=this.pos;const h=this.get(Ci);let l=v.One;if(h){const c=v.One.sub(h.parallaxFactor);l=t.currentScene.camera.pos.scale(c),o=o.add(l)}this._onScreenXStart=Math.max(Math.floor((i.x-o.x)/this.tileWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-o.y)/this.tileHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((n.x-o.x)/this.tileWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((n.y-o.y)/this.tileHeight)+2,0),this._transform.pos=P(this.x,this.y),this.onPostUpdate(t,e),this.emit("postupdate",new Yt(t,e,this))}draw(t,e){this.emit("predraw",new ye(t,e,this));let s=this._onScreenXStart;const i=Math.min(this._onScreenXEnd,this.columns);let n=this._onScreenYStart;const o=Math.min(this._onScreenYEnd,this.rows);let h,l,c;for(s;s<i;s++){for(n;n<o;n++)for(h=this.getTile(s,n).getGraphics(),l=0,c=h.length;l<c;l++){const u=h[l];if(u){gn(u)&&(u==null||u.tick(e,this._token));const m=this.renderFromTopOfGraphic?0:u.height-this.tileHeight;u.draw(t,s*this.tileWidth,n*this.tileHeight-m)}}n=this._onScreenYStart}this.emit("postdraw",new be(t,e,this))}debug(t){const e=this.tileWidth*this.columns,s=this.tileHeight*this.rows,i=v.Zero;for(let o=0;o<this.rows+1;o++){const h=P(0,o*this.tileHeight);t.drawLine(i.add(h),i.add(P(e,h.y)),D.Red,2)}for(let o=0;o<this.columns+1;o++){const h=P(o*this.tileWidth,0);t.drawLine(i.add(h),i.add(P(h.x,s)),D.Red,2)}const n=this._composite.getColliders();for(const o of n){const h=D.Gray;h.a=.5;const l=o.localBounds,c=o.worldPos.sub(this.pos);t.drawRectangle(c,l.width,l.height,h)}}}class wr extends Gt{constructor(t){var e,s;super(),this._posDirty=!1,this._solid=!1,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this.width=t.map.tileWidth,this.height=t.map.tileHeight,this.solid=(e=t.solid)!==null&&e!==void 0?e:this.solid,this._graphics=(s=t.graphics)!==null&&s!==void 0?s:[],this._recalculate()}get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get solid(){return this._solid}set solid(t){var e;(e=this.map)===null||e===void 0||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t)}removeGraphic(t){Qt(t,this._graphics)}clearGraphics(){this._graphics.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}flagDirty(){return this._posDirty=!0}_recalculate(){this._pos=this.map.pos.add(P(this.x*this.map.tileWidth,this.y*this.map.tileHeight)),this._bounds=new Z(this._pos.x,this._pos.y,this._pos.x+this.width,this._pos.y+this.height),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get center(){return this._posDirty&&this._recalculate(),new v(this._pos.x+this.width/2,this._pos.y+this.height/2)}}class vr{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new xr(t))}lockToActorAxis(t,e){this.camera.addStrategy(new yr(t,e))}elasticToActor(t,e,s){this.camera.addStrategy(new br(t,e,s))}radiusAroundActor(t,e){this.camera.addStrategy(new Ar(t,e))}limitCameraBounds(t){this.camera.addStrategy(new Cr(t))}}var Ti;(function(r){r[r.X=0]="X",r[r.Y=1]="Y"})(Ti||(Ti={}));class xr{constructor(t){this.target=t,this.action=(e,s,i,n)=>e.center}}class yr{constructor(t,e){this.target=t,this.axis=e,this.action=(s,i,n,o)=>{const h=s.center,l=i.getFocus();return this.axis===Ti.X?new v(h.x,l.y):new v(l.x,h.y)}}}class br{constructor(t,e,s){this.target=t,this.cameraElasticity=e,this.cameraFriction=s,this.action=(i,n,o,h)=>{const l=i.center;let c=n.getFocus(),u=n.vel.clone();const m=l.sub(c).scale(this.cameraElasticity);u=u.add(m);const y=u.scale(-1).scale(this.cameraFriction);return u=u.add(y),c=c.add(u),c}}}class Ar{constructor(t,e){this.target=t,this.radius=e,this.action=(s,i,n,o)=>{const h=s.center,l=i.getFocus(),c=h.sub(l),u=c.size;if(u>=this.radius){const m=u-this.radius;return l.add(c.normalize().scale(m))}return l}}}class Cr{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,s,i,n)=>{const o=s.getFocus();this.boundSizeChecked||((e.bottom-e.top<i.drawHeight||e.right-e.left<i.drawWidth)&&j.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let h=o.x,l=o.y;return o.x<e.left+i.halfDrawWidth?h=e.left+i.halfDrawWidth:o.x>e.right-i.halfDrawWidth&&(h=e.right-i.halfDrawWidth),o.y<e.top+i.halfDrawHeight?l=e.top+i.halfDrawHeight:o.y>e.bottom-i.halfDrawHeight&&(l=e.bottom-i.halfDrawHeight),P(h,l)}}}class Sr extends _e{constructor(){super(...arguments),this.transform=wt.identity(),this.inverse=wt.identity(),this._cameraStrategies=[],this.strategy=new vr(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=Ln(v.Zero,()=>this._posChanged=!0),this.vel=v.Zero,this.acc=v.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Pt.EaseInOutCubic,this._easing=Pt.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._pos=Ln(t,()=>this._posChanged=!0),this._posChanged=!0}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=P(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=P(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=P(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=P(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=P(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=P(this.acc.x,t)}getFocus(){return this.pos}move(t,e,s=Pt.EaseInOutCubic){if(typeof s!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(i=>{this._lerpResolve=i}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=s,this._lerpPromise)}shake(t,e,s){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=s}zoomOverTime(t,e=0,s=Pt.EaseInOutCubic){if(this._zoomPromise=new Promise(i=>{this._zoomResolve=i}),e)this._isZooming=!0,this._zoomEasing=s,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new Z(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){Qt(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new Rt(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new Yt(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.resolution;let s=P(e.width/2,e.height/2);if(!this._engine.loadingComplete){const i=this._screen.peekResolution();i&&(s=P(i.width/2,i.height/2))}this._halfWidth=s.x,this._halfHeight=s.y,this._posChanged||(this.pos=s),this.updateTransform(),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(),this.onInitialize(t),super.emit("initialize",new N(t,this)),this._isInitialized=!0}}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}runStrategies(t,e){for(const s of this._cameraStrategies)this.pos=s.action.call(s,s.target,this,t,e)}updateViewport(){this._viewport=new Z(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const s=this._zoomEasing,i=s(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=i,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const i=Pt.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=i,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const s=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(s)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(),this._postupdate(t,e)}draw(t){t.multiply(this.transform)}updateTransform(){const t=this._screen.resolution.width/this.zoom,e=this._screen.resolution.height/this.zoom,s=P(-this.x+t/2+this._xShake,-this.y+e/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(s.x,s.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const ra={pos:v.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class Tr extends Ke{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...ra,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=rt.Passive,this.eventDispatcher=new hs,this.events.on("collisionstart",e=>{this.filter(e.other)&&(this.emit("enter",new qi(this,e.other)),this._dispatchAction(),this.repeat===0&&this.kill())}),this.events.on("collisionend",e=>{this.filter(e.other)&&this.emit("exit",new $i(this,e.other))})}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.repeat!==0&&(this.action.call(this),this.repeat--)}}var se;(function(r){r.Update="update",r.Draw="draw"})(se||(se={}));class Ie{constructor(){this.priority=0}notify(t){}}class Pr{constructor(t){this.data=t,this.type="Entity Added"}}function $s(r){return!!r&&r.type==="Entity Added"}class Er{constructor(t){this.data=t,this.type="Entity Removed"}}function oa(r){return!!r&&r.type==="Entity Removed"}class Ir{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,e){for(const s of this.entities)s.update(t.engine,e),s.active||this.removeEntity(s)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}notify(t){qn(t)&&this._world.queryManager.addEntity(t.data.entity),Kn(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t.active=!0,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach(e=>this.addEntity(e)),t.childrenAdded$.register({notify:e=>{this.addEntity(e)}}),t.childrenRemoved$.register({notify:e=>{this.removeEntity(e,!1)}}))}removeEntity(t,e=!0){var s;let i=0;t instanceof Gt?i=t.id:i=t;const n=this._entityIndex[i];if(n&&n.active&&n.kill(),n&&e){this._entitiesToRemove.push(n);return}delete this._entityIndex[i],n&&(Qt(n,this.entities),this._world.queryManager.removeEntity(n),n.componentAdded$.unregister(this),n.componentRemoved$.unregister(this),n.children.forEach(o=>this.removeEntity(o,e)),n.childrenAdded$.clear(),n.childrenRemoved$.clear(),!((s=this._world.context)===null||s===void 0)&&s.engine&&this._world.context.engine.stats.currFrame.actors.killed++)}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1)}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(const t of this.entities)this.removeEntity(t)}}const Pi=r=>[...r].sort((e,s)=>e.localeCompare(s)).join("+");class Br extends He{constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map(e=>new e().type):this.types=t}get key(){return this._key?this._key:this._key=Pi(this.types)}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!We(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new Pr(t)))}removeEntity(t){Qt(t,this._entities)&&this.notifyAll(new Er(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];t instanceof Gt?e=t.types:e=t;let s=!0;for(const i of this.types)if(s=s&&e.indexOf(i)>-1,!s)return!1;return s}contain(t){return this.types.indexOf(t)>-1}}class Fr{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[Pi(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){t.observers.length===0&&(t.clear(),delete this._queries[Pi(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const s in this._queries)this._queries[s].contain(e.type)&&this._queries[s].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const s=new Br(t);return this._addQuery(s),s}getQuery(t){const e=Pi(t);return this._queries[e]?this._queries[e]:null}}class Mr{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){if(!t.types||t.types.length===0)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort((s,i)=>s.priority-i.priority),e.register(t),this.initialized&&t.initialize&&t.initialize(this._world.context)}removeSystem(t){Qt(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world.context)}}updateSystems(t,e,s){const i=this.systems.filter(n=>n.systemType===t);for(const n of i)n.preupdate&&n.preupdate(e,s);for(const n of i){const o=this._world.queryManager.getQuery(n.types).getEntities(n.sort);if(e instanceof ti)for(const h of o)h._initialize(e==null?void 0:e.engine);n.update(o,s)}for(const n of i)n.postupdate&&n.postupdate(e,s)}clear(){for(const t of this.systems)this.removeSystem(t)}}class Dr{constructor(t){this.context=t,this.queryManager=new Fr(this),this.entityManager=new Ir(this),this.systemManager=new Mr(this)}update(t,e){t===se.Update&&this.entityManager.updateEntities(this.context,e),this.systemManager.updateSystems(t,this.context,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof Gt&&this.entityManager.addEntity(t),t instanceof Ie&&this.systemManager.addSystem(t)}remove(t,e=!0){t instanceof Gt&&this.entityManager.removeEntity(t,e),t instanceof Ie&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class Jt{static integrate(t,e,s,i){const n=i/1e3;e.vel.addEqual(s.scale(n,Jt._ACC)),t.pos.add(e.vel.scale(n,Jt._VEL),Jt._POS).addEqual(s.scale(.5*n*n,Jt._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*n;const o=t.rotation+e.angularVelocity*n;t.scale.add(e.scaleFactor.scale(n,this._SCALE_FACTOR),Jt._SCALE),t.get().setTransform(Jt._POS,o,Jt._SCALE)}}Jt._POS=new v(0,0),Jt._SCALE=new v(1,1),Jt._ACC=new v(0,0),Jt._VEL=new v(0,0),Jt._VEL_ACC=new v(0,0),Jt._SCALE_FACTOR=new v(0,0);class kr extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.motion"],this.systemType=se.Update,this.priority=-1}update(t,e){let s,i;for(let n=0;n<t.length;n++){s=t[n].get(X),i=t[n].get(Ft);const o=t[n].get(ht);if(o!=null&&o.sleeping)continue;const h=i.acc.clone();(o==null?void 0:o.collisionType)===rt.Active&&(o!=null&&o.useGravity)&&h.addEqual(Q.gravity),o==null||o.captureOldTransform(),Jt.integrate(s,i,h,e)}}}class Rr{constructor(){this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(e=>!e.isCanceled()),t.sort((e,s)=>{const i=this.distanceMap.get(e.id),n=this.distanceMap.get(s.id);return i-n});for(const e of t)this.solvePosition(e),this.solveVelocity(e);return this.postSolve(t),t}preSolve(t){for(const e of t){const s=et.fromDirection(e.mtv),i=e.mtv.negate(),n=e.colliderA.worldPos.squareDistance(e.colliderB.worldPos);this.distanceMap.set(e.id,n),e.colliderA.events.emit("precollision",new ie(e.colliderA,e.colliderB,s,i)),e.colliderB.events.emit("precollision",new ie(e.colliderB,e.colliderA,et.getOpposite(s),i.negate()))}}postSolve(t){var e,s;for(const i of t){if(i.isCanceled())continue;const n=i.colliderA,o=i.colliderB,h=(e=n.owner)===null||e===void 0?void 0:e.get(ht),l=(s=o.owner)===null||s===void 0?void 0:s.get(ht);if(h&&l&&(h.collisionType===rt.Passive||l.collisionType===rt.Passive))continue;const c=et.fromDirection(i.mtv),u=i.mtv.negate();i.colliderA.events.emit("postcollision",new pe(i.colliderA,i.colliderB,c,u)),i.colliderB.events.emit("postcollision",new pe(i.colliderB,i.colliderA,et.getOpposite(c),u.negate()))}}solvePosition(t){var e,s;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let n=t.mtv;const o=t.colliderA,h=t.colliderB,l=(e=o.owner)===null||e===void 0?void 0:e.get(ht),c=(s=h.owner)===null||s===void 0?void 0:s.get(ht);if(l&&c){if(l.collisionType===rt.Passive||c.collisionType===rt.Passive)return;l.collisionType===rt.Active&&c.collisionType===rt.Active&&(n=n.scale(.5)),l.collisionType===rt.Active&&(l.globalPos.x-=n.x,l.globalPos.y-=n.y,o.update(l.transform.get())),c.collisionType===rt.Active&&(c.globalPos.x+=n.x,c.globalPos.y+=n.y,h.update(c.transform.get()))}}solveVelocity(t){var e,s;if(t.isCanceled())return;const i=t.colliderA,n=t.colliderB,o=(e=i.owner)===null||e===void 0?void 0:e.get(ht),h=(s=n.owner)===null||s===void 0?void 0:s.get(ht);if(o&&h){if(o.collisionType===rt.Passive||h.collisionType===rt.Passive)return;const l=t.normal,c=l.negate();if(o.collisionType===rt.Active&&o.vel.normalize().dot(c)<0){const u=l.scale(l.dot(o.vel.negate()));o.vel=o.vel.add(u)}if(h.collisionType===rt.Active&&h.vel.normalize().dot(l)<0){const u=c.scale(c.dot(h.vel.negate()));h.vel=h.vel.add(u)}}}}class Lr{constructor(t,e,s){this.point=t,this.local=e,this.contact=s,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new v(0,0),this.bToContact=new v(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){var t,e;const s=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(ht),i=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(ht);if(s&&i){const n=this.contact.normal,o=this.contact.tangent;this.aToContact=this.point.sub(s.globalPos),this.bToContact=this.point.sub(i.globalPos);const h=this.aToContact.cross(n),l=this.bToContact.cross(n);this.normalMass=s.inverseMass+i.inverseMass+s.inverseInertia*h*h+i.inverseInertia*l*l;const c=this.aToContact.cross(o),u=this.bToContact.cross(o);this.tangentMass=s.inverseMass+i.inverseMass+s.inverseInertia*c*c+i.inverseInertia*u*u}return this}getRelativeVelocity(){var t,e;const s=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(ht),i=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(ht);if(s&&i){const n=s.vel.add(v.cross(s.angularVelocity,this.aToContact));return i.vel.add(v.cross(i.angularVelocity,this.bToContact)).sub(n)}return v.Zero}}class zr{constructor(){this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!==null&&e!==void 0?e:[]}solve(t){return this.preSolve(t),t=t.filter(e=>!e.isCanceled()),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,s,i;for(const o of t){const h=et.fromDirection(o.mtv);o.colliderA.events.emit("precollision",new ie(o.colliderA,o.colliderB,h,o.mtv)),o.colliderA.events.emit("beforecollisionresolve",new os(o.colliderA,o.colliderB,h,o.mtv,o)),o.colliderB.events.emit("precollision",new ie(o.colliderB,o.colliderA,et.getOpposite(h),o.mtv.negate())),o.colliderB.events.emit("beforecollisionresolve",new os(o.colliderB,o.colliderA,et.getOpposite(h),o.mtv.negate(),o)),o.matchAwake()}const n=Array.from(this.idToContactConstraint.keys());for(const o of t){const h=n.indexOf(o.id);h>-1&&n.splice(h,1);const l=(e=this.idToContactConstraint.get(o.id))!==null&&e!==void 0?e:[];let c=0;const u=o.colliderA.owner.get(ht),m=o.colliderB.owner.get(ht);if(u&&m)for(const y of o.points){const A=o.normal,F=o.tangent,z=y.sub(u.globalPos),U=y.sub(m.globalPos),S=z.cross(A),T=U.cross(A),Y=u.inverseMass+m.inverseMass+u.inverseInertia*S*S+m.inverseInertia*T*T,G=z.cross(F),st=U.cross(F),$=u.inverseMass+m.inverseMass+u.inverseInertia*G*G+m.inverseInertia*st*st;l[c]&&((i=(s=l[c])===null||s===void 0?void 0:s.point)===null||i===void 0?void 0:i.squareDistance(y))<4?(l[c].point=y,l[c].local=o.localPoints[c]):l[c]=new Lr(y,o.localPoints[c],o),l[c].aToContact=z,l[c].bToContact=U,l[c].normalMass=1/Y,l[c].tangentMass=1/$;const k=u.bounciness>m.bounciness?u.bounciness:m.bounciness,vt=o.normal.dot(l[c].getRelativeVelocity());l[c].originalVelocityAndRestitution=0,vt<-.1&&(l[c].originalVelocityAndRestitution=-k*vt),c++}this.idToContactConstraint.set(o.id,l)}for(const o of n)this.idToContactConstraint.delete(o);if(Q.warmStart)this.warmStart(t);else for(const o of t){const h=this.getContactConstraints(o.id);for(const l of h)l.normalImpulse=0,l.tangentImpulse=0}}postSolve(t){for(const e of t){const s=e.colliderA.owner.get(ht),i=e.colliderB.owner.get(ht);if(s&&i){if(s.collisionType===rt.Passive||i.collisionType===rt.Passive)continue;s.updateMotion(),i.updateMotion()}const n=et.fromDirection(e.mtv);e.colliderA.events.emit("postcollision",new pe(e.colliderA,e.colliderB,n,e.mtv)),e.colliderA.events.emit("aftercollisionresolve",new as(e.colliderA,e.colliderB,n,e.mtv,e)),e.colliderB.events.emit("postcollision",new pe(e.colliderB,e.colliderA,et.getOpposite(n),e.mtv.negate())),e.colliderB.events.emit("aftercollisionresolve",new as(e.colliderB,e.colliderA,et.getOpposite(n),e.mtv.negate(),e))}this.lastFrameContacts.clear();for(const e of t)this.lastFrameContacts.set(e.id,e)}warmStart(t){var e,s,i;for(const n of t){const o=(e=n.colliderA.owner)===null||e===void 0?void 0:e.get(ht),h=(s=n.colliderB.owner)===null||s===void 0?void 0:s.get(ht);if(o&&h){const l=(i=this.idToContactConstraint.get(n.id))!==null&&i!==void 0?i:[];for(const c of l)if(Q.warmStart){const u=n.normal.scale(c.normalImpulse),m=n.tangent.scale(c.tangentImpulse),y=u.add(m);o.applyImpulse(c.point,y.negate()),h.applyImpulse(c.point,y)}else c.normalImpulse=0,c.tangentImpulse=0}}}solvePosition(t){var e,s,i;for(let n=0;n<Q.positionIterations;n++)for(const o of t){const h=(e=o.colliderA.owner)===null||e===void 0?void 0:e.get(ht),l=(s=o.colliderB.owner)===null||s===void 0?void 0:s.get(ht);if(h&&l){if(h.collisionType===rt.Passive||l.collisionType===rt.Passive)continue;const c=(i=this.idToContactConstraint.get(o.id))!==null&&i!==void 0?i:[];for(const u of c){const m=o.normal,y=Ee.FindContactSeparation(o,u.local),A=Q.steeringFactor,F=-5,z=Q.slop,U=M(A*(y+z),F,0),S=m.scale(-U*u.normalMass);if(h.collisionType===rt.Active){const T=S.negate().scale(h.inverseMass);h.limitDegreeOfFreedom.includes($t.X)&&(T.x=0),h.limitDegreeOfFreedom.includes($t.Y)&&(T.y=0),h.globalPos=h.globalPos.add(T),h.limitDegreeOfFreedom.includes($t.Rotation)||(h.rotation-=u.aToContact.cross(S)*h.inverseInertia)}if(l.collisionType===rt.Active){const T=S.scale(l.inverseMass);l.limitDegreeOfFreedom.includes($t.X)&&(T.x=0),l.limitDegreeOfFreedom.includes($t.Y)&&(T.y=0),l.globalPos=l.globalPos.add(T),l.limitDegreeOfFreedom.includes($t.Rotation)||(l.rotation+=u.bToContact.cross(S)*l.inverseInertia)}}}}}solveVelocity(t){var e,s,i;for(let n=0;n<Q.velocityIterations;n++)for(const o of t){const h=(e=o.colliderA.owner)===null||e===void 0?void 0:e.get(ht),l=(s=o.colliderB.owner)===null||s===void 0?void 0:s.get(ht);if(h&&l){if(h.collisionType===rt.Passive||l.collisionType===rt.Passive)continue;const c=Math.min(h.friction,l.friction),u=(i=this.idToContactConstraint.get(o.id))!==null&&i!==void 0?i:[];for(const m of u){let F=-m.getRelativeVelocity().dot(o.tangent)*m.tangentMass;const z=c*m.normalImpulse,U=M(m.tangentImpulse+F,-z,z);F=U-m.tangentImpulse,m.tangentImpulse=U;const S=o.tangent.scale(F);h.applyImpulse(m.point,S.negate()),l.applyImpulse(m.point,S)}for(const m of u){const A=m.getRelativeVelocity().dot(o.normal);let F=-m.normalMass*(A-m.originalVelocityAndRestitution);const z=Math.max(m.normalImpulse+F,0);F=z-m.normalImpulse,m.normalImpulse=z;const U=o.normal.scale(F);h.applyImpulse(m.point,U.negate()),l.applyImpulse(m.point,U)}}}}}class xn extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.motion","ex.collider"],this.systemType=se.Update,this.priority=-1,this._realisticSolver=new zr,this._arcadeSolver=new Rr,this._processor=new pn,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._trackCollider=t=>this._processor.track(t),this._untrackCollider=t=>this._processor.untrack(t)}notify(t){if($s(t)){const e=t.data.get(Ut);e.$colliderAdded.subscribe(this._trackCollider),e.$colliderRemoved.subscribe(this._untrackCollider);const s=e.get();s&&this._processor.track(s)}else{const e=t.data.get(Ut),s=e.get();e&&s&&this._processor.untrack(s)}}initialize(t){this._engine=t.engine}update(t,e){var s,i,n,o;if(!Q.enabled)return;let h=[];for(const m of t){const y=m.get(Ut),A=y==null?void 0:y.get();if(y&&(!((s=y.owner)===null||s===void 0)&&s.active)&&A)if(y.update(),A instanceof Zt){const F=A.getColliders();h=h.concat(F)}else h.push(A)}this._processor.update(h);const l=this._processor.broadphase(h,e);this._currentFrameContacts.clear();let c=this._processor.narrowphase(l,(o=(n=(i=this._engine)===null||i===void 0?void 0:i.debug)===null||n===void 0?void 0:n.stats)===null||o===void 0?void 0:o.currFrame);c=this.getSolver().solve(c);for(const m of c){const y=m.id.indexOf("|");if(y>0){const A=m.id.substring(y+1);this._currentFrameContacts.set(A,m)}else this._currentFrameContacts.set(m.id,m)}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts)}getSolver(){return Q.collisionResolutionStrategy===bs.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const s=e.colliderA,i=e.colliderB;s.events.emit("collisionstart",new Te(s,i,e)),s.events.emit("contactstart",new je(s,i,e)),i.events.emit("collisionstart",new Te(i,s,e)),i.events.emit("contactstart",new je(i,s,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const s=e.colliderA,i=e.colliderB;s.events.emit("collisionend",new Qe(s,i)),s.events.emit("contactend",new rs(s,i)),i.events.emit("collisionend",new Qe(i,s)),i.events.emit("contactend",new rs(i,s))}}}var Ks;(function(r){r.Forward="forward",r.Backward="backward"})(Ks||(Ks={}));var Be;(function(r){r.End="end",r.Loop="loop",r.PingPong="pingpong",r.Freeze="freeze"})(Be||(Be={}));class ps extends te{constructor(t){var e,s;super(t),this.events=new hs,this.frames=[],this.strategy=Be.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._direction=1,this._done=!1,this._playing=!0,this._reversed=!1,this.frames=t.frames,this.strategy=(e=t.strategy)!==null&&e!==void 0?e:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(s=t.frameDuration)!==null&&s!==void 0?s:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new ps({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,s,i=Be.Loop){const n=t.sprites.length-1,o=e.filter(h=>h<0||h>n);return o.length&&ps._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${o.join(",")} no frame will be shown`),new ps({frames:t.sprites.filter((h,l)=>e.indexOf(l)>-1).map(h=>({graphic:h,duration:s})),strategy:i})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._direction===1)?Ks.Backward:Ks.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case Be.End:case Be.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;const e=this.frames[this._currentFrame];e&&!this._done&&(this._timeLeftInFrame=(e==null?void 0:e.duration)||this.frameDuration,this.events.emit("frame",e))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case Be.Loop:{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case Be.End:{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case Be.Freeze:{e=M(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case Be.PingPong:{t+this._direction>=this.frames.length&&(this._direction=-1,this.events.emit("loop",this)),t+this._direction<0&&(this._direction=1,this.events.emit("loop",this)),e=t+this._direction%this.frames.length;break}}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",this.currentFrame)),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,s){this.currentFrame&&this.currentFrame.graphic.draw(t,e,s)}}ps._LOGGER=j.getInstance();class Js extends te{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new Js({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){let t=new Z;for(const{graphic:e,pos:s}of this.members)t=e.localBounds.translate(s).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new Z;for(const{graphic:e,pos:s}of this.members)t=e.localBounds.translate(s).combine(t);return t}_isAnimationOrGroup(t){return t instanceof ps||t instanceof Js}tick(t,e){for(const s of this.members){const i=s.graphic;this._isAnimationOrGroup(i)&&i.tick(t,e)}}reset(){for(const t of this.members){const e=t.graphic;this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,s){this._updateDimensions(),super._preDraw(t,e,s)}_drawImage(t,e,s){for(const i of this.members)t.save(),t.translate(e,s),i.graphic.draw(t,i.pos.x,i.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}function Ur(r){return class extends r{assign(t){for(const e in t)typeof this[e]!="function"&&(this[e]=t[e])}constructor(...t){super(...t),t.filter(function(s){return s!==void 0}).length===1&&t[0]&&typeof t[0]=="object"&&!(t[0]instanceof Array)&&this.assign(t[0])}}}var Us;(function(r){r[r.Circle=0]="Circle",r[r.Rectangle=1]="Rectangle"})(Us||(Us={}));class aa extends Gt{constructor(t,e,s,i,n,o,h,l,c,u){super(),this.position=new v(0,0),this.velocity=new v(0,0),this.acceleration=new v(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=D.White,this.endColor=D.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=D.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let m=t;if(m&&!(t instanceof Or)){const y=t;m=y.emitter,e=y.life,s=y.opacity,n=y.endColor,i=y.beginColor,o=y.position,h=y.velocity,l=y.acceleration,c=y.startSize,u=y.endSize}this.emitter=m,this.life=e||this.life,this.opacity=s||this.opacity,this.endColor=n||this.endColor.clone(),this.beginColor=i||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=(o||this.position).add(this.emitter.pos),this.velocity=h||this.velocity,this.acceleration=l||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=c||0,this.endSize=u||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new X),this.addComponent(this.graphics=new Kt),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=P(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(this.particleSprite)):(this.graphics.localBounds=Z.fromDimension(this.particleSize,this.particleSize,v.Half),this.graphics.onPostDraw=y=>{y.save(),this.graphics.opacity=this.opacity;const A=this._currentColor.clone();A.a=1,y.debug.drawPoint(P(0,0),{color:A,size:this.particleSize}),y.restore()})}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=M(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=M(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=M(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=M(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=M(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=M(this.opacity,1e-4,1),this.focus){const s=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(s)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=P(1,1),this.graphics.opacity=this.opacity}}class Ei extends Ur(aa){constructor(t,e,s,i,n,o,h,l,c,u){super(t,e,s,i,n,o,h,l,c,u)}}class Or extends Ke{constructor(t){var e,s;super({width:(e=t.width)!==null&&e!==void 0?e:0,height:(s=t.height)!==null&&s!==void 0?s:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new v(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=D.White,this.endColor=D.White,this._sprite=null,this.emitterType=Us.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1;const{x:i,y:n,pos:o,isEmitting:h,minVel:l,maxVel:c,acceleration:u,minAngle:m,maxAngle:y,emitRate:A,particleLife:F,opacity:z,fadeFlag:U,focus:S,focusAccel:T,startSize:Y,endSize:G,minSize:st,maxSize:$,beginColor:k,endColor:vt,particleSprite:yt,emitterType:bt,radius:ft,particleRotationalVelocity:Vt,randomRotation:Fe,random:Me}={...t};this.pos=o??P(i??0,n??0),this.isEmitting=h??this.isEmitting,this.minVel=l??this.minVel,this.maxVel=c??this.maxVel,this.acceleration=u??this.acceleration,this.minAngle=m??this.minAngle,this.maxAngle=y??this.maxAngle,this.emitRate=A??this.emitRate,this.particleLife=F??this.particleLife,this.opacity=z??this.opacity,this.fadeFlag=U??this.fadeFlag,this.focus=S??this.focus,this.focusAccel=T??this.focusAccel,this.startSize=Y??this.startSize,this.endSize=G??this.endSize,this.minSize=st??this.minSize,this.maxSize=$??this.maxSize,this.beginColor=k??this.beginColor,this.endColor=vt??this.endColor,this.particleSprite=yt??this.particleSprite,this.emitterType=bt??this.emitterType,this.radius=ft??this.radius,this.particleRotationalVelocity=Vt??this.particleRotationalVelocity,this.randomRotation=Fe??this.randomRotation,this.body.collisionType=rt.PreventCollision,this.random=Me??new I}get opacity(){return super.graphics.opacity}set opacity(t){super.graphics.opacity=t}get particleSprite(){return this._sprite}set particleSprite(t){t&&(this._sprite=t)}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let s=0;s<t;s++){const i=this._createParticle();this.particles.push(i),!((e=this===null||this===void 0?void 0:this.scene)===null||e===void 0)&&e.world&&this.scene.world.add(i)}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const s=tt(this.minAngle,this.maxAngle,this.random),i=tt(this.minVel,this.maxVel,this.random),n=this.startSize||tt(this.minSize,this.maxSize,this.random),o=i*Math.cos(s),h=i*Math.sin(s);if(this.emitterType===Us.Rectangle)t=tt(0,this.width,this.random),e=tt(0,this.height,this.random);else if(this.emitterType===Us.Circle){const c=tt(0,this.radius,this.random);t=c*Math.cos(s),e=c*Math.sin(s)}const l=new Ei(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new v(t,e),new v(o,h),this.acceleration,this.startSize,this.endSize);return l.fadeFlag=this.fadeFlag,l.particleSize=n,this.particleSprite&&(l.particleSprite=this.particleSprite,l.graphics.opacity=this.opacity,l.graphics.use(this._sprite)),l.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(l.currentRotation=tt(0,Math.PI*2,this.random)),this.focus&&(l.focus=this.focus.add(new v(this.pos.x,this.pos.y)),l.focusAccel=this.focusAccel),l}update(t,e){var s;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let i=0;i<this.deadParticles.length;i++)Qt(this.deadParticles[i],this.particles),!((s=this===null||this===void 0?void 0:this.scene)===null||s===void 0)&&s.world&&this.scene.world.remove(this.deadParticles[i],!1);this.deadParticles.length=0}}class Hr extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=se.Draw,this.priority=0,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}get sortedTransforms(){return this._sortedTransforms}initialize(t){this._camera=t.camera,this._engine=t.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.z-e.z),this._zHasChanged=!1)}notify(t){if($s(t)){const e=t.data.get(X);this._sortedTransforms.push(e),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(X);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(e);s>-1&&this._sortedTransforms.splice(s,1)}}update(t,e){this._token++;let s;this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const i of this._sortedTransforms){const n=i.owner;if(n.hasTag("ex.offscreen")||(s=n.get(Kt),!s.visible))continue;i.coordPlane===ne.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),s.update(e,this._token);const o=n.get(Ci);if(o){const l=v.One.sub(o.parallaxFactor),c=this._camera.pos.scale(l);this._graphicsContext.translate(c.x,c.y)}this._applyTransform(n),s.onPreDraw&&s.onPreDraw(this._graphicsContext,e);const h=n instanceof Ei?n.opacity:1;this._graphicsContext.opacity=s.opacity*h,this._drawGraphicsComponent(s),s.onPostDraw&&s.onPostDraw(this._graphicsContext,e),this._graphicsContext.restore(),i.coordPlane===ne.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}this._graphicsContext.restore()}_drawGraphicsComponent(t){var e,s;if(t.visible)for(const i of t.layers.get())for(const{graphic:n,options:o}of i.graphics){let h=t.anchor,l=t.offset;o!=null&&o.anchor&&(h=o.anchor),o!=null&&o.offset&&(l=o.offset);const c=-n.width*h.x+l.x,u=-n.height*h.y+l.y;if(n==null||n.draw(this._graphicsContext,c+i.offset.x,u+i.offset.y),!((e=this._engine)===null||e===void 0)&&e.isDebug&&this._engine.debug.graphics.showBounds){const m=P(c+i.offset.x,u+i.offset.y);if(n instanceof Js)for(const y of n.members)(s=y.graphic)===null||s===void 0||s.localBounds.translate(m.add(y.pos)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor);else n==null||n.localBounds.translate(m).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}_applyTransform(t){const e=t.getAncestors();for(const s of e){const i=s==null?void 0:s.get(X),n=s==null?void 0:s.get(ht);let o=i.pos,h=i.scale,l=i.rotation;if(n&&this._engine.fixedUpdateFps&&n.__oldTransformCaptured&&n.enableFixedUpdateInterpolate){const c=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps);o=i.pos.scale(c).add(n.oldPos.scale(1-c)),h=i.scale.scale(c).add(n.oldScale.scale(1-c));const u=(1-c)*Math.cos(n.oldRotation)+c*Math.cos(i.rotation),m=(1-c)*Math.sin(n.oldRotation)+c*Math.sin(i.rotation);l=Math.atan2(m,u)}i&&(this._graphicsContext.z=i.z,this._graphicsContext.translate(o.x,o.y),this._graphicsContext.scale(h.x,h.y),this._graphicsContext.rotate(l))}}}class Nr extends Ie{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=se.Draw,this.priority=999}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine,this._collisionSystem=t.world.systemManager.get(xn)}update(t,e){var s;if(!this._engine.isDebug)return;const i=this._engine.debug.filter;let n,o;const h=this._engine.debug.entity;let l;const c=this._engine.debug.transform;let u;const m=this._engine.debug.motion;let y;const A=this._engine.debug.collider,F=this._engine.debug.physics;let z;const U=this._engine.debug.graphics;let S,T;const Y=this._engine.debug.body,G=this._engine.debug.camera;for(const st of t){if(st.hasTag("offscreen")||st instanceof Ei||i.useFilter&&(!(i.ids.length===0||i.ids.includes(st.id))||!(i.nameQuery===""||st.name.includes(i.nameQuery))))continue;let $=v.Zero;const k=P(0,16);if(n=st.id,o=st.name,l=st.get(X),this._pushCameraTransform(l),this._graphicsContext.save(),this._applyTransform(st),l&&((c.showAll||c.showPosition)&&this._graphicsContext.debug.drawPoint(v.Zero,{size:4,color:c.positionColor}),(c.showAll||c.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${l.pos.toString(2)}`,$),$=$.add(k)),(c.showAll||c.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${l.z.toFixed(1)})`,$),$=$.add(k)),(h.showAll||h.showId)&&(this._graphicsContext.debug.drawText(`id(${n}) ${st.parent?"child of id("+((s=st.parent)===null||s===void 0?void 0:s.id)+")":""}`,$),$=$.add(k)),(h.showAll||h.showName)&&(this._graphicsContext.debug.drawText(`name(${o})`,$),$=$.add(k)),(c.showAll||c.showRotation)&&(this._graphicsContext.drawLine(v.Zero,v.fromAngle(l.rotation).scale(50).add(v.Zero),c.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${nt(l.rotation).toFixed(2)})`,$),$=$.add(k)),(c.showAll||c.showScale)&&this._graphicsContext.drawLine(v.Zero,l.scale.add(v.Zero),c.scaleColor,2)),z=st.get(Kt),z&&(U.showAll||U.showBounds)&&z.localBounds.draw(this._graphicsContext,U.boundsColor),S=st.get(Si),S&&(S.useTransform||this._graphicsContext.restore(),S.draw(this._graphicsContext),S.useTransform||(this._graphicsContext.save(),this._applyTransform(st))),T=st.get(ht),T&&((Y.showAll||Y.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${T.group.name})`,$),$=$.add(k)),(Y.showAll||Y.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${T.collisionType})`,$),$=$.add(k)),(Y.showAll||Y.showMass)&&(this._graphicsContext.debug.drawText(`mass(${T.mass})`,$),$=$.add(k)),(Y.showAll||Y.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${T.sleepMotion})`,$),$=$.add(k)),(Y.showAll||Y.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${T.canSleep?T.sleeping:"cant sleep"})`,$),$=$.add(k))),this._graphicsContext.restore(),u=st.get(Ft),u&&((m.showAll||m.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${u.vel.toString(2)}`,$.add(l.globalPos)),this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(u.vel),m.velocityColor,2),$=$.add(k)),(m.showAll||m.showAcceleration)&&this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(u.acc),m.accelerationColor,2)),y=st.get(Ut),y){const vt=y.get();if((A.showAll||A.showGeometry)&&vt&&vt.debug(this._graphicsContext,A.geometryColor),A.showAll||A.showBounds){if(vt instanceof Zt){const yt=vt.getColliders();for(const bt of yt){const ft=bt.bounds,Vt=P(ft.left,ft.top);this._graphicsContext.debug.drawRect(Vt.x,Vt.y,ft.width,ft.height,{color:A.boundsColor}),(A.showAll||A.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${bt.owner.id})`,Vt)}y.bounds.draw(this._graphicsContext,A.boundsColor)}else if(vt){const yt=y.bounds,bt=P(yt.left,yt.top);this._graphicsContext.debug.drawRect(bt.x,bt.y,yt.width,yt.height,{color:A.boundsColor}),(A.showAll||A.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${y.owner.id})`,bt)}}}this._popCameraTransform(l)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(F.showAll||F.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),F.showAll||F.showCollisionContacts||F.showCollisionNormals)for(const[st,$]of this._engine.debug.stats.currFrame.physics.contacts){if(F.showAll||F.showCollisionContacts)for(const k of $.points)this._graphicsContext.debug.drawPoint(k,{size:5,color:F.collisionContactColor});if(F.showAll||F.showCollisionNormals)for(const k of $.points)this._graphicsContext.debug.drawLine(k,$.normal.scale(30).add(k),{color:F.collisionNormalColor})}this._graphicsContext.restore(),G&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(G.showAll||G.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,G.focusColor),(G.showAll||G.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}_applyTransform(t){const e=t.getAncestors();for(const s of e){const i=s==null?void 0:s.get(X);i&&(this._graphicsContext.translate(i.pos.x,i.pos.y),this._graphicsContext.scale(i.scale.x,i.scale.y),this._graphicsContext.rotate(i.rotation))}}_pushCameraTransform(t){t.coordPlane===ne.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===ne.World&&this._graphicsContext.restore()}}class Ii extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.pointer"],this.systemType=se.Update,this.priority=-1,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}initialize(t){this._engine=t.engine}preupdate(){this._receiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}notify(t){if($s(t)){const e=t.data.get(X);this._sortedTransforms.push(e),this._sortedEntities.push(e.owner),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(X);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(e);s>-1&&(this._sortedTransforms.splice(s,1),this._sortedEntities.splice(s,1))}}entityCurrentlyUnderPointer(t,e){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(e)}entityWasUnderPointer(t,e){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(e)}entered(t,e){return this.entityCurrentlyUnderPointer(t,e)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,e){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,e)}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id)){this.currentFrameEntityToPointers.set(t.id,[e]);return}const s=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,s.concat(e))}update(t){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receiver.update(),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receiver.clear()}_processPointerToEntity(t){var e;let s,i,n,o;for(const h of t){if(s=h.get(X),o=(e=h.get(ks))!==null&&e!==void 0?e:new ks,i=h.get(Ut),i&&(o.useColliderShape||this.overrideUseColliderShape)){i.update();const l=i.get();if(l)for(const[c,u]of this._receiver.currentFramePointerCoords.entries())l.contains(s.coordPlane===ne.World?u.worldPos:u.screenPos)&&this.addPointerToEntity(h,c)}if(n=h.get(Kt),n&&(o.useGraphicsBounds||this.overrideUseGraphicsBounds)){const l=n.localBounds.transform(s.get().matrix);for(const[c,u]of this._receiver.currentFramePointerCoords.entries())l.contains(s.coordPlane===ne.World?u.worldPos:u.screenPos)&&this.addPointerToEntity(h,c)}}}_processDownAndEmit(t){const e=new Map;for(const s of this._receiver.currentFrameDown)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointerdown",s),this._receiver.isDragStart(s.pointerId)&&t.events.emit("pointerdragstart",s)),e.set(s.pointerId,s);return e}_processUpAndEmit(t){const e=new Map;for(const s of this._receiver.currentFrameUp)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointerup",s),this._receiver.isDragEnd(s.pointerId)&&t.events.emit("pointerdragend",s)),e.set(s.pointerId,s);return e}_processMoveAndEmit(t){const e=new Map;for(const s of this._receiver.currentFrameMove)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointermove",s),this._receiver.isDragging(s.pointerId)&&t.events.emit("pointerdragmove",s)),e.set(s.pointerId,s);return e}_processEnterLeaveAndEmit(t,e){for(const s of e){if(s.active&&t.active&&this.entered(t,s.pointerId)){t.events.emit("pointerenter",s),this._receiver.isDragging(s.pointerId)&&t.events.emit("pointerdragenter",s);break}if(s.active&&t.active&&(this.left(t,s.pointerId)||this.entityCurrentlyUnderPointer(t,s.pointerId)&&s.type==="up")){t.events.emit("pointerleave",s),this._receiver.isDragging(s.pointerId)&&t.events.emit("pointerdragleave",s);break}}}_processCancelAndEmit(t){for(const e of this._receiver.currentFrameCancel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,e.pointerId)&&t.events.emit("pointercancel",e)}_processWheelAndEmit(t){for(const e of this._receiver.currentFrameWheel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",e)}_dispatchEvents(t){const e=new Set(this.lastFrameEntityToPointers.keys()),s=new Set(this.currentFrameEntityToPointers.keys()),i=t.filter(l=>e.has(l.id)||s.has(l.id));let n,o,h;for(const l of i){h=this._processDownAndEmit(l),o=this._processUpAndEmit(l),n=this._processMoveAndEmit(l);const c=[...n.values(),...h.values(),...o.values()];this._processEnterLeaveAndEmit(l,c),this._processCancelAndEmit(l),this._processWheelAndEmit(l)}}}class Wr extends Ie{constructor(){super(...arguments),this.types=["ex.actions"],this.systemType=se.Update,this.priority=-1,this._actions=[]}notify(t){if($s(t)){const e=t.data.get(Rs);this._actions.push(e)}else{const e=t.data.get(Rs),s=this._actions.indexOf(e);s>-1&&this._actions.splice(s,1)}}update(t,e){for(const s of this._actions)s.update(e)}}class Bi extends re{constructor(t){super(),this.type="ex.isometricentity",this.elevation=0,this.map=t}}class Gr extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.isometricentity"],this.systemType=se.Update,this.priority=99}update(t,e){let s,i;for(const n of t){s=n.get(X),i=n.get(Bi);const h=Math.max(i.map.columns*i.map.tileWidth,i.map.rows*i.map.tileHeight)*i.elevation+s.pos.y;s.z=h}}}class Vr extends Ie{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=se.Draw,this.priority=-1}initialize(t){this._camera=t.camera}update(t){let e,s,i;for(const n of t){s=n.get(Kt),e=n.get(X),i=n.get(Ci);let o;if(i){const l=v.One.sub(i.parallaxFactor);o=this._camera.pos.scale(l)}const h=this._isOffscreen(e,s,o);h&&!n.hasTag("ex.offscreen")&&(n.eventDispatcher.emit("exitviewport",new ji(n)),n.addTag("ex.offscreen")),!h&&n.hasTag("ex.offscreen")&&(n.eventDispatcher.emit("enterviewport",new Qi(n)),n.removeTag("ex.offscreen"))}}_isOffscreen(t,e,s){if(t.coordPlane===ne.World){let i=e.localBounds;s&&(i=i.translate(s));const n=i.transform(t.get().matrix);return!this._camera.viewport.overlaps(n)}else return!1}}class ti extends _e{constructor(){super(),this._logger=j.getInstance(),this.camera=new Sr,this.world=new Dr(this),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(new Wr),this.world.add(new kr),this.world.add(new xn),this.world.add(new Ii),this.world.add(new Gr),this.world.add(new Vr),this.world.add(new Hr),this.world.add(new Nr)}get actors(){return this.world.entityManager.entities.filter(t=>t instanceof Ke)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof Tr)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof mr)}get timers(){return this._timers}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera._initialize(t),this.world.systemManager.initialize(),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new N(t,this)),this._isInitialized=!0)}_activate(t){this._logger.debug("Scene.onActivate",this),this.onActivate(t)}_deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new Rt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Yt(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new ye(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new be(t,e,this)),this.onPostDraw(t,e)}update(t,e){this._preupdate(t,e);let s,i;for(s=0,i=this._cancelQueue.length;s<i;s++)this.removeTimer(this._cancelQueue[s]);this._cancelQueue.length=0;for(const n of this._timers)n.update(e);this.world.update(se.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e)}draw(t,e){var s;this._predraw(t,e),this.world.update(se.Draw,e),!((s=this.engine)===null||s===void 0)&&s.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new Ae(t,this)),this.emit("postdebugdraw",new Ce(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof zs){We(this._timers,t)||this.addTimer(t);return}}remove(t){t instanceof Gt&&(this.emit("entityremoved",{target:t}),this.world.remove(t)),t instanceof zs&&this.removeTimer(t)}clear(t=!0){for(const e of this.entities)this.world.remove(e,t);for(const e of this.timers)this.removeTimer(e)}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors.filter(s=>s instanceof vn);for(const s of e)t.stats.currFrame.actors.ui++;for(const s of this.actors){t.stats.currFrame.actors.alive++;for(const i of s.children)_r(i)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}var Cs;(function(r){r.Protanope="Protanope",r.Deuteranope="Deuteranope",r.Tritanope="Tritanope"})(Cs||(Cs={}));const ha=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class Xr{constructor(t){this._shader=new ge({vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_texcoord;
      out vec2 v_texcoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_texcoord;
      }`,fragmentSource:t}),this._shader.compile(),this._buffer=new ls({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new cs({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class Yr{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new Xr(ha),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===Cs.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===Cs.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===Cs.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Zr{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Yr(Cs.Protanope)}correct(t){this._engine.graphicsContext instanceof Ys&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof Ys&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class jr{constructor(t){this.stats={currFrame:new ei,prevFrame:new ei},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!0,showName:!1},this.transform={showAll:!1,showPosition:!1,showPositionLabel:!1,positionColor:D.Yellow,showZIndex:!1,showScale:!1,scaleColor:D.Green,showRotation:!1,rotationColor:D.Blue},this.graphics={showAll:!1,showBounds:!0,boundsColor:D.Yellow},this.collider={showAll:!1,showBounds:!0,boundsColor:D.Blue,showOwner:!1,showGeometry:!0,geometryColor:D.Green},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:D.Cyan,showCollisionContacts:!0,collisionContactColor:D.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:D.Yellow,showAcceleration:!1,accelerationColor:D.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:D.Red,showZoom:!1},this._engine=t,this.colorBlindMode=new Zr(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toTestClock();return e&&s.start(),this._engine.clock=s,s}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const s=t.toStandardClock();return e&&s.start(),this._engine.clock=s,s}}class ei{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Fi,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new ei;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Fi{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Fi;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}var Os;(function(r){r.Canvas="Canvas",r.Document="Document"})(Os||(Os={}));var yn;(function(r){r.Num0="Numpad0",r.Num1="Numpad1",r.Num2="Numpad2",r.Num3="Numpad3",r.Num4="Numpad4",r.Num5="Numpad5",r.Num6="Numpad6",r.Num7="Numpad7",r.Num8="Numpad8",r.Num9="Numpad9",r.NumAdd="NumpadAdd",r.NumSubtract="NumpadSubtract",r.NumMultiply="NumpadMultiply",r.NumDivide="NumpadDivide",r.NumDecimal="NumpadDecimal",r.Numpad0="Numpad0",r.Numpad1="Numpad1",r.Numpad2="Numpad2",r.Numpad3="Numpad3",r.Numpad4="Numpad4",r.Numpad5="Numpad5",r.Numpad6="Numpad6",r.Numpad7="Numpad7",r.Numpad8="Numpad8",r.Numpad9="Numpad9",r.NumpadAdd="NumpadAdd",r.NumpadSubtract="NumpadSubtract",r.NumpadMultiply="NumpadMultiply",r.NumpadDivide="NumpadDivide",r.NumpadDecimal="NumpadDecimal",r.NumLock="NumLock",r.ShiftLeft="ShiftLeft",r.ShiftRight="ShiftRight",r.AltLeft="AltLeft",r.AltRight="AltRight",r.ControlLeft="ControlLeft",r.ControlRight="ControlRight",r.MetaLeft="MetaLeft",r.MetaRight="MetaRight",r.Key0="Digit0",r.Key1="Digit1",r.Key2="Digit2",r.Key3="Digit3",r.Key4="Digit4",r.Key5="Digit5",r.Key6="Digit6",r.Key7="Digit7",r.Key8="Digit8",r.Key9="Digit9",r.Digit0="Digit0",r.Digit1="Digit1",r.Digit2="Digit2",r.Digit3="Digit3",r.Digit4="Digit4",r.Digit5="Digit5",r.Digit6="Digit6",r.Digit7="Digit7",r.Digit8="Digit8",r.Digit9="Digit9",r.F1="F1",r.F2="F2",r.F3="F3",r.F4="F4",r.F5="F5",r.F6="F6",r.F7="F7",r.F8="F8",r.F9="F9",r.F10="F10",r.F11="F11",r.F12="F12",r.A="KeyA",r.B="KeyB",r.C="KeyC",r.D="KeyD",r.E="KeyE",r.F="KeyF",r.G="KeyG",r.H="KeyH",r.I="KeyI",r.J="KeyJ",r.K="KeyK",r.L="KeyL",r.M="KeyM",r.N="KeyN",r.O="KeyO",r.P="KeyP",r.Q="KeyQ",r.R="KeyR",r.S="KeyS",r.T="KeyT",r.U="KeyU",r.V="KeyV",r.W="KeyW",r.X="KeyX",r.Y="KeyY",r.Z="KeyZ",r.KeyA="KeyA",r.KeyB="KeyB",r.KeyC="KeyC",r.KeyD="KeyD",r.KeyE="KeyE",r.KeyF="KeyF",r.KeyG="KeyG",r.KeyH="KeyH",r.KeyI="KeyI",r.KeyJ="KeyJ",r.KeyK="KeyK",r.KeyL="KeyL",r.KeyM="KeyM",r.KeyN="KeyN",r.KeyO="KeyO",r.KeyP="KeyP",r.KeyQ="KeyQ",r.KeyR="KeyR",r.KeyS="KeyS",r.KeyT="KeyT",r.KeyU="KeyU",r.KeyV="KeyV",r.KeyW="KeyW",r.KeyX="KeyX",r.KeyY="KeyY",r.KeyZ="KeyZ",r.Semicolon="Semicolon",r.Quote="Quote",r.Comma="Comma",r.Minus="Minus",r.Period="Period",r.Slash="Slash",r.Equal="Equal",r.BracketLeft="BracketLeft",r.Backslash="Backslash",r.BracketRight="BracketRight",r.Backquote="Backquote",r.Up="ArrowUp",r.Down="ArrowDown",r.Left="ArrowLeft",r.Right="ArrowRight",r.ArrowUp="ArrowUp",r.ArrowDown="ArrowDown",r.ArrowLeft="ArrowLeft",r.ArrowRight="ArrowRight",r.Space="Space",r.Backspace="Backspace",r.Delete="Delete",r.Esc="Escape",r.Escape="Escape",r.Enter="Enter",r.NumpadEnter="NumpadEnter",r.ContextMenu="ContextMenu"})(yn||(yn={}));class Mi extends ot{constructor(t,e,s){super(),this.key=t,this.value=e,this.originalEvent=s}}class Qr extends _e{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[],this._handleKeyDown=t=>{const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const s=new Mi(e,t.key,t);this.eventDispatcher.emit("down",s),this.eventDispatcher.emit("press",s)}},this._handleKeyUp=t=>{const e=t.code,s=this._keys.indexOf(e);this._keys.splice(s,1),this._keysUp.push(e);const i=new Mi(e,t.key,t);this.eventDispatcher.emit("up",i),this.eventDispatcher.emit("release",i)}}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch{t=window,j.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",()=>{this._keys.length=0}),t.addEventListener("keyup",this._handleKeyUp),t.addEventListener("keydown",this._handleKeyDown)}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new Mi(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,e,s){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:s??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:s??null}))}}class Di extends _e{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(i=>typeof i!==void 0).length,s=t.buttons.filter(i=>typeof i!==void 0).length;return e>=this._minimumConfiguration.axis&&s>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(t[e])!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new Se(e,this.at(e))),this.at(e).connected=!0;else{const l=this.at(e);l.connected&&this.eventDispatcher.emit("disconnect",new ue(e,l)),l.connected=!1;continue}if(t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e];let s,i,n,o,h;for(s in si)i=si[s],typeof i=="number"&&t[e].buttons[i]&&(h=t[e].buttons[i].value,h!==this._oldPads[e].getButton(i)&&(t[e].buttons[i].pressed?(this.at(e).updateButton(i,h),this.at(e).eventDispatcher.emit("button",new Oe(i,h,this.at(e)))):this.at(e).updateButton(i,0)));for(n in ii)o=ii[n],typeof o=="number"&&(h=t[e].axes[o],h!==this._oldPads[e].getAxes(o)&&(this.at(e).updateAxes(o,h),this.at(e).eventDispatcher.emit("axis",new ct(o,h,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,s=t;e<s;e++)this._pads.push(new ki),this._oldPads.push(new ki);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let s=0,i=t.length;s<i;s++)e.push(this._clonePad(t[s]));return e}_clonePad(t){let e,s;const i=new ki;if(!t)return i;for(e=0,s=t.buttons.length;e<s;e++)t.buttons[e]&&i.updateButton(e,t.buttons[e].value);for(e=0,s=t.axes.length;e<s;e++)i.updateAxes(e,t.axes[e]);return i}}Di.MinAxisMoveThreshold=.05;class ki extends _e{constructor(){super(),this.connected=!1,this._buttons=new Array(16),this._axes=new Array(4);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}isButtonPressed(t,e=1){return this._buttons[t]>=e}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Di.MinAxisMoveThreshold?0:e}updateButton(t,e){this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}var si;(function(r){r[r.Face1=0]="Face1",r[r.Face2=1]="Face2",r[r.Face3=2]="Face3",r[r.Face4=3]="Face4",r[r.LeftBumper=4]="LeftBumper",r[r.RightBumper=5]="RightBumper",r[r.LeftTrigger=6]="LeftTrigger",r[r.RightTrigger=7]="RightTrigger",r[r.Select=8]="Select",r[r.Start=9]="Start",r[r.LeftStick=10]="LeftStick",r[r.RightStick=11]="RightStick",r[r.DpadUp=12]="DpadUp",r[r.DpadDown=13]="DpadDown",r[r.DpadLeft=14]="DpadLeft",r[r.DpadRight=15]="DpadRight"})(si||(si={}));var ii;(function(r){r[r.LeftStickX=0]="LeftStickX",r[r.LeftStickY=1]="LeftStickY",r[r.RightStickX=2]="RightStickX",r[r.RightStickY=3]="RightStickY"})(ii||(ii={}));class bn{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class qr{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new bn(this._windowGlobal),this._documentComponent=new bn(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class ni{constructor(t,e,s){this.worldPos=t,this.pagePos=e,this.screenPos=s}static fromPagePosition(t,e,s){let i,n,o,h;arguments.length===3?(i=t,n=e,o=new v(i,n),h=s):(o=t,i=o.x,n=o.y,h=e);const l=h.screen.pageToScreenCoordinates(o),c=h.screen.screenToWorldCoordinates(l);return new ni(c,o,l)}}class ri{constructor(t,e,s,i,n,o){this.type=t,this.pointerId=e,this.button=s,this.pointerType=i,this.coordinates=n,this.nativeEvent=o,this.active=!0}cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}}class $r{constructor(t,e,s,i,n,o,h,l,c,u,m,y){this.x=t,this.y=e,this.pageX=s,this.pageY=i,this.screenX=n,this.screenY=o,this.index=h,this.deltaX=l,this.deltaY=c,this.deltaZ=u,this.deltaMode=m,this.ev=y,this.active=!0}cancel(){this.active=!1}}class Kr extends _e{constructor(){super(),this.lastPagePos=v.Zero,this.lastScreenPos=v.Zero,this.lastWorldPos=v.Zero,this._onPointerMove=t=>{this.lastPagePos=new v(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new v(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new v(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new v(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new v(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new v(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}}var Hs;(function(r){r.Pixel="Pixel",r.Line="Line",r.Page="Page"})(Hs||(Hs={}));var fs;(function(r){r[r.NoButton=-1]="NoButton",r[r.Left=0]="Left",r[r.Middle=1]="Middle",r[r.Right=2]="Right",r[r.Unknown=3]="Unknown"})(fs||(fs={}));var Je;(function(r){r.Left="Left",r.Middle="Middle",r.Right="Right",r.Unknown="Unknown",r.NoButton="NoButton"})(Je||(Je={}));var ts;(function(r){r.Touch="Touch",r.Mouse="Mouse",r.Pen="Pen",r.Unknown="Unknown"})(ts||(ts={}));function la(r){return globalThis.TouchEvent&&r instanceof globalThis.TouchEvent}function ca(r){return globalThis.PointerEvent&&r instanceof globalThis.PointerEvent}class Ri extends _e{constructor(t,e){super(),this.target=t,this.engine=e,this.primary=new Kr,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}recreate(t,e){const s=new Ri(t,e);return s.primary=this.primary,s._pointers=this._pointers,s}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,s=t;e<s;e++)this._pointers.push(new Kr);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return(e=this.currentFramePointerDown.get(t))!==null&&e!==void 0?e:!1}wasDown(t){var e;return(e=this.lastFramePointerDown.get(t))!==null&&e!==void 0?e:!1}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[s,i]of e)i===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(s)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(){this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const t={passive:!(this.engine.pageScrollPreventionMode===gs.All||this.engine.pageScrollPreventionMode===gs.Canvas)};"onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,t):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,t):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,t)}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const s=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((i,n)=>i-n).findIndex(i=>i===t);return this._activeNativePointerIdsToNormalized.set(t,s),s}_handle(t){t.preventDefault();const e=new Map;let s,i;if(la(t)){s=Je.Unknown,i=ts.Touch;for(let n=0;n<t.changedTouches.length;n++){const o=t.changedTouches[n],h=ni.fromPagePosition(o.pageX,o.pageY,this.engine),l=n+1,c=this._normalizePointerId(l);this.currentFramePointerCoords.set(c,h),e.set(c,h)}}else{s=this._nativeButtonToPointerButton(t.button),i=ts.Mouse;const n=ni.fromPagePosition(t.pageX,t.pageY,this.engine);let o=1;ca(t)&&(o=t.pointerId,i=this._stringToPointerType(t.pointerType));const h=this._normalizePointerId(o);this.currentFramePointerCoords.set(h,n),e.set(h,n)}for(const[n,o]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new ri("down",n,s,i,o,t)),this.currentFramePointerDown.set(n,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new ri("up",n,s,i,o,t)),this.currentFramePointerDown.set(n,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new ri("move",n,s,i,o,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new ri("cancel",n,s,i,o,t));break}}_handleWheel(t){(this.engine.pageScrollPreventionMode===gs.All||this.engine.pageScrollPreventionMode===gs.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(P(t.pageX,t.pageY)),s=this.engine.screen.screenToWorldCoordinates(e),i=-1/40,n=t.deltaX||t.wheelDeltaX*i||0,o=t.deltaY||t.wheelDeltaY*i||t.wheelDelta*i||t.detail||0,h=t.deltaZ||0;let l=Hs.Pixel;t.deltaMode&&(t.deltaMode===1?l=Hs.Line:t.deltaMode===2&&(l=Hs.Page));const c=new $r(s.x,s.y,t.pageX,t.pageY,e.x,e.y,0,n,o,h,l,t);this.currentFrameWheel.push(c)}triggerEvent(t,e){const s=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:s.x,clientY:s.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:s.x,clientY:s.y}));const i=this.engine.currentScene.world.systemManager.get(Ii),n=this.engine.currentScene.world.queryManager.createQuery(i.types);i.preupdate(),i.update(n.getEntities())}_nativeButtonToPointerButton(t){switch(t){case fs.NoButton:return Je.NoButton;case fs.Left:return Je.Left;case fs.Middle:return Je.Middle;case fs.Right:return Je.Right;case fs.Unknown:return Je.Unknown;default:return Ge(t)}}_stringToPointerType(t){switch(t){case"touch":return ts.Touch;case"mouse":return ts.Mouse;case"pen":return ts.Pen;default:return ts.Unknown}}}class Jr{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!==null&&e!==void 0?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class An{constructor(t){var e,s,i;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!==null&&e!==void 0?e:0,this._maxFps=(s=t.maxFps)!==null&&s!==void 0?s:this._maxFps,this._onFatalException=(i=t.onFatalException)!==null&&i!==void 0?i:this._onFatalException,this.fpsSampler=new Jr({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new to({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Cn({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0){const s=this._totalElapsed+e;this._scheduledCbs.push([t,s])}_runScheduledCbs(){for(let t=this._scheduledCbs.length-1;t>-1;t--)this._scheduledCbs[t][1]<=this._totalElapsed&&(this._scheduledCbs[t][0](),this._scheduledCbs.splice(t,1))}update(t){try{this.fpsSampler.start();const e=this.now();let s=e-this._lastTime||1;const i=1e3/this._maxFps;if(s>=i){let n=0;i!==0&&(n=s%i,s=s-n),s>200&&(s=1),this._elapsed=t||s,this._totalElapsed+=this._elapsed,this._runScheduledCbs(),this.tick(t||s),i!==0?this._lastTime=e-n:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class Cn extends An{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){this._running=!1}}class to extends An{constructor(t){super({...t}),this._logger=j.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let s=0;s<t;s++)this.step(e??this._updateMs)}}var da=Tt(7379);class eo{constructor(){this._toasterCss=da.Z.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,s){this._initialize();const i=document.createElement("div");i.className="ex-toast-message";const n=t.split("[LINK]").map(u=>this._createFragment(u));if(e){const u=document.createElement("a");u.href=e,s?u.innerText=s:u.innerText=e,n.splice(1,0,u)}const o=document.createElement("div");n.forEach(u=>{o.appendChild(u)}),i.appendChild(o);const h=document.createElement("button");h.innerText="x",h.addEventListener("click",()=>{this._container.removeChild(i)}),i.appendChild(h);const l=u=>{if(u.key==="Escape")try{this._container.removeChild(i)}catch{}document.removeEventListener("keydown",l)};document.addEventListener("keydown",l);const c=this._container.firstChild;this._container.insertBefore(i,c)}}w();var gs;(function(r){r[r.None=0]="None",r[r.Canvas=1]="Canvas",r[r.All=2]="All"})(gs||(gs={}));class Ns extends _e{constructor(t){var e,s,i,n,o,h;super(),this.maxFps=Number.POSITIVE_INFINITY,this.scenes={},this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=m=>{j.getInstance().fatal(m)},this._toaster=new eo,this._timescale=1,this._isInitialized=!1,this._deferredGoTo=null,this._originalOptions={},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._loadingComplete=!1,this._isReady=!1,this._isReadyPromise=new Promise(m=>{this._isReadyResolve=m}),this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...Ns._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,x.freeze(),this.browser=new qr(window,document);const l=new Xn;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=l.test())){const m=document.createElement("div");if(m.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(m),l.failedTests.forEach(function(y){const A=document.createElement("div");A.innerText="Browser feature missing "+y,document.body.appendChild(A)}),t.canvasElementId){const y=document.getElementById(t.canvasElementId);y&&y.parentElement.removeChild(y)}return}else this._compatible=!0;console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${ro})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=j.getInstance(),this._logger.defaultLevel===mt.Debug&&l.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let c=(e=t.displayMode)!==null&&e!==void 0?e:zt.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(c=zt.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),c=zt.FitScreen),this._originalDisplayMode=c;let u=x.isEnabled("use-canvas-context");if(!u)try{this.graphicsContext=new Ys({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})}catch(m){this._logger.warn(`Excalibur could not load webgl for some reason (${m.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/webgl`),u=!0}u&&(this.graphicsContext=new ci({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new nn({canvas:this.canvas,context:this.graphicsContext,antialiasing:(s=t.antialiasing)!==null&&s!==void 0?s:!0,browser:this.browser,viewport:(i=t.viewport)!==null&&i!==void 0?i:t.width&&t.height?{width:t.width,height:t.height}:sn.SVGA,resolution:t.resolution,displayMode:c,pixelRatio:t.suppressHiDPIScaling?1:(n=t.pixelRatio)!==null&&n!==void 0?n:null}),ut.filtering=t.antialiasing?fe.Blended:fe.Pixel,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(o=t.maxFps)!==null&&o!==void 0?o:this.maxFps,this.fixedUpdateFps=(h=t.fixedUpdateFps)!==null&&h!==void 0?h:this.fixedUpdateFps,this.clock=new Cn({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:m=>this.onFatalException(m)}),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new Gn,this._loader.wireEngine(this),this.debug=new jr(this),this._initialize(t),this.rootScene=this.currentScene=new ti,this.addScene("root",this.rootScene),window.___EXCALIBUR_DEVTOOL=this}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:s}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=Ns._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),s===void 0&&(s=Ns._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!x.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let i=0;for(let o=0;o<this._fpsSamples.length;o++)i+=this._fpsSamples[o];const n=i/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&n<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),s&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,s;const i=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(i,this.canvas),this.canvas=i;const n=this._originalOptions,o=this._originalDisplayMode;this.graphicsContext=new ci({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:n.antialiasing,backgroundColor:n.backgroundColor,snapToPixel:n.snapToPixel,useDrawSorting:n.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new nn({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=n.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(e=n.viewport)!==null&&e!==void 0?e:n.width&&n.height?{width:n.width,height:n.height}:sn.SVGA,resolution:n.resolution,displayMode:o,pixelRatio:n.suppressHiDPIScaling?1:(s=n.pixelRatio)!==null&&s!==void 0?s:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const h=n&&n.pointerScope===Os.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(h,this),this.input.pointers.init()}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<=0){j.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0.");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof ti)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];typeof t=="string"&&delete this.scenes[t]}add(t){if(arguments.length===2){this.addScene(arguments[0],arguments[1]);return}this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t)}remove(t){t instanceof Gt&&this.currentScene.remove(t),t instanceof ti&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}goToScene(t,e){if(!this.isInitialized){this._deferredGoTo=t;return}if(this.scenes[t]){const s=this.currentScene,i=this.scenes[t];if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const o={engine:this,previousScene:s,nextScene:i};this.currentScene._deactivate.apply(this.currentScene,[o,i]),this.currentScene.eventDispatcher.emit("deactivate",new Zi(o,this.currentScene))}this.currentScene=i,this.screen.setCurrentCamera(i.camera),this.currentScene._initialize(this);const n={engine:this,previousScene:s,nextScene:i,data:e};this.currentScene._activate.apply(this.currentScene,[n,i]),this.currentScene.eventDispatcher.emit("activate",new Yi(n,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){this.pageScrollPreventionMode=t.scrollPreventionMode;const e=t&&t.pointerScope===Os.Document?document:this.canvas;this.input={keyboard:new Qr,pointers:new Ri(e,this),gamepads:new Di},this.input.keyboard.init(),this.input.pointers.init(),this.input.gamepads.init();let s,i;typeof document.hidden<"u"?(s="hidden",i="visibilitychange"):"msHidden"in document?(s="msHidden",i="msvisibilitychange"):"webkitHidden"in document&&(s="webkitHidden",i="webkitvisibilitychange"),this.browser.document.on(i,()=>{document[s]?(this.eventDispatcher.emit("hidden",new ns(this)),this._logger.debug("Window hidden")):(this.eventDispatcher.emit("visible",new is(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){if(!this.isInitialized)if(this.onInitialize(t),super.emit("initialize",new N(t,this)),this._isInitialized=!0,this._deferredGoTo){const e=this._deferredGoTo;this._deferredGoTo=null,this.goToScene(e)}else this.goToScene("root")}_update(t){if(!this.ready){this._loader.update(this,t),this.input.keyboard.update(),this.input.gamepads.update();return}this._preupdate(t),this.currentScene.update(this,t),this._postupdate(t),this.input.keyboard.update(),this.input.gamepads.update()}_preupdate(t){this.emit("preupdate",new Rt(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new Yt(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this._predraw(this.graphicsContext,t),!this._isReady){this._loader.canvas.draw(this.graphicsContext,0,0),this.graphicsContext.flush();return}this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.graphicsContext,t),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new ye(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new be(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return this._loadingComplete}get ready(){return this._isReady}isReady(){return this._isReadyPromise}async start(t){if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");return t&&(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this)),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),t&&(await this.load(this._loader),this._loadingComplete=!0,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport()),this._loadingComplete=!0,this._overrideInitialize(this),this._isReady=!0,this._isReadyResolve(),this.emit("start",new Ye(this)),this._isReadyPromise}_mainloop(t){this.emit("preframe",new ce(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const s=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=s,this.stats.currFrame.delta=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,Dt.clear();const i=this.clock.now(),n=1e3/this.fixedUpdateFps;if(this.fixedUpdateFps)for(this._lagMs+=e;this._lagMs>=n;)this._update(n),this._lagMs-=n;else this._update(e);const o=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const h=this.clock.now();this.stats.currFrame.duration.update=o-i,this.stats.currFrame.duration.draw=h-o,this.stats.currFrame.graphics.drawnImages=Dt.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=Dt.DrawCallCount,this.emit("postframe",new de(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()}stop(){this.clock.isRunning()&&(this.emit("stop",new Ze(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(s=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:s})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,s=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,i=document.createElement("canvas");i.width=e,i.height=s,i.getContext("2d").drawImage(this.canvas,0,0,e,s);const o=new Image,h=i.toDataURL("image/png");o.src=h,t.resolve(o)}this._screenShotRequests.length=0}async load(t){try{await t.load()}catch(e){this._logger.error("Error loading resources, things may not behave properly",e),await Promise.resolve()}}}Ns._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!0,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:Os.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:gs.Canvas,backgroundColor:D.fromHex("#2185d0")};class ua extends Ke{constructor(t){super(t),this._font=new Ls,this._text=new qs({text:"",font:this._font});const{text:e,pos:s,x:i,y:n,spriteFont:o,font:h,color:l}=t;this.pos=s??(i&&n?P(i,n):this.pos),this.text=e??this.text,this.font=h??this.font,this.spriteFont=o??this.spriteFont,this._text.color=l??this.color;const c=this.get(Kt);c.anchor=v.Zero,c.use(this._text)}get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}class so extends Gt{constructor(t,e,s,i){super([new X,new Kt({offset:s??v.Zero,onPostDraw:(y,A)=>this.draw(y,A)}),new Bi(i)]),this.solid=!1,this._tileBounds=new Z,this._graphics=[],this._colliders=[],this.x=t,this.y=e,this.map=i,this._transform=this.get(X),this._isometricEntityComponent=this.get(Bi);const n=this.map.tileWidth/2,o=this.map.tileHeight/2,h=(this.x-this.y)*n,l=(this.x+this.y)*o;this._transform.pos=P(h,l),this._isometricEntityComponent.elevation=0,this._gfx=this.get(Kt),this._gfx.visible=!1;const c=this.map.tileWidth,u=this.map.tileHeight,m=P(0,this.map.renderFromTopOfGraphic?u:0);this._gfx.localBounds=this._tileBounds=new Z({left:-c/2,top:-u,right:c/2,bottom:u}).translate(m)}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t),this._gfx.visible=!0,this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const s=P(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(s))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(P(this.x,this.y))}get center(){return this.pos.add(P(0,this.map.tileHeight/2))}draw(t,e){const s=this.map.tileWidth/2;t.save(),t.translate(-s,0);for(const i of this._graphics)i.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:i.height-this.map.tileHeight));t.restore()}}class pa extends Gt{constructor(t){super([new X,new ht({type:rt.Fixed}),new Ut,new Si(c=>this.debug(c),!1)],t.name),this.renderFromTopOfGraphic=!1,this.graphicsOffset=P(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:s,tileHeight:i,columns:n,rows:o,renderFromTopOfGraphic:h,graphicsOffset:l}=t;this.transform=this.get(X),e&&(this.transform.pos=e),this.collider=this.get(Ut),this.collider&&this.collider.set(this._composite=new Zt([])),this.renderFromTopOfGraphic=h??this.renderFromTopOfGraphic,this.graphicsOffset=l??this.graphicsOffset,this.tileWidth=s,this.tileHeight=i,this.columns=n,this.rows=o,this.tiles=new Array(n*o);for(let c=0;c<o;c++)for(let u=0;u<n;u++){const m=new so(u,c,this.graphicsOffset,this);this.tiles[u+c*n]=m,this.addChild(m)}}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}updateColliders(){this._composite.clearColliders();const t=this.get(X).pos;for(const e of this.tiles)if(e.solid)for(const s of e.getColliders()){const i=this._getOrSetColliderOriginalOffset(s);s.offset=this.tileToWorld(P(e.x,e.y)).sub(t).add(i).sub(P(this.tileWidth/2,this.tileHeight)),s.owner=this,this._composite.addCollider(s)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,s=this.tileHeight/2;return P(~~((t.x/e+t.y/s)/2),~~((t.y/s-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,s=this.tileHeight/2,i=(t.x-t.y)*e,n=(t.x+t.y)*s;return P(i,n).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const e of this.tiles){const s=e.get(X).z;s>t&&(t=s)}return t}debug(t){t.save(),t.z=this._getMaxZIndex()+.5;for(let e=0;e<this.rows+1;e++){const s=this.tileToWorld(P(0,e)),i=this.tileToWorld(P(this.columns,e));t.drawLine(s,i,D.Red,2)}for(let e=0;e<this.columns+1;e++){const s=this.tileToWorld(P(e,0)),i=this.tileToWorld(P(e,this.rows));t.drawLine(s,i,D.Red,2)}for(const e of this.tiles)t.drawCircle(this.tileToWorld(P(e.x,e.y)),3,D.Yellow);t.restore()}}class Sn{constructor(t,e){this._stopped=!1,this._sequenceBuilder=e,this._sequenceContext=new Qs(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new Sn(t,this._sequenceBuilder)}}class fa{constructor(t){this._actions=t}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}isComplete(t){return this._actions.every(e=>e.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class Ss{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const s=new qe(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,s),s}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}Ss._STARTING_BIT=1,Ss._MAX_GROUPS=32,Ss._CURRENT_GROUP=1,Ss._CURRENT_BIT=Ss._STARTING_BIT,Ss._GROUPS=new Map;function ga(r){return!!r._initialize}function _a(r){return!!r.onInitialize}function ma(r){return!!r._preupdate}function wa(r){return!!r.onPreUpdate}function va(r){return!!r.onPostUpdate}function xa(r){return!!r.onPostUpdate}function ya(r){return!!r.onPreDraw}function ba(r){return!!r.onPostDraw}class Aa{constructor(t,e=D.Magenta,s=!0){this.path=t,this.color=e,this.bustCache=s,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new ai(t,"arraybuffer",s),this._transparentColor=e}async load(){const t=await this._resource.load();this._stream=new io(t),this._gif=new no(this._stream,this._transparentColor);const e=this._gif.images.map(s=>new Ki(s.src,!1));return await Promise.all(e.map(s=>s.load())),this.data=this._textures=e}isLoaded(){return!!this.data}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map(e=>e.toSprite());return new Bs({sprites:t})}toAnimation(t){const e=this.toSpriteSheet(),s=e.sprites.length;return this._animation=ps.fromSpriteSheet(e,V(0,s),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const Li=r=>r.reduce(function(t,e){return t*2+e},0),Tn=r=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(r&1<<e));return t};class io{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=e=>{const s=[];for(let i=0;i<e;i++)s.push(this.readByte());return s},this.read=e=>{let s="";for(let i=0;i<e;i++)s+=String.fromCharCode(this.readByte());return s},this.readUnsigned=()=>{const e=this.readBytes(2);return(e[1]<<8)+e[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}const Ca=function(r,t){let e=0;const s=function(y){let A=0;for(let F=0;F<y;F++)t.charCodeAt(e>>3)&1<<(e&7)&&(A|=1<<F),e++;return A},i=[],n=1<<r,o=n+1;let h=r+1,l=[];const c=function(){l=[],h=r+1;for(let y=0;y<n;y++)l[y]=[y];l[n]=[],l[o]=null};let u,m;for(;;){if(m=u,u=s(h),u===n){c();continue}if(u===o)break;if(u<l.length)m!==n&&l.push(l[m].concat(l[u][0]));else{if(u!==l.length)throw new Error("Invalid LZW code.");l.push(l[m].concat(l[m][0]))}i.push.apply(i,l[u]),l.length===1<<h&&h<12&&h++}return i};class no{constructor(t,e=D.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=s=>{const i=[];for(let n=0;n<s;n++){const h="#"+this._st.readBytes(3).map(l=>{const c=l.toString(16);return c.length===1?"0"+c:c}).join("");i.push(h)}return i},this.readSubBlocks=()=>{let s,i;i="";do s=this._st.readByte(),i+=this._st.read(s);while(s!==0);return i},this.parseHeader=()=>{const s={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(s.sig=this._st.read(3),s.ver=this._st.read(3),s.sig!=="GIF")throw new Error("Not a GIF file.");s.width=this._st.readUnsigned(),s.height=this._st.readUnsigned();const i=Tn(this._st.readByte());s.gctFlag=i.shift(),s.colorRes=Li(i.splice(0,3)),s.sorted=i.shift(),s.globalColorTableSize=Li(i.splice(0,3)),s.bgColor=this._st.readByte(),s.pixelAspectRatio=this._st.readByte(),s.gctFlag&&(s.globalColorTable=this.parseColorTable(1<<s.globalColorTableSize+1),this.globalColorTable=s.globalColorTable),this._handler.hdr&&this._handler.hdr(s)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=s=>{const i=c=>{this.checkBytes.push(this._st.readByte());const u=Tn(this._st.readByte());c.reserved=u.splice(0,3),c.disposalMethod=Li(u.splice(0,3)),c.userInput=u.shift(),c.transparencyGiven=u.shift(),c.delayTime=this._st.readUnsigned(),c.transparencyIndex=this._st.readByte(),c.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(c)&&this.checkBytes.push(this._handler.gce)},n=c=>{c.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(c)&&this.checkBytes.push(this._handler.com)},o=c=>{this.checkBytes.push(this._st.readByte()),c.ptHeader=this._st.readBytes(12),c.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(c)&&this.checkBytes.push(this._handler.pte)},h=c=>{const u=y=>{this.checkBytes.push(this._st.readByte()),y.unknown=this._st.readByte(),y.iterations=this._st.readUnsigned(),y.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(y)&&this.checkBytes.push(this._handler.app)},m=y=>{y.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[y.identifier]&&this._handler.app[y.identifier](y)&&this.checkBytes.push(this._handler.app[y.identifier])};switch(this.checkBytes.push(this._st.readByte()),c.identifier=this._st.read(8),c.authCode=this._st.read(3),c.identifier){case"NETSCAPE":u(c);break;default:m(c);break}},l=c=>{c.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(c)&&this.checkBytes.push(this._handler.unknown)};switch(s.label=this._st.readByte(),s.label){case 249:s.extType="gce",i(s);break;case 254:s.extType="com",n(s);break;case 1:s.extType="pte",o(s);break;case 255:s.extType="app",h(s);break;default:s.extType="unknown",l(s);break}},this.parseImg=s=>{const i=(h,l)=>{const c=new Array(h.length),u=h.length/l,m=(z,U)=>{const S=h.slice(U*l,(U+1)*l);c.splice.apply(c,[z*l,l].concat(S))},y=[0,4,2,1],A=[8,8,4,2];let F=0;for(let z=0;z<4;z++)for(let U=y[z];U<u;U+=A[z])m(U,F),F++;return c};s.leftPos=this._st.readUnsigned(),s.topPos=this._st.readUnsigned(),s.width=this._st.readUnsigned(),s.height=this._st.readUnsigned();const n=Tn(this._st.readByte());s.lctFlag=n.shift(),s.interlaced=n.shift(),s.sorted=n.shift(),s.reserved=n.splice(0,2),s.lctSize=Li(n.splice(0,3)),s.lctFlag&&(s.lct=this.parseColorTable(1<<s.lctSize+1)),s.lzwMinCodeSize=this._st.readByte();const o=this.readSubBlocks();s.pixels=Ca(s.lzwMinCodeSize,o),s.interlaced&&(s.pixels=i(s.pixels,s.width)),this.frames.push(s),this.arrayToImage(s),this._handler.img&&this._handler.img(s)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const s={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(s.sentinel)){case"!":s.type="ext",this.parseExt(s);break;case",":s.type="img",this.parseImg(s);break;case";":s.type="eof",this._handler.eof&&this._handler.eof(s)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+s.sentinel.toString(16))}s.type!=="eof"&&this.parseBlock()},this.arrayToImage=s=>{let i=0;const n=document.createElement("canvas");n.id=i.toString(),n.width=s.width,n.height=s.height,i++;const o=n.getContext("2d"),h=1;let l=0,c=0;for(let m=0;m<s.pixels.length;m++)c%s.width===0&&(l++,c=0),this.globalColorTable[s.pixels[m]]===this._transparentColor.toHex()?o.fillStyle="rgba(0, 0, 0, 0)":o.fillStyle=this.globalColorTable[s.pixels[m]],o.fillRect(c,l,h,h),c++;const u=new Image;u.src=n.toDataURL(),this.images.push(u)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class Pn extends te{constructor(t){super(),this.color=D.Black,this.thickness=1;const{start:e,end:s,color:i,thickness:n}=t;this.start=e,this.end=s,this.color=i??this.color,this.thickness=n??this.thickness;const{width:o,height:h}=Z.fromPoints([e,s]);this.width=o,this.height=h}_drawImage(t,e,s){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new Pn({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class En extends Ms{constructor(t){super(t),this.points=t.points,this.filtering=fe.Blended,this.rasterize()}get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce((s,i)=>Math.max(i.x,s),0)-e.x,this.height=this._points.reduce((s,i)=>Math.max(i.y,s),0)-e.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((s,i)=>Math.min(i.x,s),1/0),e=this._points.reduce((s,i)=>Math.min(i.y,s),1/0);return P(t,e)}clone(){return new En({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),s=this.points[0].add(e);t.moveTo(s.x,s.y),this.points.forEach(i=>{t.lineTo(i.x+e.x,i.y+e.y)}),t.lineTo(s.x,s.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}class Sa{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new At;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class Ta{constructor(t){this._count=t,this._waitQueue=new Sa}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const ro="0.27.0";w()})();f.fWn;f.Ia8;f.rqv;f.hLI;f.yyv;f.tX5;var J=f.vtX;f.r7K;f.lCh;f.cE4;f.fwF;f.sce;f._c7;f.KUs;f.Ajp;f.RDh;f._H9;f.mxs;f.OmD;f.kBf;f.C4F;f.NQt;f.JjN;f.V1s;f.Xz7;f.Cdc;f.FKn;f.wTW;f.SUY;f.ab2;f.GfZ;f.YMS;f.oyv;f.aUb;f.SdD;f.JUv;var oi=f.jEj;f.TFq;f.HDU;f.R_y;f.ydN;f.t50;f.s$$;var xt=f.v2G,jt=f.Ilk;f.s9i;f.dxL;f.LLX;f.wA2;f.R_p;f.IQ$;f.I5F;f.X8$;f.FR6;f.U8o;f.kbG;f.iS_;f.cGG;f.RPN;f.skb;f.SLU;f.RdJ;f.cNu;f.gU7;f.LSk;f.Nmp;var co=f.d1Y;f.xrL;f.sRW;f.cmV;f.qWz;f.N0Q;f.q8b;f.ynB;f.jT9;f.wAz;var Ba=f.D4V;f.N6H;f.W1A;f.JHW;f.v2K;f.pBf;f.GMl;f.zW2;f.B0K;f.Nv7;f.C_p;f.iqw;f.MUA;f.xqU;f.pTp;f.vUK;f.j9l;var he=f.Zxw;f.Hdx;var le=f.Z$d;f.iqV;f.o$7;f.olM;f.Zm$;f.$QH;f.i78;f.h6u;f.hts;f.j88;f.VME;f.nt;f.Ukr;f.zsu;f.oA6;var Fa=f.TVh;f.TwZ;f.GTT;f.xxj;f.XdK;f.Jmb;var q=f.cXo;f.Dm5;var De=f.IIB;f.zI0;f.LYD;f.cEG;f.SEl;f.t9V;f.SKZ;var ke=f.__J;f.RI$;f.x12;f.ccz;var Ma=f.aNw;f.xwn;f.dNK;f.ini;f.YdH;f.y3G;f.l57;f.xn0;f.t2V;f.uxB;f.cpd;f.fiy;f.$XZ;f.uqK;f.STE;f.y$z;f.mAD;f.sOq;f.hUw;f._0G;f.Sqs;f.hpZ;f.Vol;var In=f.wIZ;f.cBi;f.RFv;f.kfC;f.mgq;f.YVA;f.Kgp;f.HH$;f.M_d;f.rgh;f.Ra6;f.KhR;f.BS5;f.xhz;f.xOq;f.a9j;f.bHk;f.CgK;f.cuY;f.kvE;f.SBu;f.AE_;f.ctO;f.OLH;f.kky;f.nSF;f.zHn;f.zwx;var ho=f.AeJ;f.hLz;f.D9g;f.wA;f.jhr;f.GVs;f._zO;f.w6$;f.mhV;var me=f.MOD;f.kwd;f.Lmr;var Ht=f.xsS;f.lLr;f.Z$r;var Da=f.IXb;f.SGH;f.SMj;f.L34;f.exe;var Bn=f.bnF;f.MFA;f.$uU;var uo=f.jyi;f.E03;f.V6q;f.rg2;f.DVW;f.nVo;f.F6N;f.xP7;f.Odq;f.Zif;f.ZGJ;f.MJk;var lo=f.xvT;f.PHM;f.dpR;f.n9L;f.KwO;var Ui=f.B7y;f.x7r;f.wx7;f.Uvn;f.OFT;f.xzN;f.M5Z;f.ZrN;var b=f.OWs;f.dF9;f.oZy;f.rD2;f.VHo;f.ohE;f.R$E;f.q3I;f.Pab;f.uZ5;f.McK;f.F9c;f.k0b;f.hnT;f.RSJ;f.Mku;f.h90;f.rms;f.ErP;f.aVg;f.lPc;f.Z8E;f._N2;f.yFn;f.lNv;f.cu9;f.MZQ;f.FUM;f.BxR;f.vdf;f.iaL;f.w6H;f.Q4c;f.Xxe;f.Uxb;f.Yr5;var ms=f.Bhw;f.yOA;const ka=""+new URL("background2-41c3e48e.png",import.meta.url).href,Ra=""+new URL("platform-a3b261ed.png",import.meta.url).href,La=""+new URL("spikes-c6e063dc.png",import.meta.url).href,za=""+new URL("bglvl2-3d50e8b4.png",import.meta.url).href,Ua=""+new URL("platformlvl2-5f17adab.png",import.meta.url).href,Oa=""+new URL("spikeslvl2-4caba059.png",import.meta.url).href,Ha=""+new URL("backgroundlvl3-f92c29b1.png",import.meta.url).href,Na=""+new URL("platformlvl3-9a4c5c72.png",import.meta.url).href,Wa=""+new URL("spikeslvl3-593a5438.png",import.meta.url).href,Ga=""+new URL("bee2-f5820ba4.png",import.meta.url).href,Va=""+new URL("sadBee-daa6d8fc.png",import.meta.url).href,Xa=""+new URL("sadBeeHit-3e5895ab.png",import.meta.url).href,Ya=""+new URL("madBee-a6e97e4b.png",import.meta.url).href,Za=""+new URL("happiestBee-f76f7303.png",import.meta.url).href,ja=""+new URL("characterHeart-1c4b18ac.png",import.meta.url).href,Qa=""+new URL("spoeder-be35be9c.png",import.meta.url).href,qa=""+new URL("deadspider-59bd584b.png",import.meta.url).href,$a=""+new URL("flower-3bb9e368.png",import.meta.url).href,Ka=""+new URL("portal-25c9fe6f.png",import.meta.url).href,Ja=""+new URL("closedPortal-08050a63.png",import.meta.url).href,th=""+new URL("startButton-aa8cb06f.png",import.meta.url).href,eh=""+new URL("tryAgain-8f81874d.png",import.meta.url).href,sh=""+new URL("nextLevelButton-594cb029.png",import.meta.url).href,ih=""+new URL("gameOverButton-ee2df8d4.png",import.meta.url).href,nh=""+new URL("bossSpider-a3464294.png",import.meta.url).href,rh=""+new URL("bossspiderhit-dab3ea45.png",import.meta.url).href,oh=""+new URL("honeyBomb-6c443b7c.png",import.meta.url).href,ah=""+new URL("bossWeb-8788da12.png",import.meta.url).href,hh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAABXCAIAAABqXM+IAAAABGdBTUEAALGPC/xhBQAACklpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/stRzjPAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAJcEhZcwAACxMAAAsTAQCanBgAAALPSURBVHic7dhBDcAgAMBAwMmQhH8xM7GGZLlT0Hfnc/YAAAAAAICvrdsBAAAAAAD8kwENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJAxoAAAAAAASBjQAAAAAAAkDGgAAAACAhAENAAAAAEDCgAYAAAAAIGFAAwAAAACQMKABAAAAAEgY0AAAAAAAJF7xDAFD502eFQAAAABJRU5ErkJggg==",lh=""+new URL("bossBackground-62845255.png",import.meta.url).href,ch=""+new URL("bossPlatform-d158795e.png",import.meta.url).href,dh=""+new URL("startendscene-e5b57312.png",import.meta.url).href,uh=""+new URL("cutscene1-96e8b820.png",import.meta.url).href,ph=""+new URL("cutscene2-78928782.png",import.meta.url).href,fh=""+new URL("cutscene3-e5c14903.png",import.meta.url).href,gh=""+new URL("cutsceneboss-84b23f63.png",import.meta.url).href,_h=""+new URL("bush-8484bef7.png",import.meta.url).href,mh=""+new URL("bossspiderded-299ec07f.png",import.meta.url).href,wh=""+new URL("textbee-706d2b88.png",import.meta.url).href,vh=""+new URL("textspider-4f4dd82d.png",import.meta.url).href,xh=""+new URL("CSstart1-b8a55550.png",import.meta.url).href,yh=""+new URL("CSstart2-e232f763.png",import.meta.url).href,bh=""+new URL("CSstart3-4b5ec7f1.png",import.meta.url).href,Ah=""+new URL("CSstart4-5c367ce7.png",import.meta.url).href,Ch=""+new URL("CSstart5-243444a8.png",import.meta.url).href,Sh=""+new URL("CSlevel1-92e17102.png",import.meta.url).href,Th=""+new URL("CSlevel2-a1383fe1.png",import.meta.url).href,Ph=""+new URL("CSthree1-db3ab8ce.png",import.meta.url).href,Eh=""+new URL("CSthree2-179b6ae0.png",import.meta.url).href,Ih=""+new URL("CSthree3-5017dc21.png",import.meta.url).href,Bh=""+new URL("CSthree4-9d8d97a5.png",import.meta.url).href,Fh=""+new URL("CSboss1-1af0dbdd.png",import.meta.url).href,Mh=""+new URL("CSboss2-4258a98b.png",import.meta.url).href,Dh=""+new URL("failvic1-a62a1244.png",import.meta.url).href,kh=""+new URL("failvic2-8a848ecb.png",import.meta.url).href,Rh=""+new URL("failvic3-048ef252.png",import.meta.url).href,Lh=""+new URL("failvicboss-fd8b5dbe.png",import.meta.url).href,zh=""+new URL("fail-b6037195.png",import.meta.url).href,Uh=""+new URL("victory-528e213f.png",import.meta.url).href,Oh=""+new URL("textBubble-2667b146.png",import.meta.url).href,E={Background:new q(ka),Platform:new q(Ra),Spikes:new q(La),BackgroundLvlTwo:new q(za),PlatformLvlTwo:new q(Ua),SpikesLvlTwo:new q(Oa),BackgroundLvlThree:new q(Ha),PlatformLvlThree:new q(Na),SpikesLvlThree:new q(Wa),Bee:new q(Ga),SadBee:new q(Va),SadBeeHit:new q(Xa),MadBee:new q(Ya),HappiestBee:new q(Za),BeeHeart:new q(ja),Spider:new q(Qa),DeadSpider:new q(qa),Flower:new q($a),Portal:new q(Ka),ClosedPortal:new q(Ja),StartBtn:new q(th),TryAgainBtn:new q(eh),NextLvlBtn:new q(sh),GameOverBtn:new q(ih),Boss:new q(nh),BossHit:new q(rh),HoneyBomb:new q(oh),BossWeb:new q(ah),TempBossFloor:new q(hh),BossBackground:new q(lh),BossPlatform:new q(ch),StartAndFinalSceneBg:new q(dh),CutsceneOneBg:new q(uh),CutsceneTwoBg:new q(ph),CutsceneThreeBg:new q(fh),CutsceneBossBg:new q(gh),Bush:new q(_h),DeadCutsceneSpider:new q(mh),BeeText:new q(wh),SpiderText:new q(vh),CsStartOne:new q(xh),CsStartTwo:new q(yh),CsStartThree:new q(bh),CsStartFour:new q(Ah),CsStartFive:new q(Ch),textFirstScene:new q(Sh),textSecondScene:new q(Th),CsThirdOne:new q(Ph),CsThirdTwo:new q(Eh),CsThirdThree:new q(Ih),CsThirdFour:new q(Bh),CsBossOne:new q(Fh),CsBossTwo:new q(Mh),FailVicOneBg:new q(Dh),FailVicTwoBg:new q(kh),FailVicThreeBg:new q(Rh),FailVicBossBg:new q(Lh),FailText:new q(zh),VictoryText:new q(Uh),TextBubble:new q(Oh)},Hh=new Ma([E.Background,E.Platform,E.Spikes,E.BackgroundLvlTwo,E.PlatformLvlTwo,E.SpikesLvlTwo,E.BackgroundLvlThree,E.PlatformLvlThree,E.SpikesLvlThree,E.Bee,E.SadBee,E.SadBeeHit,E.MadBee,E.HappiestBee,E.BeeHeart,E.Spider,E.DeadSpider,E.Flower,E.Portal,E.ClosedPortal,E.StartBtn,E.TryAgainBtn,E.NextLvlBtn,E.GameOverBtn,E.Boss,E.BossHit,E.HoneyBomb,E.BossWeb,E.TempBossFloor,E.BossBackground,E.BossPlatform,E.StartAndFinalSceneBg,E.CutsceneOneBg,E.CutsceneTwoBg,E.CutsceneThreeBg,E.CutsceneBossBg,E.Bush,E.DeadCutsceneSpider,E.BeeText,E.SpiderText,E.CsStartOne,E.CsStartTwo,E.CsStartThree,E.CsStartFour,E.CsStartFive,E.textFirstScene,E.textSecondScene,E.CsThirdOne,E.CsThirdTwo,E.CsThirdThree,E.CsThirdFour,E.CsBossOne,E.CsBossTwo,E.FailVicOneBg,E.FailVicTwoBg,E.FailVicThreeBg,E.FailVicBossBg,E.FailText,E.VictoryText,E.TextBubble]);class St extends J{constructor(_,a,d,p){super({pos:new b(_,a),width:d,height:p,anchor:b.Zero,collisionType:xt.Fixed,collisionGroup:oi.groupByName("platform")}),this.graphics.use(E.Platform.toSprite()),this.scale=new b(.3,.3)}}class Et extends J{constructor(_,a){super({pos:new b(_,a),width:925,height:155,anchor:new b(0,0),collisionType:xt.Fixed,collisionGroup:oi.groupByName("platform")});const d=E.PlatformLvlTwo.toSprite();d.width=925,d.height=155,this.graphics.add(d),this.scale=new b(.3,.3)}}class pt extends J{constructor(_,a,d,p){super({pos:new b(_,a),width:d,height:p,anchor:b.Zero,collisionType:xt.Fixed,collisionGroup:oi.groupByName("platform")}),this.graphics.use(E.PlatformLvlThree.toSprite()),this.scale=new b(.3,.3)}}class es extends J{constructor(_,a,d,p){super({pos:new b(_,a),width:140,height:265,anchor:b.Zero,collisionType:xt.Fixed,collisionGroup:oi.groupByName("portal")}),this.graphics.use(E.Portal.toSprite()),this.scale=new b(.8,.8)}}class Vs extends J{constructor(_,a){super({pos:new b(_,a),width:140,height:265,anchor:b.Zero,collisionType:xt.Fixed});const d=E.ClosedPortal.toSprite();d.width=140,d.height=265,this.graphics.add(d),this.scale=new b(.8,.8)}}const po=""+new URL("Bossdamage-e86ae3b3.mp3",import.meta.url).href,Oi=""+new URL("Damage-fe788e98.mp3",import.meta.url).href;class Mt extends J{constructor(a,d){super({width:90,height:75,pos:new b(a,d)});O(this,"x");O(this,"y");O(this,"speed");O(this,"health");const p=E.Spider.toSprite();p.width=120,p.height=100,this.graphics.add(p),this.speed=300}onInitialize(a){super.onInitialize(a),this.body.collisionType=xt.Fixed,this.on("precollision",d=>this.onPreCollision(d)),this.game=a}onPreKill(a){super.onPreKill(a);const d=new Nh;d.pos=this.pos.clone(),this.scene.add(d)}onPreCollision(a){const d=a.side,p=a.other;p instanceof ss&&(d==="Top"?(this.SpiderdamageSound=new Audio(po),this.SpiderdamageSound.play(100),console.log("character killed a spider"),this.kill()):(d==="Right"||d==="Left")&&(this.DamageSound=new Audio(Oi),this.DamageSound.play(),p.kill(),console.log("character walked into spider and died")))}}class Nh extends J{constructor(){super({width:100,height:80});const _=E.DeadSpider.toSprite();_.width=120,_.height=100,this.graphics.add(_)}onInitialize(_){super.onInitialize(_),this.body.collisionType=xt.Passive}onPostUpdate(_,a){super.onPostUpdate(_,a),this.rotation+=.08,this.rotation>=Math.PI&&(this.rotation=Math.PI,this.scale=this.scale.add(new b(-.04,-.04)),this.vel=new b(0,10)),this.width<=0&&this.kill()}}const fo=""+new URL("Jump-986781d3.mp4",import.meta.url).href;class ss extends J{constructor(a){const d=Bn.Circle(110,ms(5,25));super({collisionType:xt.Active,collider:d,displayMode:co.FitScreen});O(this,"health");O(this,"speed");O(this,"jumped",!1);O(this,"onGround",!0);O(this,"x");O(this,"flowers");this.graphics.use(E.Bee.toSprite()),this.health=200,this.speed=300,this.scale=new b(.4,.4),this.pos=new b(50,500),this.pointer.useGraphicsBounds=!0,this.enableCapturePointer=!0,this.body.gravity=!0,this.flowers=a}onInitialize(a){this.game=a,a.input.keyboard.enabled=!0;const d=De.Keys;a.input.keyboard.on("hold",p=>{p.key===d.A||p.key===d.Left?this.vel.x=-this.speed:(p.key===d.D||p.key===d.Right)&&(this.vel.x=this.speed)}),a.input.keyboard.on("release",p=>{(p.key===d.A||p.key===d.D||p.key===d.Left||p.key===d.Right)&&(this.vel.x=0)}),a.input.keyboard.on("press",p=>{(p.key===d.W||p.key===d.Up)&&this.onGround===!0&&(this.jumpSound=new Audio(fo),this.jumpSound.play(100),this.vel.y=-500,this.onGround=!1,this.jumped=!0,console.log("jump"))}),this.on("collisionstart",p=>this.onCollisionStart(p))}update(a){this.vel.x>0?this.vel.x-=10:this.vel.x<0&&(this.vel.x+=10),a.currentScene.camera.x=this.pos.x+80}onCollisionStart(a){a.other instanceof St&&(console.log("you're on the floor"),this.onGround=!0),a.other instanceof Et&&(console.log("you're on the floor"),this.onGround=!0),a.other instanceof pt&&(console.log("you're on the floor"),this.onGround=!0)}}class Wh extends J{constructor(_,a,d,p,w){super({pos:new b(_,a),width:d,height:p,anchor:b.Zero});const x=new uo(w);this.graphics.use(x)}}class Gh extends J{constructor(_,a){super({pos:new b(_,a),height:600,width:1e4,anchor:b.Zero});const d=E.BackgroundLvlTwo.toSprite();d.height=600,d.width=1e4,this.graphics.add(d)}}class Vh extends J{constructor(_,a){super({pos:new b(_,a),height:600,width:9101,anchor:b.Zero});const d=E.BackgroundLvlThree.toSprite();d.height=600,d.width=9101,this.graphics.add(d)}}class Fn extends J{onInitialize(_){super.onInitialize(_),this.body.collisionType=xt.Fixed,this.on("precollision",a=>this.onPreCollision(a))}onPreCollision(_){const a=_.other;a instanceof ss&&(this.DamageSound=new Audio(Oi),this.DamageSound.play(),a.kill())}}class _s extends Fn{constructor(_,a,d,p){super({pos:new b(_,a),width:3380,height:350,anchor:b.Zero}),this.graphics.use(E.Spikes.toSprite()),this.scale=new b(.138,.138)}}class _t extends Fn{constructor(_,a){super({pos:new b(_,a),width:270,height:46,anchor:new b(0,0)});const d=E.SpikesLvlTwo.toSprite();d.width=270,d.height=46,this.graphics.add(d)}}class we extends Fn{constructor(_,a,d,p){super({pos:new b(_,a),width:930,height:100,anchor:b.Zero}),this.graphics.use(E.SpikesLvlThree.toSprite()),this.scale=new b(.5,.5)}}const Xh=""+new URL("Coin-be71d170.mp4",import.meta.url).href;class gt extends J{constructor(a,d,p){super({pos:new b(a,d),width:2250,height:2130,anchor:b.Zero,collisionType:xt.Passive,collisionGroup:oi.groupByName("flower")});O(this,"score");this.graphics.use(E.Flower.toSprite()),this.scale=new b(.03,.03),this.score=p}onInitialize(){this.on("collisionstart",a=>this.onCollisionStart(a))}onCollisionStart(a){a.other instanceof ss&&(this.coinSound=new Audio(Xh),this.coinSound.play(100),this.score.incrementScore(),this.kill())}}const Mn=""+new URL("bee.-fc990637.mp3",import.meta.url).href;class Yh extends Ht{constructor(a){super({});O(this,"game");O(this,"health");O(this,"score");O(this,"character");O(this,"righttext");O(this,"lefttext");O(this,"jumptext");O(this,"bgMusic");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a,this.health=2,a.input.keyboard.enabled=!0;const d=De.Keys;a.input.keyboard.on("press",p=>{(p.key===d.D&&this.righttext!=!1||p.key===d.Right&&this.righttext!=!1)&&setTimeout(()=>{this.righttext.kill(),this.righttext=!1,console.log(this.righttext)},500)}),a.input.keyboard.on("press",p=>{(p.key===d.A&&this.righttext==!1&&this.lefttext!=!1||p.key===d.Left&&this.righttext==!1&&this.lefttext!=!1)&&setTimeout(()=>{this.lefttext.kill(),this.lefttext=!1,console.log(this.lefttext)},500)}),a.input.keyboard.on("press",p=>{(p.key===d.W&&this.lefttext==!1&&this.jumptext!=!1||p.key===d.Up&&this.lefttext==!1&&this.jumptext!=!1)&&setTimeout(()=>{this.jumptext.kill(),this.jumptext=!1,console.log(this.jumptext)},500)})}onActivate(a){this.score.deleteScore(),super.onActivate(a),this.bgMusic=new Audio(Mn),this.bgMusic.loop=!0,this.bgMusic.play(),this.startLevelOne()}startLevelOne(a){this.righttext=new ke({text:"Move right with right arrow or D",pos:new b(40,250),font:new he({size:40,color:jt.Black,unit:le.Px})}),this.lefttext=new ke({text:"Move left with left arrow or A",pos:new b(40,250),font:new he({size:40,color:jt.Black,unit:le.Px})}),this.jumptext=new ke({text:"Jump with up arrow or W",pos:new b(40,250),font:new he({size:40,color:jt.Black,unit:le.Px})}),this.actors.forEach(ct=>ct.kill());const d=E.Background.toSprite(),p=new Wh(-550,-50,100,20,d);p.scale=new b(.6,.63),this.add(p),this.add(this.righttext);let w=new J({pos:ms(-1,0),width:30,height:9e9,collisionType:xt.Fixed}),x=new J({pos:ms(8500,0),width:30,height:9e9,collisionType:xt.Fixed}),C=new J({pos:ms(0,600),width:1e4,height:10,collisionType:xt.Fixed});this.add(C),this.add(w),this.add(x);const B=new St(0,580,1e4,20,jt.Green);B.scale=new b(10.9,1),this.add(B);const I=new St(0,420,925,155);this.add(I);const R=new St(500,280,925,155);this.add(R);const H=new St(1e3,180,925,155);this.add(H);const L=new St(1500,280,925,155);this.add(L);const M=new St(1775,280,925,155);this.add(M);const W=new St(2100,480,925,155);this.add(W);const nt=new St(2500,430,925,155);this.add(nt);const K=new St(2900,380,925,155);this.add(K);const V=new St(3300,330,925,155);this.add(V);const tt=new St(3700,280,925,155);this.add(tt);const kt=new St(4100,230,925,155);this.add(kt);const v=new St(4500,180,925,155);this.add(v);const P=new St(4900,130,925,155);this.add(P);const mt=new St(5500,130,925,155);this.add(mt);const j=new St(5775,130,925,155);this.add(j);let Lt=new St(6500,130,925,155);Lt.actions.repeatForever(ct=>{ct.moveTo(6500,130,100),ct.moveTo(6500,540,100)}),this.add(Lt);let dt=new St(7100,130,925,155);this.add(dt);let D=new St(7375,130,925,155);this.add(D);let at=new St(7650,130,925,155);this.add(at);let et=new St(7100,330,925,155);this.add(et);let Z=new St(7375,330,925,155);this.add(Z);let At=new St(7650,330,925,155);this.add(At);const Xt=new _s(800,500);this.add(Xt);const It=new _s(2500,500);this.add(It);const Qt=new _s(2965,500);this.add(Qt);const We=new _s(3430,500);this.add(We);const Ge=new _s(3895,500);this.add(Ge);const Re=new _s(4360,500);this.add(Re);const Ve=new _s(4825,500);this.add(Ve);const Ct=new _s(6775,200);Ct.scale=new b(.084,.084),Ct.rotation=Math.PI,Ct.actions.repeatForever(ct=>{ct.moveTo(6775,200,100),ct.moveTo(6775,610,100)}),this.add(Ct);const wt=new gt(100,350,this.score);this.add(wt);const ws=new gt(4200,150,this.score);this.add(ws);const Le=new gt(5e3,50,this.score);this.add(Le);const ze=new gt(5550,50,this.score);this.add(ze);const ot=new gt(5650,50,this.score);this.add(ot);const Xe=new gt(5750,50,this.score);this.add(Xe);const Ue=new gt(5850,50,this.score);this.add(Ue);const xe=new gt(5950,50,this.score);this.add(xe);const Ye=new gt(7200,50,this.score);this.add(Ye);const Ze=new gt(7400,50,this.score);this.add(Ze);const ye=new gt(7600,50,this.score);this.add(ye);const be=new gt(7800,50,this.score);this.add(be);const Ae=new gt(7350,250,this.score);this.add(Ae);const Ce=new gt(7620,250,this.score);this.add(Ce);let Rt=new Mt;Rt.pos=new b(1100,130),Rt.actions.repeatForever(ct=>{ct.moveTo(1050,130,100),ct.moveTo(1230,130,100)}),this.add(Rt);let Yt=new Mt;Yt.pos=new b(1500,225),Yt.actions.repeatForever(ct=>{ct.moveTo(1550,225,100),ct.moveTo(2e3,225,100)}),this.add(Yt);let ce=new Mt;ce.pos=new b(4550,165),ce.actions.repeatForever(ct=>{ct.moveTo(4550,130,100),ct.moveTo(4720,130,100)}),this.add(ce);let de=new Mt;de.pos=new b(7100,530),de.actions.repeatForever(ct=>{ct.moveTo(7100,530,100),ct.moveTo(7200,530,100)}),this.add(de);let Se=new Mt;Se.pos=new b(7450,530),Se.actions.repeatForever(ct=>{ct.moveTo(7450,530,100),ct.moveTo(7600,530,100)}),this.add(Se);let ue=new Mt;ue.pos=new b(7900,530),ue.actions.repeatForever(ct=>{ct.moveTo(7900,530,200),ct.moveTo(8150,530,200)}),this.add(ue);let Oe=new Vs(8400,350);this.add(Oe),this.character=new ss(this.score),this.character.on("precollision",ct=>this.onPreCollision(ct)),this.add(this.character),this.scoreLabel=new ke({text:"Score: 0",font:new he({unit:le.Px,size:20,color:jt.Black})}),this.add(this.scoreLabel)}onPreCollision(a){a.other instanceof es&&(this.game.goToScene("VictoryOne"),this.bgMusic.pause())}onPreUpdate(){this.scoreLabel.text=`Score: ${this.score.getScore()}`,this.righttext==!1&&this.lefttext!=!1&&this.add(this.lefttext),this.lefttext==!1&&this.jumptext!=!1&&this.add(this.jumptext)}onPostUpdate(a,d){if(super.onPostUpdate(a,d),this.scoreLabel.pos=this.character.pos.clone().add(new b(this.character.width,-80)),this.actors.find(C=>C instanceof ss)||(this.game.goToScene("FailOne"),this.bgMusic.pause()),this.actors.filter(C=>C instanceof Mt).every(C=>C.isKilled())===!0){const C=this.actors.find(I=>I instanceof Vs);if(C&&C.kill(),!this.actors.find(I=>I instanceof es)){const I=new es(8400,350);this.add(I)}}}}class Hi extends J{constructor(_,a){super({width:_,height:a}),this.enableCapturePointer=!0,this.pointer.useGraphicsBounds=!0}}class Xs extends Hi{constructor(){super(200,120);const _=E.StartBtn.toSprite();_.width=200,_.height=120,this.graphics.add(_)}}class Zh extends Hi{constructor(){super(350,120);const _=E.GameOverBtn.toSprite();_.width=350,_.height=120,this.graphics.add(_)}}class Ws extends Hi{constructor(){super(350,120);const _=E.NextLvlBtn.toSprite();_.width=350,_.height=120,this.graphics.add(_)}}class Ni extends Hi{constructor(){super(350,200);const _=E.TryAgainBtn.toSprite();_.width=350,_.height=200,this.graphics.add(_)}}class go extends J{constructor(_,a){super({pos:new b(_,a),width:1519,height:600,anchor:b.Zero});const d=E.StartAndFinalSceneBg.toSprite();d.width=1519,d.height=600,this.graphics.add(d)}}class jh extends J{constructor(_,a){super({pos:new b(_,a),width:1875,height:600,anchor:b.Zero});const d=E.CutsceneOneBg.toSprite();d.width=1875,d.height=600,this.graphics.add(d)}}class Qh extends J{constructor(_,a){super({pos:new b(_,a),width:2059,height:600,anchor:b.Zero});const d=E.CutsceneTwoBg.toSprite();d.width=2059,d.height=600,this.graphics.add(d)}}class qh extends J{constructor(_,a){super({pos:new b(_,a),width:1726,height:600,anchor:b.Zero});const d=E.CutsceneThreeBg.toSprite();d.height=600,d.width=1726,this.graphics.add(d)}}class $h extends J{constructor(_,a){super({pos:new b(_,a),width:1726,height:600,anchor:b.Zero});const d=E.CutsceneBossBg.toSprite();this.graphics.add(d)}}class Kh extends Ht{constructor(){super();O(this,"game")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.startScene()}startScene(){this.actors.forEach(B=>B.kill());let a=new go(-100,0);this.add(a),console.log(a),console.log("startscherm");let d=new Xs;d.pos=new b(400,500),d.on("pointerup",()=>{this.game.goToScene("startCutscene")}),this.add(d);let p=new Zh;p.pos=new b(400,300),p.on("pointerup",()=>{this.game.goToScene("thirdCutScene")}),this.add(p);let w=new Ws;w.pos=new b(600,300),w.on("pointerup",()=>{this.game.goToScene("bossCutscene")}),this.add(w);let x=new Ws;x.pos=new b(600,150),x.on("pointerup",()=>{this.game.goToScene("firstCutscene")}),this.add(x);let C=new Ws;C.pos=new b(800,150),C.on("pointerup",()=>{this.game.goToScene("secondCutscene")}),this.add(C)}}class _o extends J{constructor(_,a){super({pos:new b(_,a),width:1700,height:600,anchor:b.Zero});const d=E.FailVicOneBg.toSprite();d.width=1700,d.height=600,this.graphics.add(d)}}class mo extends J{constructor(_,a){super({pos:new b(_,a),width:1410,height:600,anchor:b.Zero});const d=E.FailVicTwoBg.toSprite();d.width=1410,d.height=600,this.graphics.add(d)}}class wo extends J{constructor(_,a){super({pos:new b(_,a),width:2059,height:600,anchor:b.Zero});const d=E.FailVicThreeBg.toSprite();d.width=2059,d.height=600,this.graphics.add(d)}}class vo extends J{constructor(_,a){super({pos:new b(_,a),width:1726,height:600,anchor:b.Zero});const d=E.FailVicBossBg.toSprite();d.height=600,d.width=1726,this.graphics.add(d)}}class Wi extends J{constructor(_,a){super({pos:new b(_,a),width:400,height:168,anchor:new b(.5,.5)});const d=E.FailText.toSprite();d.width=400,d.height=168,this.graphics.add(d)}}class Gi extends J{constructor(_,a){super({pos:new b(_,a),width:400,height:168});const d=E.VictoryText.toSprite();d.width=400,d.height=168,this.graphics.add(d)}}const xo=""+new URL("Sad-74c721ea.mp4",import.meta.url).href;class Jh extends Ht{constructor(){super();O(this,"game")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.failMusic=new Audio(xo),this.failMusic.loop=!0,this.failMusic.play(),this.startFailOne()}startFailOne(){this.actors.forEach(w=>w.kill()),console.log("failOne");let a=new _o(-100,0);this.add(a);let d=new Wi(screen.width/2-100,150);this.add(d);let p=new Ni;p.pos=new b(670,450),p.on("pointerup",()=>{this.game.goToScene("LevelOne"),this.failMusic.pause()}),this.add(p)}onDeactivate(a){super.onDeactivate(a)}}const Dn=""+new URL("Victory-4adc19a4.mp4",import.meta.url).href;class tl extends Ht{constructor(a){super();O(this,"game");O(this,"score");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.victoryMusic=new Audio(Dn),this.victoryMusic.loop=!0,this.victoryMusic.play(),this.startVictoryOne()}startVictoryOne(){this.actors.forEach(x=>x.kill()),console.log("victory one");let a=new _o(-100,0);this.add(a),console.log(a);let d=new Gi(screen.width/2-100,150);this.add(d);let p=new ke({text:`Score: ${this.score}`,pos:new b(500,400),font:new he({family:"impact",size:35,unit:le.Px,color:jt.White})});this.add(p);let w=new Ws;w.pos=new b(650,500),w.on("pointerup",()=>{this.game.goToScene("startScene"),this.victoryMusic.pause()}),this.add(w)}}class el extends Ht{constructor(a){super({width:854,height:600});O(this,"game");O(this,"score");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){this.score.deleteScore(),super.onActivate(a),this.bgMusic=new Audio(Mn),this.bgMusic.loop=!0,this.bgMusic.play(),this.startLevelTwo()}startLevelTwo(){this.actors.forEach(N=>N.kill()),console.log("level two");const a=new Gh(-550,0);this.add(a);let d=new J({pos:new b(-1,0),width:30,height:9e9,collisionType:xt.Fixed}),p=new J({pos:new b(8640,0),width:30,height:9e9,collisionType:xt.Fixed});this.add(d),this.add(p);const w=new Et(-550,580,1e4,20,jt.Green);w.scale=new b(10.9,1),this.add(w);const x=new _t(475,200);x.rotation=Math.PI,x.actions.repeatForever(N=>{N.moveTo(475,200,120),N.moveTo(475,580,120)}),this.add(x);const C=new Et(200,130);C.actions.repeatForever(N=>{N.moveTo(200,130,120),N.moveTo(200,510,120)}),this.add(C);const B=new ss(this.score);this.add(B),B.on("precollision",N=>this.onPreCollision(N));const I=new gt(340,520,this.score);this.add(I);const R=new gt(240,520,this.score);this.add(R);const H=new _t(480,550);this.add(H);const L=new _t(750,550);this.add(L);const M=new _t(1020,550);this.add(M);const W=new _t(1290,550);this.add(W);const nt=new _t(1560,550);this.add(nt);const K=new _t(1830,550);this.add(K);const V=new _t(2100,550);this.add(V);const tt=new _t(2370,550);this.add(tt);const kt=new _t(2640,550);this.add(kt);const v=new _t(2910,550);this.add(v);const P=new _t(3180,550);this.add(P);const mt=new _t(3450,550);this.add(mt);const j=new _t(3720,550);this.add(j);const Lt=new _t(3990,550);this.add(Lt);const dt=new _t(4260,550);this.add(dt);const D=new _t(4530,550);this.add(D);const at=new _t(4800,550);this.add(at);const et=new _t(5070,550);this.add(et);const Z=new _t(5340,550);this.add(Z);const At=new _t(5610,550);this.add(At);const Xt=new _t(5880,550);this.add(Xt);const It=new _t(6150,550);this.add(It);const Qt=new _t(6420,550);this.add(Qt);const We=new _t(6690,550);this.add(We);const Ge=new _t(6960,550);this.add(Ge);const Re=new _t(7230,550);this.add(Re);const Ve=new _t(7500,550);this.add(Ve);const Ct=new _t(7770,550);this.add(Ct);const wt=new _t(8040,550);this.add(wt);const ws=new Et(600,400);this.add(ws);const Le=new Mt(640,360);Le.actions.repeatForever(N=>{N.moveTo(640,360,100),N.moveTo(840,360,100)}),this.add(Le);const ze=new Et(700,200);this.add(ze);const ot=new Mt(740,160);ot.actions.repeatForever(N=>{N.moveTo(740,160,120),N.moveTo(940,160,120)}),this.add(ot);const Xe=new Et(1050,450);this.add(Xe);const Ue=new Mt(1090,410);Ue.actions.repeatForever(N=>{N.moveTo(1090,410,150),N.moveTo(1290,410,150)}),this.add(Ue);const xe=new Et(1500,400);this.add(xe);const Ye=new gt(1520,340,this.score);this.add(Ye);const Ze=new gt(1600,340,this.score);this.add(Ze);const ye=new gt(1680,340,this.score);this.add(ye);const be=new Et(1050,200);this.add(be);const Ae=new Et(1400,200);this.add(Ae);const Ce=new Et(1900,200);Ce.actions.repeatForever(N=>{N.moveTo(1800,200,170),N.moveTo(2900,200,170)}),this.add(Ce);const Rt=new Et(2400,350);this.add(Rt);const Yt=new Mt(2440,310);Yt.actions.repeatForever(N=>{N.moveTo(2440,310,100),N.moveTo(2640,310,100)}),this.add(Yt);const ce=new Et(2900,350);this.add(ce);const de=new Mt(2940,310);de.actions.repeatForever(N=>{N.moveTo(2940,310,100),N.moveTo(3140,310,100)}),this.add(de);const Se=new Et(2100,50);this.add(Se);const ue=new gt(2170,-10,this.score);this.add(ue);const Oe=new Et(3100,50);this.add(Oe);const ct=new gt(3200,-10,this.score);this.add(ct);const is=new Et(3500,400);this.add(is);const ns=new Et(3900,400);this.add(ns);const ie=new Et(4200,450);ie.actions.repeatForever(N=>{N.moveTo(4200,450,150),N.moveTo(5e3,450,150)}),this.add(ie);const pe=new Et(5300,200);pe.actions.repeatForever(N=>{N.moveTo(5300,100,130),N.moveTo(5300,500,130)}),this.add(pe);const je=new Et(5500,200);je.actions.repeatForever(N=>{N.moveTo(5500,200,180),N.moveTo(6500,200,180)}),this.add(je);const rs=new Et(6900,400);this.add(rs);const os=new Et(7400,300);this.add(os);const as=new Et(7800,200);this.add(as);const Te=new Et(8100,200);this.add(Te),this.scoreLabel=new ke({text:"Score: 0",font:new he({unit:le.Px,size:20,color:jt.Black})}),this.add(this.scoreLabel);const Qe=new Vs(8500,350);this.add(Qe)}onPreCollision(a){a.other instanceof es&&(this.game.goToScene("VictoryTwo"),this.bgMusic.pause())}onPreUpdate(){this.scoreLabel.text=`Score: ${this.score.getScore()}`}onPostUpdate(a,d){if(super.onPostUpdate(a,d),this.actors.filter(C=>C instanceof Mt).every(C=>C.isKilled())===!0){const C=this.actors.find(I=>I instanceof Vs);if(C&&C.kill(),!this.actors.find(I=>I instanceof es)){const I=new es(8500,350);this.add(I)}}this.actors.find(C=>C instanceof ss)||(this.game.goToScene("FailTwo"),this.bgMusic.pause())}onDeactivate(a){super.onDeactivate(a)}}const yo=""+new URL("Sad-74c721ea.mp4",import.meta.url).href;class sl extends Ht{constructor(){super();O(this,"game")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.failMusic=new Audio(yo),this.failMusic.loop=!0,this.failMusic.play(),this.startFailTwo()}startFailTwo(){this.actors.forEach(w=>w.kill());let a=new mo(0,0);this.add(a);let d=new Wi(screen.width/2-100,150);this.add(d),console.log("fail two");let p=new Ni;p.pos=new b(670,450),p.on("pointerup",()=>{this.game.goToScene("LevelTwo"),this.failMusic.pause()}),this.add(p)}}class il extends Ht{constructor(a){super();O(this,"game");O(this,"score");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.victoryMusic=new Audio(Dn),this.victoryMusic.loop=!0,this.victoryMusic.play(),this.startVictoryTwo()}startVictoryTwo(){this.actors.forEach(x=>x.kill()),console.log("victory one");let a=new mo(0,0);this.add(a);let d=new Gi(screen.width/2-100,150);this.add(d);let p=new ke({text:`Score: ${this.score}`,pos:new b(500,400),font:new he({family:"impact",size:35,unit:le.Px,color:jt.White})});this.add(p);let w=new Ws;w.pos=new b(650,500),w.on("pointerup",()=>{this.game.goToScene("secondCutscene"),this.victoryMusic.pause()}),this.add(w)}}class nl extends Ht{constructor(a){super({});O(this,"game");O(this,"health");O(this,"score");O(this,"character");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a,this.health=2}onActivate(a){this.score.deleteScore(),super.onActivate(a),this.bgMusic=new Audio(Mn),this.bgMusic.loop=!0,this.bgMusic.play(),this.startLevelThree()}startLevelThree(){this.actors.forEach(N=>N.kill());const a=E.BackgroundLvlThree.toSprite(),d=new Vh(-550,0,200,20,a);this.add(d);let p=new J({pos:ms(-1,0),width:30,height:9e9,collisionType:xt.Fixed}),w=new J({pos:ms(8500,0),width:30,height:9e9,collisionType:xt.Fixed}),x=new J({pos:ms(0,600),width:1e4,height:10,collisionType:xt.Fixed});this.add(x),this.add(p),this.add(w);const C=new pt(0,580,1e4,20,jt.Green);C.scale=new b(10.9,1),this.add(C);const B=new pt(0,200,925,155);this.add(B);let I=new Mt;I.pos=new b(100,150),I.actions.repeatForever(N=>{N.moveTo(50,150,100),N.moveTo(230,150,100)}),this.add(I);const R=new pt(200,400,925,155);this.add(R);const H=new gt(300,330,this.score);this.add(H);const L=new gt(300,510,this.score);this.add(L);const M=new pt(400,200,925,155);this.add(M);let W=new Mt;W.pos=new b(500,150),W.actions.repeatForever(N=>{N.moveTo(450,150,100),N.moveTo(630,150,100)}),this.add(W);const nt=new we(800,500);this.add(nt);const K=new pt(1e3,250,925,155);this.add(K);let V=new Mt;V.pos=new b(1100,200),V.actions.repeatForever(N=>{N.moveTo(1050,200,100),N.moveTo(1230,200,100)}),this.add(V);const tt=new we(1265,500);this.add(tt);const kt=new pt(1600,300,925,155);this.add(kt);const v=new we(1730,500);this.add(v);const P=new pt(2200,350,925,155);this.add(P);let mt=new Mt;mt.pos=new b(2300,300),mt.actions.repeatForever(N=>{N.moveTo(2250,300,100),N.moveTo(2430,300,100)}),this.add(mt);const j=new we(2195,500);this.add(j);const Lt=new pt(2800,350,925,155);this.add(Lt);const dt=new gt(2900,280,this.score);this.add(dt);const D=new pt(3e3,200,925,155);this.add(D);let at=new Mt;at.pos=new b(3100,150),at.actions.repeatForever(N=>{N.moveTo(3050,150,100),N.moveTo(3230,150,100)}),this.add(at);const et=new pt(3200,50,925,155);this.add(et);const Z=new gt(3300,-20,this.score);this.add(Z);const At=new we(3200,500);this.add(At);const Xt=new we(3665,500);this.add(Xt);const It=new pt(3800,350,925,155);It.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(It);const Qt=new gt(3760,280,this.score);this.add(Qt);const We=new we(4130,500);this.add(We);const Ge=new pt(4130,350,925,155);Ge.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(Ge);const Re=new pt(4300,350,925,155);Re.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(Re);const Ve=new we(4595,500);this.add(Ve);const Ct=new pt(4650,350,925,155);Ct.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(Ct);const wt=new pt(4850,400,925,155);wt.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(wt);const ws=new pt(5400,450,925,155);this.add(ws);const Le=new pt(5400,500,925,155);Le.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(Le);const ze=new gt(5490,510,this.score);this.add(ze);const ot=new gt(5560,510,this.score);this.add(ot);const Xe=new pt(5550,400,925,155);this.add(Xe);const Ue=new pt(5700,350,925,155);this.add(Ue);let xe=new Mt;xe.pos=new b(5775,530),xe.actions.repeatForever(N=>{N.moveTo(5725,530,100),N.moveTo(5955,530,100)}),this.add(xe);const Ye=new pt(5850,300,925,155);this.add(Ye);const Ze=new pt(6e3,250,925,155);this.add(Ze);const ye=new pt(6150,200,925,155);this.add(ye);const be=new pt(6300,150,925,155);this.add(be);let Ae=new Mt;Ae.pos=new b(6400,100),Ae.actions.repeatForever(N=>{N.moveTo(6350,100,100),N.moveTo(6530,100,100)}),this.add(Ae);let Ce=new pt(6300,120,925,155);Ce.actions.repeatForever(N=>{N.moveTo(6300,120,70),N.moveTo(6300,530,70)}),this.add(Ce);const Rt=new we(6550,200,925,155);Rt.scale=new b(.25,.25),Rt.rotation=Math.PI,Rt.actions.repeatForever(N=>{N.moveTo(6550,200,70),N.moveTo(6550,610,70)}),this.add(Rt);const Yt=new we(6800,500);this.add(Yt);const ce=new pt(6800,450,925,155);ce.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(ce);const de=new gt(6755,280,this.score);this.add(de);const Se=new we(7265,500);this.add(Se);const ue=new pt(7100,450,925,155);ue.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(ue);const Oe=new pt(7300,400,925,155);Oe.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(Oe);const ct=new we(7730,500);this.add(ct);const is=new pt(7550,350,925,155);is.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(is);const ns=new pt(7800,400,925,155);ns.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(ns);const ie=new pt(7800,400,925,155);ie.actions.rotateBy(Math.PI/2,Math.PI,me.CounterClockwise),this.add(ie);const pe=new pt(8e3,450,925,155);this.add(pe);const je=new gt(8050,380,this.score);this.add(je);const rs=new pt(8030,300,925,155);this.add(rs);const os=new gt(8080,230,this.score);this.add(os);const as=new pt(8060,150,925,155);this.add(as);let Te=new Mt;Te.pos=new b(8160,100),Te.actions.repeatForever(N=>{N.moveTo(8110,100,100),N.moveTo(8290,100,100)}),this.add(Te);let Qe=new Vs(8300,350);this.add(Qe),this.character=new ss(this.score),this.character.on("precollision",N=>this.onPreCollision(N)),this.add(this.character),this.scoreLabel=new ke({text:"Score: 0",font:new he({unit:le.Px,size:20,color:jt.Black})}),this.add(this.scoreLabel)}onPreCollision(a){a.other instanceof es&&(this.game.goToScene("VictoryThree"),this.bgMusic.pause())}onPreUpdate(){this.scoreLabel.text=`Score: ${this.score.getScore()}`}onPostUpdate(a,d){if(super.onPostUpdate(a,d),this.scoreLabel.pos=this.character.pos.clone().add(new b(this.character.width,-80)),this.actors.find(C=>C instanceof ss)||(this.game.goToScene("FailThree"),this.bgMusic.pause()),this.actors.filter(C=>C instanceof Mt).every(C=>C.isKilled())===!0){const C=this.actors.find(I=>I instanceof Vs);if(C&&C.kill(),!this.actors.find(I=>I instanceof es)){const I=new es(8300,350);this.add(I)}}}}class rl extends Ht{constructor(){super();O(this,"game")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.failMusic=new Audio(yo),this.failMusic.loop=!0,this.failMusic.play(),this.startFailThree()}startFailThree(){this.actors.forEach(w=>w.kill());let a=new wo(0,0);this.add(a);let d=new Wi(screen.width/2-100,150);this.add(d),console.log("fail two");let p=new Ni;p.pos=new b(670,450),p.on("pointerup",()=>{this.game.goToScene("LevelThree"),this.failMusic.pause()}),this.add(p)}}class ol extends Ht{constructor(a){super();O(this,"game");O(this,"score");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.victoryMusic=new Audio(Dn),this.victoryMusic.loop=!0,this.victoryMusic.play(),this.startVictoryTwo()}startVictoryTwo(){this.actors.forEach(x=>x.kill()),console.log("victory one");let a=new wo(0,0);this.add(a);let d=new Gi(screen.width/2-100,150);this.add(d);let p=new ke({text:`Score: ${this.score}`,pos:new b(500,400),font:new he({family:"impact",size:35,unit:le.Px,color:jt.White})});this.add(p);let w=new Ws;w.pos=new b(650,500),w.on("pointerup",()=>{this.game.goToScene("secondCutscene"),this.victoryMusic.pause()}),this.add(w)}}class kn extends J{constructor(_,a){super({pos:new b(_,a),anchor:b.Zero}),this.graphics.use(E.MadBee.toSprite()),this.scale=new b(.4,.4)}}class Vi extends J{constructor(_,a){super({pos:new b(_,a),anchor:b.Zero}),this.graphics.use(E.HappiestBee.toSprite()),this.scale=new b(.4,.4)}}class Gs extends J{constructor(_,a){super({pos:new b(_,a),anchor:b.Zero}),this.graphics.use(E.Bee.toSprite()),this.scale=new b(.2,.2)}}class bo extends J{constructor(_,a){super({pos:new b(_,a),anchor:b.Zero}),this.graphics.use(E.Boss.toSprite()),this.scale=new b(1.3,1.3)}}class al extends J{constructor(_,a){super({pos:new b(_,a),anchor:b.Zero}),this.graphics.use(E.DeadCutsceneSpider.toSprite()),this.scale=new b(1.3,1.3)}}class ve extends J{constructor(_){super({pos:new b(650,450),width:800,height:201,anchor:new b(.5,.5)});const a=new uo(_);a.width=800,a.height=201,this.graphics.use(a)}}class hl extends Ht{constructor(){super();O(this,"game");O(this,"texts")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.startFirstCutScene()}startFirstCutScene(){let a=new Qh(-50,0);this.add(a),console.log(a);const d=new Vi;d.pos=new b(300,100),this.add(d),this.texts=[new ve(E.textFirstScene.toSprite())],this.currentTextIndex=0,this.add(this.texts[this.currentTextIndex]);const p=De.Keys;this.game.input.keyboard.on("press",w=>{w.key===p.Space&&this.changeElements()})}changeElements(){if(this.currentTextIndex<this.texts.length-1)this.texts[this.currentTextIndex].kill(),this.currentTextIndex++,this.add(this.texts[this.currentTextIndex]);else if(this.currentTextIndex===this.texts.length-1){this.texts[this.currentTextIndex].kill(),this.currentTextIndex++;let a=new Xs;a.pos=new b(screen.width/2-100,500),a.on("pointerup",()=>{this.game.goToScene("LevelTwo")}),this.add(a)}}}class ll extends Ht{constructor(){super();O(this,"game");O(this,"texts");O(this,"beeHappy");O(this,"beeMad");O(this,"beeBabyOne");O(this,"beeBabyTwo");O(this,"beeBabyThree");O(this,"spider")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.startCutScene()}startCutScene(){console.log("cutscene start"),this.actors.forEach(p=>p.kill());let a=new jh(-100,0);this.add(a),this.texts=[new ve(E.CsStartOne.toSprite()),new ve(E.CsStartTwo.toSprite()),new ve(E.CsStartThree.toSprite()),new ve(E.CsStartFour.toSprite()),new ve(E.CsStartFive.toSprite())],this.currentTextIndex=0,this.add(this.texts[this.currentTextIndex]);const d=De.Keys;this.game.input.keyboard.on("press",p=>{p.key===d.Space&&this.changeElements()}),this.beeHappy=new Vi(200,200),this.add(this.beeHappy),this.beeBabyOne=new Gs(150,200),this.add(this.beeBabyOne),this.beeBabyTwo=new Gs(170,130),this.add(this.beeBabyTwo),this.beeBabyThree=new Gs(220,120),this.add(this.beeBabyThree)}changeElements(){if(this.currentTextIndex<this.texts.length-1)this.texts[this.currentTextIndex].kill(),this.currentTextIndex++,this.add(this.texts[this.currentTextIndex]);else if(this.currentTextIndex===this.texts.length-1){this.texts[this.currentTextIndex].kill(),this.currentTextIndex++;let a=new Xs;a.pos=new b(screen.width/2-100,500),a.on("pointerup",()=>{this.game.goToScene("LevelOne")}),this.add(a)}this.currentTextIndex===1?(this.beeHappy.kill(),this.beeMad=new kn(200,200),this.add(this.beeMad),this.spider=new bo(1e3,300),this.spider.actions.moveTo(850,300,200),this.add(this.spider)):this.currentTextIndex===2?this.spider.actions.moveTo(1300,300,200):this.currentTextIndex===3?(this.beeMad.actions.moveTo(600,200,400),this.beeBabyOne.actions.moveTo(-100,170,200),this.beeBabyTwo.actions.moveTo(-100,100,200),this.beeBabyThree.actions.moveTo(-100,90,200)):this.currentTextIndex===5&&this.beeMad.actions.moveTo(1300,1e3,400)}}class cl extends Ht{constructor(){super();O(this,"game");O(this,"texts")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.startSecondCutScene()}startSecondCutScene(){console.log("cutscene 2nd");let a=new qh(-50,0);this.add(a),console.log(a);const d=new kn;d.pos=new b(300,100),d.flipHorizontal=!0,this.add(d),this.texts=[new ve(E.textSecondScene.toSprite())],this.currentTextIndex=0,this.add(this.texts[this.currentTextIndex]);const p=De.Keys;this.game.input.keyboard.on("press",w=>{w.key===p.Space&&this.changeElements()})}changeElements(){if(this.currentTextIndex<this.texts.length-1)this.texts[this.currentTextIndex].kill(),this.currentTextIndex++,this.add(this.texts[this.currentTextIndex]);else if(this.currentTextIndex===this.texts.length-1){this.texts[this.currentTextIndex].kill(),this.currentTextIndex++;let a=new Xs;a.pos=new b(screen.width/2-100,500),a.on("pointerup",()=>{this.game.goToScene("LevelThree")}),this.add(a)}}}class dl extends Ht{constructor(){super();O(this,"game");O(this,"texts");O(this,"beeHappy");O(this,"beeMad");O(this,"spider")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.startSecondCutScene()}startSecondCutScene(){console.log("cutscene 3rd");let a=new $h(-100,0);this.add(a),console.log(a),this.texts=[new ve(E.CsThirdOne.toSprite()),new ve(E.CsThirdTwo.toSprite()),new ve(E.CsThirdThree.toSprite())],this.currentTextIndex=0,this.add(this.texts[this.currentTextIndex]);const d=De.Keys;this.game.input.keyboard.on("press",p=>{p.key===d.Space&&this.changeElements()}),this.beeHappy=new Vi(200,200),this.add(this.beeHappy)}changeElements(){if(this.currentTextIndex<this.texts.length-1)this.texts[this.currentTextIndex].kill(),this.currentTextIndex++,this.add(this.texts[this.currentTextIndex]);else if(this.currentTextIndex===this.texts.length-1){this.texts[this.currentTextIndex].kill(),this.currentTextIndex++;let a=new Xs;a.pos=new b(screen.width/2-100,500),a.on("pointerup",()=>{this.game.goToScene("bossFight")}),this.add(a)}this.currentTextIndex===1?(this.beeHappy.kill(),this.beeMad=new kn(200,200),this.add(this.beeMad),this.spider=new bo(1e3,300),this.spider.actions.moveTo(850,300,200),this.add(this.spider)):this.currentTextIndex===2&&this.spider.actions.moveTo(1400,300,200)}}class Xi extends J{constructor(){super({width:E.TempBossFloor.width,height:E.TempBossFloor.height})}onInitialize(){this.graphics.add(E.TempBossFloor.toSprite()),this.body.collisionType=xt.Fixed}}const ul=""+new URL("Bossattack-63356a69.mp3",import.meta.url).href,pl=""+new URL("Miss-4fa6d0f2.mp4",import.meta.url).href;class Ao extends J{constructor(){super({width:90,height:90})}onInitialize(_){this.game=_,this.body.useGravity=!1,this.graphics.use(E.BossWeb.toSprite()),this.BossattackSound=new Audio(ul),this.BossattackSound.play(),this.on("collisionstart",a=>this.spiderWeb(a))}spiderWeb(_){_.other instanceof Rn&&(_.other.takeDamage(50),this.kill(),this.DamageSound=new Audio(Oi),this.DamageSound.play()),_.other instanceof Xi&&(this.kill(),this.MissSound=new Audio(pl),this.MissSound.play())}}const fl=""+new URL("Destroyspiderweb-9ec4d410.mp3",import.meta.url).href;class gl extends J{constructor(_,a){const d=Bn.Circle(50);super({x:_+Math.random()*50,y:a+Math.random()*50,collider:d})}onInitialize(_){this.game=_,this.body.collisionType=xt.Active,this.body.useGravity=!0,this.vel=new b(400,-400),this.rotation=Math.random()*10,this.graphics.use(E.HoneyBomb.toSprite()),this.scale=new b(.5,.5),this.on("collisionstart",a=>this.bomb(a))}bomb(_){_.other instanceof So&&(_.other.hitBoss(30),this.kill(),this.BossdamageSound=new Audio(po),this.BossdamageSound.play()),_.other instanceof Xi&&this.kill(),_.other instanceof Ao&&(this.kill(),_.other.kill(),this.DestroyspiderwebSound=new Audio(fl),this.DestroyspiderwebSound.play())}}class Co extends J{constructor(){super({width:E.BossPlatform.width,height:E.BossPlatform.height})}onInitialize(){this.graphics.add(E.BossPlatform.toSprite()),this.scale=new b(.25,.25),this.body.collisionType=xt.Fixed}}const _l=""+new URL("Attack-7610102d.mp3",import.meta.url).href;class Rn extends J{constructor(){const a=Bn.Circle(105,new b(6,27.5));super({height:100,width:100,collider:a});O(this,"health",300);O(this,"damage");O(this,"grounded");O(this,"timer");O(this,"attackTimer");O(this,"mayAttack");this.timer=new Ui({fcn:()=>this.graphics.use("HappyBee"),repeats:!1,interval:700}),this.attackTimer=new Ui({fcn:()=>this.mayAttack=!0,repeats:!1,interval:800})}onActivate(a){this.MaincharacterBoss.pos=new b(10,500),this.MaincharacterBoss.reset()}onInitialize(a){this.game=a,this.body.useGravity=!0,this.body.collisionType=xt.Active,this.graphics.add("HappyBee",E.Bee.toSprite()),this.graphics.add("MadBee",E.MadBee.toSprite()),this.graphics.add("SadBee",E.SadBeeHit.toSprite()),this.scale=new b(.5,.5),this.graphics.use("HappyBee"),this.mayAttack=!0,this.on("collisionstart",d=>{this.isGrounded(d)}),this.game.currentScene.add(this.timer),this.game.currentScene.add(this.attackTimer)}reset(){this.graphics.use("HappyBee"),this.health=300}isGrounded(a){a.other instanceof Xi&&(console.log("you're on the floor"),this.grounded=!0),a.other instanceof Co&&(console.log("you're on a platform"),this.grounded=!0)}onPreUpdate(a){let d=0,p=0;a.input.keyboard.isHeld(De.Keys.D)&&(d=240),a.input.keyboard.isHeld(De.Keys.A)&&(d=-240),this.grounded&&a.input.keyboard.wasPressed(De.Keys.W)&&(this.jumpSound=new Audio(fo),this.jumpSound.play(100),p=-650,this.grounded=!1),this.mayAttack&&a.input.keyboard.wasPressed(De.Keys.L)&&(this.CharacterattackSound=new Audio(_l),this.CharacterattackSound.play(),this.honeyBomb(),this.graphics.use("MadBee"),this.timer.start(),this.mayAttack=!1,this.attackTimer.start()),this.vel=new b(d,this.vel.y+p)}takeDamage(a){console.log("I take damage "+a),this.health-=a,this.graphics.use("SadBee"),this.timer.start(),this.health<251&&this.scene.hearts(5),this.health<201&&this.scene.hearts(4),this.health<151&&this.scene.hearts(3),this.health<101&&this.scene.hearts(2),this.health<51&&this.scene.hearts(1),this.health<1&&(console.log("oopsies, dead"),this.game.goToScene("bossFail"))}honeyBomb(){const a=new gl;a.pos=this.pos.clone(),this.scene.add(a)}}class So extends J{constructor(){super({width:200,height:200});O(this,"health",300);O(this,"timer");O(this,"spriteTimer");this.timer=new Ui({fcn:()=>this.webShot(),repeats:!0,interval:4e3}),this.spriteTimer=new Ui({fcn:()=>this.graphics.use("Boss"),repeats:!1,interval:300})}onActivate(a){this.bossReset.bossReset()}onInitialize(a){this.game=a,this.body.collisionType=xt.Fixed,this.graphics.add("Boss",E.Boss.toSprite()),this.graphics.add("BossHit",E.BossHit.toSprite()),this.scale=new b(1.3,1.3),this.graphics.use("Boss"),this.actions.repeatForever(d=>{d.moveBy(-100,0,50),d.moveBy(100,0,50)}),this.game.currentScene.add(this.spriteTimer),this.game.currentScene.add(this.timer),this.timer.start(),this.on("collisionstart",d=>{this.doDamage(d)})}bossReset(){this.health=300}doDamage(a){a.other instanceof Rn&&(console.log("ouch!"),a.other.takeDamage(50),this.DamageSound=new Audio(Oi),this.DamageSound.play())}hitBoss(a){this.health-=a,this.scene.updateBossHealth(this.health),this.graphics.use("BossHit"),this.spriteTimer.start(),this.health<1&&(this.timer.stop(),this.kill(),this.game.goToScene("bossCutscene"),console.log("Victory for you, whoo hoo"))}webShot(){const a=new Ao;a.pos=this.pos.clone(),this.scene.addWebShot(a)}}class ml extends J{constructor(){super()}onInitialize(){this.graphics.add(E.BossBackground.toSprite()),this.body.collisionType=xt.Fixed,this.scale=new b(.4,.4)}}class wl extends Da{constructor(){super({x:10,y:10});O(this,"healthbar");O(this,"group");this.healthbar=new ho({width:300,height:40,color:jt.Red}),this.border=new ho({width:300,height:40,color:jt.fromRGB(255,255,255,.4)})}onInitialize(a){this.levelText=new lo({text:"Final boss",font:new he({unit:le.Px,family:"Arial",size:40})}),this.scoreText=new lo({text:"points:",font:new he({unit:le.Px,family:"Arial",size:30})}),this.group=new Fa({members:[{graphic:this.levelText,pos:new b(10,5)},{graphic:this.scoreText,pos:new b(10,30)},{graphic:this.border,pos:new b(800,200)},{graphic:this.healthbar,pos:new b(800,200)},{graphic:E.BeeHeart.toSprite(),pos:new b(10,50),scale:new b(.1,.1)},{graphic:E.BeeHeart.toSprite(),pos:new b(71,50),scale:new b(.1,.1)},{graphic:E.BeeHeart.toSprite(),pos:new b(133,50),scale:new b(.1,.1)},{graphic:E.BeeHeart.toSprite(),pos:new b(194,50),scale:new b(.1,.1)},{graphic:E.BeeHeart.toSprite(),pos:new b(255,50),scale:new b(.1,.1)},{graphic:E.BeeHeart.toSprite(),pos:new b(316,50),scale:new b(.1,.1)}]}),this.graphics.use(this.group)}resetHealth(){this.healthbar.width=300}bossDamaged(a){this.healthbar.width=a,this.healthbar.width<=0&&console.log("congrasjulashions")}updateHealth(a){console.log(a),a===5&&this.group.members.pop()}}const vl=""+new URL("boss-42c10bbf.mp3",import.meta.url).href;class xl extends Ht{constructor(){super({width:854,height:600});O(this,"character");O(this,"boss");O(this,"damage");In.useRealisticPhysics(),In.gravity=new b(0,800)}addWebShot(a){this.add(a),a.actions.meet(this.character,380)}updateBossHealth(a){this.ui.bossDamaged(a)}hearts(a){this.ui.updateHealth(a)}onActivate(a){this.bgMusic=new Audio(vl),this.bgMusic.loop=!0,this.bgMusic.play(),this.character.pos=new b(400,0),this.boss.pos=new b(1e3,480),this.character.reset(),this.boss.bossReset(),this.ui=new wl,this.add(this.ui),this.ui.pos=new b(10,30)}onInitialize(a){const d=new ml;this.add(d),d.pos=new b(580,210);let p=new J({pos:new b(-10,0),width:30,height:9e9,collisionType:xt.Fixed});this.add(p);let w=new J({pos:new b(1265,0),width:30,height:9e9,collisionType:xt.Fixed});this.add(w);const x=new Xi;this.add(x),x.pos=new b(427,640);const C=new Co;this.add(C),C.pos=new b(310,350),this.character=new Rn,this.add(this.character),this.character.pos=new b(400,0),this.boss=new So,this.add(this.boss),this.boss.pos=new b(1e3,480)}onDeactivate(){this.ui.kill(),this.bgMusic.pause()}}class yl{constructor(){O(this,"score",0)}getScore(){return this.score}setScore(_){this.score=_}incrementScore(){console.log(this.score),this.score=this.score+1,console.log(this.score)}deleteScore(){this.score=0}}class bl extends Ht{constructor(){super();O(this,"game")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.failMusic=new Audio(xo),this.failMusic.loop=!0,this.failMusic.play(),this.startFailBoss()}startFailBoss(){this.actors.forEach(w=>w.kill());let a=new vo(0,0);this.add(a);let d=new Wi(screen.width/2-100,150);this.add(d),console.log("fail boss");let p=new Ni;p.pos=new b(670,450),p.on("pointerup",()=>{this.game.goToScene("bossFight"),this.failMusic.pause()}),this.add(p)}}const Al=""+new URL("Victoryboss-df18e4e4.mp4",import.meta.url).href;class Cl extends Ht{constructor(a){super();O(this,"game");O(this,"score");this.score=a}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.BossvictoryMusic=new Audio(Al),this.BossvictoryMusic.play(),this.startVictoryBoss()}startVictoryBoss(){this.actors.forEach(x=>x.kill()),console.log("victory boss");let a=new vo(0,0);this.add(a);let d=new Gi(screen.width/2-100,150);this.add(d);let p=new ke({text:`Score: ${this.score}`,pos:new b(500,400),font:new he({family:"impact",size:35,unit:le.Px,color:jt.White})});this.add(p);let w=new ke({text:"You've finished the game",pos:new b(500,300),font:new he({family:"impact",size:35,unit:le.Px,color:jt.White})});this.add(w)}}const Sl=""+new URL("Bosscutscene-d1a7d4f7.mp3",import.meta.url).href;class Tl extends Ht{constructor(){super();O(this,"game");O(this,"texts");O(this,"beeHappy");O(this,"beeBabyOne");O(this,"beeBabyTwo");O(this,"beeBabyThree");O(this,"spiderDead")}onInitialize(a){super.onInitialize(a),this.game=a}onActivate(a){super.onActivate(a),this.BosscutsceneMusic=new Audio(Sl),this.BosscutsceneMusic.play(),this.startCutScene()}startCutScene(){this.actors.forEach(p=>p.kill()),console.log("victory boss cutscene");let a=new go(-100,0);this.add(a),console.log(a),this.texts=[new ve(E.CsBossOne.toSprite()),new ve(E.CsBossTwo.toSprite())],this.currentTextIndex=0,this.add(this.texts[this.currentTextIndex]);const d=De.Keys;this.game.input.keyboard.on("press",p=>{p.key===d.Space&&this.changeElements()}),this.spiderDead=new al(700,400),this.add(this.spiderDead),this.beeHappy=new Vi(200,200),this.add(this.beeHappy),this.beeBabyOne=new Gs(150,200),this.add(this.beeBabyOne),this.beeBabyTwo=new Gs(170,130),this.add(this.beeBabyTwo),this.beeBabyThree=new Gs(220,120),this.add(this.beeBabyThree)}changeElements(){if(this.currentTextIndex<this.texts.length-1)this.texts[this.currentTextIndex].kill(),this.currentTextIndex++,this.add(this.texts[this.currentTextIndex]);else if(this.currentTextIndex===this.texts.length-1){this.texts[this.currentTextIndex].kill(),this.currentTextIndex++;let a=new Xs;a.pos=new b(screen.width/2-100,500),a.on("pointerup",()=>{this.game.goToScene("bossVictory")}),this.add(a),this.currentTextIndex===2&&this.spiderDead.actions.moveTo(1300,800,400)}}}class Pl extends Ba{constructor(){super({displayMode:co.FitScreenAndFill,maxFps:60});O(this,"score");this.start(Hh).then(()=>this.startGame()),this.showDebug(!0),In.acc=new ms(0,300),this.score=new yl}startGame(){this.addScene("Start",new Kh),this.goToScene("Start"),this.addScene("startCutscene",new ll),this.addScene("LevelOne",new Yh(this.score)),this.addScene("FailOne",new Jh),this.addScene("VictoryOne",new tl(this.score)),this.addScene("firstCutscene",new hl),this.addScene("LevelTwo",new el(this.score)),this.addScene("FailTwo",new sl),this.addScene("VictoryTwo",new il(this.score)),this.addScene("secondCutscene",new cl);const a=new nl(this.score);this.addScene("LevelThree",a),this.addScene("FailThree",new rl),this.addScene("VictoryThree",new ol(this.score)),this.addScene("thirdCutScene",new dl),this.addScene("bossFight",new xl),this.addScene("bossFail",new bl),this.addScene("bossCutscene",new Tl),this.addScene("bossVictory",new Cl(this.score))}}new Pl;
